<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://media.canva.com/v2/image-resize/format:PNG/height:729/quality:100/uri:ifs%3A%2F%2FM%2F5d02cf60-f46a-4a44-9436-81349e661209/watermark:F/width:644?csig=AAAAAAAAAAAAAAAAAAAAALDo40GbMwqBKBqWw5hJVNq66IkqRVbG-5oinqV8Tynj&exp=1758858655&osig=AAAAAAAAAAAAAAAAAAAAAOXLm6mXqpkJ97_H34uO8lhzPADWMYQ6hAVZmUbMsVxK&signer=media-rpc&x-canva-quality=screen_3x">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="./imagens/logodonavegador.png">
    <title>Panificadora e confeitaria dos sonhos</title>

    <!-- FIREBASE SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary-color: #F97316; /* Laranja */
            --secondary-color: #8B4513; /* Marrom */
            --text-color: #333;
            --light-gray: #f4f4f5;
            --medium-gray: #e4e4e7;
            --dark-gray: #52525b;
            --green: #16A34A;
            --white: #FFFFFF;
            --font-family: 'Arial', sans-serif;
        }
        html { scroll-behavior: smooth; }
        body { 
            margin: 0; 
            font-family: var(--font-family); 
            background-color: transparent;
            background-image: linear-gradient(rgba(99, 93, 93, 0.87), rgba(88, 84, 84, 0.829)), url('https://i.pinimg.com/736x/5f/ba/d6/5fbad6c44e68b9f884794e19c1da366a.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--text-color); 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .hidden { display: none !important; }

        /* --- LAYOUT GERAL --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        
        /* --- CABEÇALHO PRINCIPAL --- */
       .hero-section { 
    position: relative; 
    height: 300px; /* ou a altura que você escolheu */
    background-image: url('./imagens/logoback.png'); 
    background-size: cover; /* ← MANTENHA COVER */
    background-position: center center; /* ← CENTRALIZAR MELHOR */
    background-repeat: no-repeat; /* ← EVITA REPETIÇÃO */
    background-attachment: scroll; /* ← REMOVE FIXED SE TIVER */
    display: flex; 
    align-items: flex-start; 
    padding: 1rem; 
}
        .top-bar { width: 100%; max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { 
            background-color: var(--green); 
            color: var(--white); 
            padding: 0.3rem 0.8rem; 
            border-radius: 9999px; 
            font-weight: bold; 
            font-size: 0.8rem; 
            display: flex; 
            align-items: center; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer; /* Torna clicável */
            transition: all 0.3s ease;
            user-select: none; /* Impede seleção de texto */
        }
        
        .status-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .status-badge:active {
            transform: scale(0.95);
        }
        .status-badge .dot { width: 8px; height: 8px; background-color: var(--white); border-radius: 50%; margin-right: 0.5rem; }
        .cart-icon { position: relative; cursor: pointer; background-color: var(--white); border-radius: 50%; width: 44px; height: 44px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .cart-count { position: absolute; top: -5px; right: -5px; background-color: var(--primary-color); color: var(--white); border-radius: 50%; width: 20px; height: 20px; display: flex; justify-content: center; align-items: center; font-size: 0.75rem; font-weight: bold; border: 1px solid var(--white); }
        
        .shop-info-container { 
    background-color: var(--white); 
    text-align: center; 
    padding: 80px 1rem 1rem 1rem;  /* Aumentei o padding-top */
    margin-top: -150px;  /* Aumentei de -100px para -150px */
    position: relative; 
}
        .shop-logo { 
    position: absolute; 
    top: -80px;  /* Aumentei de -50px para -80px */
    left: 50%; 
    transform: translateX(-50%); 
    width: 120px;  /* Aumentei o tamanho do logo */
    height: 120px; 
    border-radius: 50%; 
    border: 4px solid var(--white); 
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
    overflow: hidden; 
}
        .shop-logo img { width: 100%; height: 100%; object-fit: cover; }
        .shop-name { font-size: 2rem; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .shop-details { color: var(--dark-gray); margin: 0.5rem 0; display: flex; justify-content: center; align-items: center; gap: 1rem; flex-wrap: wrap; }
        
        /* --- MENU DE CATEGORIAS --- */
        #category-menu { position: sticky; top: 0; z-index: 990; background-color: var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 0.5rem 1rem; overflow-x: auto; white-space: nowrap; }
        #category-menu a { display: inline-block; padding: 0.75rem 1rem; text-decoration: none; color: var(--dark-gray); font-weight: bold; border-radius: 8px; transition: background-color 0.2s; }
        #category-menu a:hover { background-color: var(--light-gray); color: var(--primary-color); }
        
        /* --- SEÇÕES DE PRODUTOS --- */
        .menu-category-section { padding: 2rem 0; border-bottom: 1px solid var(--medium-gray); }
        .product-section-title { font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5rem; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; }
        .product-card { background-color: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid var(--medium-gray); transition: transform 0.2s, box-shadow 0.2s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .product-card img {
           width: 100%;
           height: 180px; /* pode ajustar o valor */
           object-fit: contain; /* mostra a imagem completa */
           background-color: #fff; /* cor de fundo opcional */
           padding: 5px; /* opcional para deixar um respiro */
           border-radius: 8px; /* combina com o design do card */
         }

        .product-card-info { padding: 1rem; }
        .product-card-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .product-card-delivery { font-size: 0.9rem; color: var(--green); margin: 0.25rem 0; }
        .product-card-price .old-price { text-decoration: line-through; color: var(--dark-gray); font-size: 0.9rem; }
        .product-card-price .new-price { font-weight: bold; font-size: 1.2rem; color: var(--text-color); }

        /* --- PÁGINA DO PRODUTO --- */
        #product-page { background-color: var(--white); padding-bottom: 90px; }
        .product-header { display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid var(--medium-gray); }
        .back-button { background: none; border: none; cursor: pointer; margin-right: 1rem; }
        .product-page-layout { display: flex; flex-direction: column; }
        .product-image-column { flex: 1; }
        .product-details-column { flex: 1; }
        .product-image-lg { width: 100%; max-height: 400px; object-fit: cover; }
        .product-details { padding: 1rem; }
        .product-title-lg { font-size: 1.75rem; font-weight: bold; }
        .product-price-lg .old-price { text-decoration: line-through; color: var(--dark-gray); font-size: 1rem; }
        .product-price-lg .new-price { font-weight: bold; font-size: 1.75rem; color: var(--text-color); }
        .product-stock { color: var(--primary-color); font-size: 0.9rem; margin-top: 0.5rem; }
        .section { padding: 1rem; border-top: 8px solid var(--light-gray); }
        .section-title { font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; }
        .accompaniment-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--medium-gray); }
        .accompaniment-price { color: var(--green); font-weight: bold; }
        .quantity-control { display: flex; align-items: center; gap: 0.75rem; border: 1px solid var(--medium-gray); border-radius: 9999px; padding: 0.25rem; }
        .quantity-btn { background-color: var(--white); border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 1.5rem; color: var(--primary-color); cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .quantity-btn:disabled { color: var(--medium-gray); cursor: not-allowed; }
        .quantity-value { font-weight: bold; font-size: 1.1rem; min-width: 20px; text-align: center; }
        .sticky-footer { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--white); padding: 1rem; box-shadow: 0 -4px 12px rgba(0,0,0,0.1); }
        .sticky-footer .container { display: flex; justify-content: space-between; align-items: center; }
        .footer-price { font-size: 1.25rem; font-weight: bold; }
        .add-to-cart-btn { background-color: var(--primary-color); color: var(--white); border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; }
        @media (min-width: 768px) {
            .product-page-layout { flex-direction: row; gap: 2rem; padding: 2rem; }
            .product-image-lg { border-radius: 12px; }
        }

        /* --- RODAPÉ --- */
        .main-footer {
            background-color: #1e293b;
            color: white;
            padding: 1.5rem 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        }

        .footer-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 2rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 2rem;
}

        .footer-section h3 {
    color: #f97316;
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
    font-weight: bold;
}
        .footer-section p {
    color: rgba(255,255,255,0.8);
    font-size: 0.95rem;
    line-height: 1.6;
    text-decoration: none;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.footer-section i {
    width: 16px;
    text-align: center;
}
        .footer-section a {
            color: var(--white);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: var(--primary-color);
        }

        .social-links {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
}
        .social-links a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: rgba(255,255,255,0.1);
    color: #fff;
    transition: all 0.3s ease;
}

        .social-links a:hover {
    background-color: #fffefd;
}
        .footer-bottom {
    text-align: center;
    padding-top: 1rem;
    color: rgba(255,255,255,0.7);
    font-size: 0.9rem;
}

        .footer-icon {
            width: 20px;
            height: 20px;
            color: var(--primary-color);
        }
        
        .payment-options {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.payment-options label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    border-radius: 6px;
    transition: background-color 0.2s;
    cursor: pointer;
}

.payment-options label:hover {
    background-color: var(--light-gray);
}

.payment-options input[type="radio"] {
    margin: 0;
}

#card-type-group .payment-options {
    margin-top: 0.5rem;
    padding-left: 1rem;
    border-left: 2px solid var(--primary-color);
}

/* ESTILOS PARA IMAGENS DE PAGAMENTO */
.payment-methods-images {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
}

.payment-icon {
    width: 50px; /* Ajuste conforme necessário */
    height: 30px;
    object-fit: contain;
    background-color: white;
    padding: 2px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.payment-icon:hover {
    transform: scale(1.05);
}
/* Estilo para produtos indisponíveis */
.product-card.unavailable {
    opacity: 0.6;
    position: relative;
    cursor: not-allowed;
}

.product-card.unavailable::after {
    content: "INDISPONÍVEL";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(239, 68, 68, 0.9);
    color: white;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 0.9rem;
    z-index: 10;
}

.unavailable-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #ef4444;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: bold;
    z-index: 5;
}

.product-card.unavailable:hover {
    transform: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Botão desabilitado na página do produto */
.add-to-cart-btn:disabled {
    background-color: #9ca3af;
    cursor: not-allowed;
    opacity: 0.6;
}

/* === MODAL DO CARRINHO (MELHORIAS PARA DESKTOP) === */
        .cart-modal-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.5); 
            z-index: 998; 
            opacity: 0; 
            transition: opacity 0.3s ease; 
            pointer-events: none; 
        }
        .cart-modal { 
            position: fixed; 
            top: 0; 
            right: -100%; 
            width: 100%; 
            max-width: 550px; /* Aumentado para 550px */
            height: 100%; 
            background-color: var(--white); 
            z-index: 999; 
            transition: right 0.3s ease; 
            display: flex; 
            flex-direction: column; 
        }
        .cart-modal.open { right: 0; }
        .cart-modal-overlay.open { opacity: 1; pointer-events: auto; }
        .cart-header { 
            padding: 1.5rem; 
            font-size: 1.3rem; 
            font-weight: bold; 
            border-bottom: 1px solid var(--medium-gray); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: var(--primary-color);
            color: white;
        }
        .cart-header .close-btn { 
            background: none; 
            border: none; 
            font-size: 1.8rem; 
            cursor: pointer; 
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        .cart-header .close-btn:hover {
            background-color: rgba(255,255,255,0.2);
        }
        .cart-content { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 1rem; 
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) var(--light-gray);
        }
        
        .cart-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .cart-content::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 3px;
        }
        
        .cart-content::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }
        
        .cart-item {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            margin: 0;
            border-bottom: 1px solid var(--medium-gray);
            padding: 1.5rem 0;
            gap: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .cart-item > div {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
            border: 1px solid #e5e7eb;
        }
        
        .cart-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .cart-item-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
        }
        
        .cart-item-name { 
            font-weight: bold; 
            font-size: 1rem;
            line-height: 1.5;
            color: #1f2937;
        }
        
        .cart-item-price { 
            font-weight: 600; 
            color: var(--primary-color); 
            font-size: 1.1rem;
        }
        
        .cart-item-accompaniments { 
            font-size: 0.85rem; 
            color: var(--dark-gray); 
            margin-top: 0.5rem;
            line-height: 1.4;
        }
        
        .cart-item-actions { 
            display: flex; 
            flex-direction: column;
            gap: 0.5rem; 
            align-items: flex-end;
            min-width: 100px;
        }
        
        .cart-item-edit { 
            color: var(--primary-color); 
            font-size: 0.85rem; 
            cursor: pointer; 
            text-decoration: underline;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .cart-item-edit:hover {
            background-color: var(--light-gray);
        }
        
        .cart-item-remove { 
            color: #ef4444; 
            font-size: 0.85rem; 
            cursor: pointer; 
            text-decoration: underline;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .cart-item-remove:hover {
            background-color: #fee2e2;
        }
        
        .cart-form-section { 
            padding: 1.5rem; 
            border-bottom: 8px solid var(--light-gray); 
        }
        .form-group { margin-bottom: 1.25rem; }
        .form-group label { 
            display: block; 
            font-weight: 500; 
            margin-bottom: 0.75rem; 
            color: #374151;
            font-size: 0.95rem;
        }
        .form-group input[type="text"] { 
            width: 100%; 
            padding: 1rem; 
            border: 1px solid var(--medium-gray); 
            border-radius: 8px; 
            box-sizing: border-box; 
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }
        
        .payment-options label { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            margin-bottom: 0.75rem; 
            padding: 0.75rem;
            border-radius: 8px;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .payment-options label:hover {
            background-color: var(--light-gray);
        }
        
        .cart-footer { 
            padding: 1.5rem; 
            background: var(--white); 
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1); 
            border-top: 1px solid var(--medium-gray);
        }
        .cart-total { 
            display: flex; 
            justify-content: space-between; 
            font-weight: bold; 
            font-size: 1.3rem; 
            margin-bottom: 1.5rem; 
            color: #1f2937;
        }
        .finalize-btn { 
            width: 100%; 
            background-color: var(--green); 
            color: var(--white); 
            border: none; 
            padding: 1.2rem; 
            border-radius: 8px; 
            font-size: 1.1rem; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s ease;
        }
        
        .finalize-btn:hover {
            background-color: #15803d;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
        }
        
        .finalize-btn:active {
            transform: translateY(0);
        }

        /* MELHORIAS ESPECÍFICAS PARA MOBILE NO CARRINHO */
        @media (max-width: 768px) {
            .cart-modal {
                max-width: 100% !important;
                width: 100% !important;
            }
            
            .cart-item {
                flex-direction: row !important;
                align-items: center !important;
                padding: 0.75rem 0 !important;
                gap: 0.75rem !important;
            }
            
            .cart-item > div {
                flex-direction: row !important;
                align-items: center !important;
                gap: 0.75rem !important;
            }
            
            .cart-item-image {
                width: 70px !important;
                height: 70px !important;
                object-fit: cover !important;
                border-radius: 8px !important;
                flex-shrink: 0 !important;
            }
            
            .cart-item-info {
                flex: 1 !important;
                min-width: 0 !important;
            }
            
            .cart-item-name {
                font-size: 0.95rem !important;
                line-height: 1.3 !important;
                white-space: normal !important;
                overflow: hidden !important;
                display: -webkit-box !important;
                -webkit-line-clamp: 2 !important;
                line-clamp: 2;
                -webkit-box-orient: vertical !important;
            }
            
            .cart-item-price {
                font-size: 1rem !important;
                font-weight: bold !important;
                color: var(--primary-color) !important;
                margin-top: 0.25rem !important;
            }
            
            .cart-item-accompaniments {
                font-size: 0.75rem !important;
                line-height: 1.2 !important;
                margin-top: 0.25rem !important;
                white-space: normal !important;
                overflow: hidden !important;
                display: -webkit-box !important;
                -webkit-line-clamp: 2 !important;
                line-clamp: 2;
                -webkit-box-orient: vertical !important;
            }
            
            .cart-item-actions {
                flex-direction: column !important;
                align-items: flex-end !important;
                justify-content: center !important;
                gap: 0.5rem !important;
                min-width: auto !important;
            }
            
            .cart-item-edit,
            .cart-item-remove {
                font-size: 0.8rem !important;
                padding: 0.25rem !important;
            }
            
            .cart-header {
                padding: 1rem !important;
                font-size: 1.1rem !important;
            }
            
            .cart-content {
                padding: 0.75rem !important;
            }
            
            .cart-form-section {
                padding: 1rem !important;
            }
            
            .form-group input[type="text"] {
                padding: 0.75rem !important;
                font-size: 16px !important;
            }
            
            .cart-footer {
                padding: 1rem !important;
            }
            
            .cart-total {
                font-size: 1.1rem !important;
            }
            
            .finalize-btn {
                padding: 1rem !important;
                font-size: 1rem !important;
            }
            
            .cart-item-accompaniments {
                background: #f8f9fa !important;
                padding: 0.5rem !important;
                border-radius: 4px !important;
                margin-top: 0.5rem !important;
                font-size: 0.8rem !important;
            }
        }

        /* Para tablets pequenos */
        @media (max-width: 576px) {
            .cart-item {
                padding: 0.5rem 0 !important;
                border-bottom: 1px solid #e0e0e0 !important;
            }
            
            .cart-item-image {
                width: 60px !important;
                height: 60px !important;
            }
        }

        /* Para telas muito pequenas (menores que 380px) */
        @media (max-width: 380px) {
            .cart-item {
                padding: 0.5rem 0 !important;
            }
            
            .cart-item-image {
                width: 60px !important;
                height: 60px !important;
            }
            
            .cart-item-name {
                font-size: 0.9rem !important;
                -webkit-line-clamp: 1 !important;
                line-clamp: 2;
            }
            
            .cart-item-actions {
                flex-direction: row !important;
                gap: 0.5rem !important;
                width: 100% !important;
                justify-content: flex-end !important;
                margin-top: 0.5rem !important;
            }
        }

        /* === SISTEMA DE PESQUISA === */
.search-icon {
    position: relative;
    cursor: pointer;
    background-color: var(--white);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}

.search-icon:hover {
    transform: scale(1.05);
    background-color: var(--light-gray);
}

.search-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 998;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.search-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    background-color: var(--white);
    z-index: 999;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, opacity 0.3s ease;
    opacity: 0;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.search-modal.open {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
    pointer-events: auto;
}

.search-modal-overlay.open {
    opacity: 1;
    pointer-events: auto;
}

.search-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--medium-gray);
    background: var(--white);
}

.search-input-container {
    position: relative;
    display: flex;
    align-items: center;
}

.search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    border: 2px solid var(--primary-color);
    border-radius: 8px;
    font-size: 1.1rem;
    outline: none;
    transition: border-color 0.3s ease;
}

.search-input:focus {
    border-color: var(--secondary-color);
}

.search-input-icon {
    position: absolute;
    left: 1rem;
    color: var(--dark-gray);
}

.search-filters {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group label {
    font-size: 0.9rem;
    color: var(--dark-gray);
    cursor: pointer;
}

.filter-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.filter-group select {
    padding: 0.5rem;
    border: 1px solid var(--medium-gray);
    border-radius: 5px;
    background: var(--white);
}

.search-content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1rem;
}

.search-results-count {
    color: var(--dark-gray);
    margin-bottom: 1rem;
    font-size: 0.9rem;
    text-align: center;
}

.search-results-grid {
    display: grid;
    gap: 1rem;
}

.search-result-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    border: 1px solid var(--medium-gray);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--white);
}

.search-result-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: var(--primary-color);
}

.search-result-image {
    width: 60px;
    height: 60px;
    border-radius: 6px;
    object-fit: cover;
    margin-right: 1rem;
    flex-shrink: 0;
}

.search-result-info {
    flex: 1;
}

.search-result-name {
    font-weight: bold;
    margin-bottom: 0.25rem;
    color: var(--text-color);
}

.search-result-category {
    font-size: 0.8rem;
    color: var(--dark-gray);
    margin-bottom: 0.25rem;
}

.search-result-price {
    font-weight: bold;
    color: var(--primary-color);
}

.search-result-stock {
    font-size: 0.8rem;
    margin-top: 0.25rem;
}

.search-result-stock.in-stock {
    color: var(--green);
}

.search-result-stock.out-of-stock {
    color: #ef4444;
}

.no-results {
    text-align: center;
    padding: 2rem;
    color: var(--dark-gray);
}

.no-results-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.search-footer {
    padding: 1rem;
    border-top: 1px solid var(--medium-gray);
    text-align: center;
    background: var(--light-gray);
}

.close-search-btn {
    background: var(--primary-color);
    color: var(--white);
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.close-search-btn:hover {
    background: var(--secondary-color);
}

/* Destaque para texto pesquisado */
.highlight {
    background-color: #fff3cd;
    padding: 0.1rem 0.2rem;
    border-radius: 3px;
    font-weight: bold;
}

@media (max-width: 768px) {
    .search-modal {
        width: 95%;
        max-height: 90vh;
    }
    
    .search-filters {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .search-result-item {
        flex-direction: column;
        text-align: center;
    }
    
    .search-result-image {
        margin-right: 0;
        margin-bottom: 1rem;
    }
}

        /* === SISTEMA DE NOTIFICAÇÕES === */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 350px;
}

.notification {
    background: white;
    border-radius: 10px;
    padding: 1.25rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 1rem;
    animation: slideInRight 0.2s ease;
    border-left: 4px solid;
    transform: translateX(0);
    transition: transform 0.2s ease, opacity 0.2s ease;
}

.notification.fade-out {
    transform: translateX(100%);
    opacity: 0;
}

.notification-success {
    border-left-color: #10b981;
    background: linear-gradient(to right, #f0fdf4, #ffffff);
}

.notification-success .notification-icon {
    color: #10b981;
}

.notification-info {
    border-left-color: #3b82f6;
    background: linear-gradient(to right, #eff6ff, #ffffff);
}

.notification-info .notification-icon {
    color: #3b82f6;
}

.notification-warning {
    border-left-color: #f59e0b;
    background: linear-gradient(to right, #fffbeb, #ffffff);
}

.notification-warning .notification-icon {
    color: #f59e0b;
}

.notification-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: #1f2937;
}

.notification-message {
    color: #6b7280;
    font-size: 0.9rem;
    line-height: 1.4;
}

.notification-close {
    background: none;
    border: none;
    color: #9ca3af;
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.notification-close:hover {
    background: #f3f4f6;
    color: #374151;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Melhorias para desktop */
@media (min-width: 1024px) {
    /* Aumentar fonte e espaçamento no desktop */
    body {
        font-size: 16px;
    }
    
    .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 2rem;
    }
    
    .product-card {
        border-radius: 12px;
    }
    
    .cart-modal {
        max-width: 500px; /* Mais largo no desktop */
    }
    
    /* Melhorar formulário do carrinho */
    .cart-form-section {
        padding: 1.5rem;
    }
    
    .form-group input[type="text"] {
        padding: 1rem;
        font-size: 1rem;
    }
    
    /* Botões maiores no desktop */
    .finalize-btn, .add-to-cart-btn {
        padding: 1rem 2rem;
        font-size: 1.1rem;
    }
    
    /* Status badge maior */
    .status-badge {
        padding: 0.5rem 1.25rem;
        font-size: 0.9rem;
    }
}

/* Animações suaves para interações */
.product-card, .cart-item, .search-result-item {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Efeito de hover mais suave */
button, .cart-icon, .search-icon, .status-badge {
    transition: all 0.2s ease;
}

        /* =========================================== */
        
        /* =========================================== */

        /* ===== PAINEL ADMIN RESPONSIVO ===== */
        #admin-panel {
            padding: 10px;
            overflow-y: auto;
        }

        /* Layout responsivo para o painel de edição */
        @media (max-width: 768px) {
            /* Ajustes gerais do painel */
            #admin-panel {
                padding: 10px 5px;
            }
            
            #admin-panel > div {
                max-width: 100%;
                margin: 0;
                padding: 0 5px;
            }
            
            /* Header do admin */
            #admin-panel h2 {
                font-size: 1.3rem;
                text-align: center;
            }
            
            /* Layout de edição em coluna única */
            .product-edit-layout {
                display: flex !important;
                flex-direction: column !important;
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            /* Cards de informações */
            .admin-edit-section {
                padding: 15px !important;
                margin-bottom: 15px;
            }
            
            .admin-edit-section h4 {
                font-size: 1.1rem;
                margin-bottom: 15px;
                padding-bottom: 8px;
            }
            
            /* Formulários em coluna única */
            .admin-edit-section .form-grid {
                display: flex !important;
                flex-direction: column !important;
                grid-template-columns: 1fr !important;
                gap: 12px !important;
            }
            
            /* Inputs maiores para mobile */
            .admin-edit-section input,
            .admin-edit-section textarea,
            .admin-edit-section select {
                padding: 12px !important;
                font-size: 16px !important; /* Previne zoom no iOS */
                min-height: 44px !important; /* Tamanho mínimo para toque */
            }
            
            /* Acompanhamentos e bebidas */
            .accompaniment-option,
            .drink-option {
                padding: 12px !important;
            }
            
            .accompaniment-option > div,
            .drink-option > div {
                display: flex !important;
                flex-direction: column !important;
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
            
            /* Botões de ação */
            .admin-action-buttons {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .admin-action-buttons button {
                width: 100% !important;
                padding: 15px !important;
                font-size: 1.1rem !important;
            }
            
            /* Container de opções com scroll */
            #edit-accompaniments-options,
            #edit-drinks-options {
                max-height: 200px !important;
            }
            
            /* Botões de adicionar opção */
            .add-option-btn {
                width: 100% !important;
                padding: 15px !important;
                font-size: 1rem !important;
            }
        }

        /* Melhorias específicas para telas muito pequenas */
        @media (max-width: 380px) {
            .admin-edit-section {
                padding: 12px !important;
            }
            
            #admin-panel h3 {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }
            
            .admin-edit-section h4 {
                font-size: 1rem;
            }
        }

        /* Estilos para os botões de backup/restauro */
        .admin-card button {
            transition: all 0.3s ease;
        }

        .admin-card button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .admin-card button:active {
            transform: translateY(0);
        }

        /* Estilo para o input de arquivo */
        input[type="file"] {
            transition: all 0.3s ease;
        }

        input[type="file"]:hover {
            border-color: #6d28d9 !important;
            background: #faf5ff !important;
        }

        /* ===== SISTEMA DE PESQUISA ===== */
        .admin-card {
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        #admin-search-input:focus {
            outline: none;
            border-color: #ff9800 !important;
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }

        #search-results {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Destaque para produtos encontrados */
        .product-highlight {
            animation: highlightPulse 2s ease;
        }

        @keyframes highlightPulse {
            0% { background-color: transparent; }
            50% { background-color: #fff3e0; }
            100% { background-color: transparent; }
        }

        /* ===== ESTILOS PROFISSIONAIS PARA ADMIN ===== */
        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #eaeaea;
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .admin-section-title {
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f97316;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .admin-table th {
            background: #f8fafc;
            color: #475569;
            font-weight: 600;
            padding: 14px 16px;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
        }

        .admin-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .admin-table tr:hover {
            background: #f8fafc;
        }

        .admin-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* FORMULÁRIOS PROFISSIONAIS */
        .admin-form-group {
            margin-bottom: 20px;
        }

        .admin-form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .admin-form-input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .admin-form-input:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        /* BOTÕES PROFISSIONAIS */
        .btn-admin {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-admin-primary {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
        }

        .btn-admin-primary:hover {
            background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        .btn-admin-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-admin-secondary:hover {
            background: #e5e7eb;
        }

        .btn-admin-danger {
            background: #ef4444;
            color: white;
        }

        .btn-admin-danger:hover {
            background: #dc2626;
        }

        .btn-admin-success {
            background: #10b981;
            color: white;
        }

        .btn-admin-success:hover {
            background: #059669;
        }

        /* NOTIFICAÇÕES */
        .admin-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 300px;
            max-width: 400px;
            z-index: 10001;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .admin-notification-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-left: 4px solid #047857;
        }

        .admin-notification-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-left: 4px solid #b91c1c;
        }

        .admin-notification-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-left: 4px solid #b45309;
        }

        .admin-notification-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-left: 4px solid #1e40af;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* LOADING */
        .admin-loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 12px;
        }

        .admin-loading-content {
            text-align: center;
        }

        .admin-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f97316;
            border-radius: 50%;
            animation: admin-spin 1s linear infinite;
            margin: 0 auto 15px auto;
        }

        @keyframes admin-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* GRÁFICOS SIMPLES */
        .progress-bar {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f97316, #ea580c);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        /* Efeito de toque para mobile */
        @media (hover: none) and (pointer: coarse) {
            .cart-item {
                transition: background-color 0.2s ease;
            }
            
            .cart-item:active {
                background-color: #f5f5f5;
            }
            
            .cart-item-edit:active,
            .cart-item-remove:active {
                background-color: rgba(0, 0, 0, 0.1);
                border-radius: 4px;
            }
            
            .finalize-btn:active {
                transform: scale(0.98);
                transition: transform 0.1s;
            }
        }
    </style>

    <!-- FIREBASE CONFIGURAÇÃO -->
<script>
// =========================== CONFIGURAÇÃO FIREBASE ================================
const firebaseConfig = {
    apiKey: "AIzaSyCD8mdV9w-bTaaqHtrZIErrh84fAPRe20c",
    authDomain: "panificadora-dos-sonhos.firebaseapp.com",
    projectId: "panificadora-dos-sonhos",
    storageBucket: "panificadora-dos-sonhos.firebasestorage.app",
    messagingSenderId: "919334350725",
    appId: "1:919334350725:web:59a8db296323681d505eec"
};

// Função para inicializar o Firebase
function initializeFirebase() {
    try {
        // Verifica se o Firebase está disponível
        if (typeof firebase === 'undefined') {
            console.error('❌ Firebase SDK não carregado');
            return false;
        }
        
        // Verifica se já foi inicializado
        if (firestoreDb) {
            console.log('✅ Firebase já inicializado');
            return true;
        }
        
        const app = firebase.initializeApp(firebaseConfig);
        firestoreDb = firebase.firestore(app);
        console.log('✅ Firebase e Firestore inicializados com sucesso');
        return true;
    } catch (error) {
        // Se já foi inicializado, ignora o erro
        if (error.code === 'app/duplicate-app') {
            console.log('✅ Firebase já foi inicializado anteriormente');
            firestoreDb = firebase.firestore();
            return true;
        }
        console.error('❌ Erro ao inicializar Firebase:', error);
        return false;
    }
}

// Inicializar quando a página estiver completamente carregada
document.addEventListener('DOMContentLoaded', function() {
    initializeFirebase();
});
</script>

</head>
<body>

    <div id="main-page">
        <header class="hero-section">
            <div class="top-bar">
                <div class="status-badge" id="status-badge"><span class="dot"></span>ABERTO</div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <!-- Ícone de Pesquisa -->
                    <div class="search-icon" onclick="openSearch()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary-color);">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </div>
                    <!-- Ícone do Carrinho -->
                    <div class="cart-icon" onclick="openCart()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary-color);">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span class="cart-count" id="cart-count">0</span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="shop-info-container">
            <div class="shop-logo"><img id="shop-logo-main" src="" alt="Logo da Loja"></div>
            <div class="container">
                <h1 class="shop-name" id="shop-name-main"></h1>
                <div class="shop-details"><span>Horário de Funcionamento: Segunda a Sábado: 07h às 20h</span><span></span><span>Entrega grátis das 16h às 19h.</span><span></span><span></span></div>
            </div>
        </div>

        <nav id="category-menu"></nav>

        <main id="menu-container">
            <!-- Conteúdo do menu será inserido aqui -->
        </main>

        <!-- RODAPÉ -->
       <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Endereço</h3>
                <a href="https://www.google.com.br/maps/place/Panificadora+e+confeitaria+dos+sonhos/@-1.3476359,-48.4480096,17.65z/data=!4m6!3m5!1s0x92a4619a422ef337:0x48b314743d2acb8a!8m2!3d-1.3479238!4d-48.4475367!16s%2Fg%2F11wqygw_6t?hl=pt-BR&entry=ttu&g_ep=EgoyMDI1MTAxNS4wIKXMDSoJLDEwMjQ3OTk3MCCAAQ%3D%3D" class="text-gray-400 hover:text-orange transition"> Residencial Mururé - Alameda Principal, <br> 84 - Coqueiro, Belém - PA, 66823-061</a>
                
            </div>
            
              <div class="footer-section">
            <h3>Contato</h3>
            <p><i class="fas fa-phone"></i> (91) 98112-0535</p>
        </div>

        <div class="footer-section">
            <h3>Horário de Funcionamento</h3>
            <p>Segunda a Sábado: 07h às 20h</p>
            <p></p>
        </div>
         
        <div class="footer-section">
            <h3>Redes Sociais</h3>
            <div class="social-links">
                <a href="https://www.instagram.com/panif_confeitariadossonhos/"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/5591981120535?text=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre..."><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
        <div class="footer-section">
           <h3>Forma de Pagamento</h3>
           <div class="payment-methods-images">
              <img src="./imagens/visa.png" alt="Visa" class="payment-icon">
              <img src="./imagens/mastercard.png" alt="Mastercard" class="payment-icon">
              <img src="./imagens/elo.png" alt="Elo" class="payment-icon">
              <img src="./imagens/hipercard.png" alt="hipercard" class="payment-icon">
              <img src="https://zffprda1apista001.blob.core.windows.net/wordpress-img/assets-ecommerce/payment/pix.webp" alt="Pix" class="payment-icon">
        </div>
    </div>
    </div>
    
    <div class="footer-bottom">
        © 2025 DD - Todos os direitos reservados.
    </div>
</footer>
    </div>

    <div id="product-page" class="hidden">
        <header class="product-header"><button class="back-button" onclick="showMainPage()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg></button><span style="font-weight: bold;">VOLTAR</span></header>
        <div class="product-page-layout">
            <div class="product-image-column"><img id="product-image-lg" src="" alt="Imagem do produto" class="product-image-lg"></div>
            <div class="product-details-column">
                <div class="product-details"><h1 id="product-title-lg" class="product-title-lg"></h1><div id="product-price-lg" class="product-price-lg"></div><div id="product-stock" class="product-stock"></div></div>
                <div class="section"><h2 class="section-title">Descrição</h2><div id="product-description" class="complements-banner"></div></div>
                <div class="section" id="accompaniments-section">
                    <div class="accompaniments-header"><h2 class="section-title">Acompanhamentos</h2><p id="accompaniments-subtitle" class="section-subtitle"></p></div>
                    <div id="accompaniments-list"></div>
                </div>
                <div class="section" id="drinks-section">
                    <div class="accompaniments-header"><h2 class="section-title">Bebidas</h2><p id="drinks-subtitle" class="section-subtitle"></p></div>
                    <div id="drinks-list"></div>
                </div>
            </div>
        </div>
        <footer class="sticky-footer"><div class="container"><span id="footer-price" class="footer-price">R$ 0,00</span><button id="add-to-cart-btn" class="add-to-cart-btn" onclick="addToCart()">Adicionar ao carrinho</button></div></footer>
    </div>

    <div id="cart-modal-overlay" class="cart-modal-overlay" onclick="closeCart()"></div>
    <div id="cart-modal" class="cart-modal">
        <div class="cart-header"><span>Meu Carrinho</span><button class="close-btn" onclick="closeCart()">×</button></div>
        <div class="cart-content">
            <div id="cart-items-container"></div>
            <div class="cart-form-section"><div class="form-group"><label for="customer-name">Seu Nome</label><input type="text" id="customer-name" placeholder="Digite seu nome completo"></div><div class="form-group"><label for="customer-address">Endereço de Entrega</label><input type="text" id="customer-address" placeholder="Rua, Número, Bairro, Referência"></div></div>
            <div class="cart-form-section">
    <div class="form-group">
        <label>Forma de Pagamento</label>
        <div class="payment-options">
            <label><input type="radio" name="payment" value="Pix" checked onchange="handlePaymentChange()"> Pix</label>
            <label><input type="radio" name="payment" value="Dinheiro" onchange="handlePaymentChange()"> Dinheiro</label>
            <label><input type="radio" name="payment" value="Cartão" onchange="handlePaymentChange()"> Cartão</label>
        </div>
    </div>
    
    <!-- Grupo do Troco (apenas para Dinheiro) -->
    <div class="form-group hidden" id="change-group">
        <label for="customer-change">Troco para quanto?</label>
        <input type="text" id="customer-change" placeholder="Ex: 50,00 (opcional)">
    </div>
    
    <!-- Grupo do Tipo de Cartão (apenas para Cartão) -->
    <div class="form-group hidden" id="card-type-group">
        <label>Tipo de Cartão</label>
        <div class="payment-options">
            <label><input type="radio" name="cardType" value="Débito" checked> Débito</label>
            <label><input type="radio" name="cardType" value="Crédito"> Crédito</label>
        </div>
    </div>
</div>
        <div class="cart-footer"><div class="cart-total"><span>Total</span><span id="cart-total-price">R$ 0,00</span></div><button class="finalize-btn" onclick="finalizeOrder()">Finalizar Pedido no Whatsapp</button></div>
    </div>

    <!-- Modal de Pesquisa -->
    <div id="search-modal-overlay" class="search-modal-overlay" onclick="closeSearch()"></div>
    <div id="search-modal" class="search-modal">
        <div class="search-header">
            <div class="search-input-container">
                <svg class="search-input-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="search-input" class="search-input" placeholder="Pesquisar produtos..." autocomplete="off">
            </div>
            <div class="search-filters">
                <div class="filter-group">
                    <input type="checkbox" id="filter-in-stock" checked>
                    <label for="filter-in-stock">Em estoque</label>
                </div>
                <div class="filter-group">
                    <input type="checkbox" id="filter-out-of-stock">
                    <label for="filter-out-of-stock">Sem estoque</label>
                </div>
                <div class="filter-group">
                    <select id="filter-category">
                        <option value="">Todas categorias</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="search-content">
            <div id="search-results-count" class="search-results-count"></div>
            <div id="search-results" class="search-results-grid">
                <!-- Resultados aparecerão aqui -->
            </div>
        </div>
        <div class="search-footer">
            <button class="close-search-btn" onclick="closeSearch()">Fechar</button>
        </div>
    </div>

    <!-- =========================================== -->
    <!-- SISTEMA ADMIN (ADICIONADO AQUI NO FINAL) -->
    <!-- =========================================== -->

    <!-- Botão admin invisível - só aparece com atalho -->
    <div id="admin-access-area" style="display: none; position: fixed; bottom: 20px; left: 20px; z-index: 9999;">
        <button onclick="openAdminLogin()" style="
            background: #F97316;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        ">⚙️</button>
    </div>

    <!-- Painel Admin -->
    <div id="admin-panel" class="hidden" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 10000;
        padding: 20px;
        overflow-y: auto;
    ">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #f97316; padding-bottom: 15px;">
                <h2 style="color: #f97316; margin: 0;">Painel Administrativo</h2>
                <button onclick="closeAdmin()" style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">❌ Fechar</button>
            </div>
            
            <div id="admin-content">
                <!-- Conteúdo admin carregado aqui -->
            </div>
        </div>
    </div>

    <script>
        // ===================================================================================
        // =========================== CONFIGURAÇÃO INICIAL ==================================
        // ===================================================================================
        const defaultConfig = {
    whatsappNumber: "5591999138557",
    shop: {
        name: "Panificadora e Confeitaria dos Sonhos",
        logoUrl: "./imagens/logodonavegador.png",
        address: "Residencial Mururé - Alameda Principal, 84 - Coqueiro, Belém - PA, 66823-061",
        phone: "(91) 98112-0535",
        email: "Contato@gmail.com",
        socialMedia: {
            facebook: "https://www.facebook.com/",
            instagram: "https://www.instagram.com/",
            tiktok: "https://www.tiktok.com/"
        }
    },
    menu: [
       {
    category: "Promoções",
    products: [
        { 
            id: 1, 
            name: "Nescauzinho 180ml", 
            imageUrl: "./imagens/nescauzinho.jpg", 
            oldPrice: 4.99, 
            newPrice: 3.00, 
            delivery: "Entrega grátis", 
            stock: 8, 
            description: "Nescauzinho 180ml delicioso", 
            accompaniments: { 
                limit: 1,
                options: [
                    { name: "Quantidade", price: 3.00 }
                ] 
            },
            drinks: {
                limit: 0,
                options: []
            }
        },
        { 
            id: 2, 
            name: "Todóynho 200ml", 
            imageUrl: "./imagens/todoynho.jpg", 
            oldPrice: 5.99, 
            newPrice: 4.00, 
            delivery: "Entrega grátis", 
            stock: 10, 
            description: "Todóynho 200ml nutritivo", 
            accompaniments: { 
                limit: 1,
                options: [
                    { name: "Quantidade", price: 4.00 }
                ] 
            },
            drinks: {
                limit: 0,
                options: []
            }
        },
        { 
            id: 3, 
            name: "IOGURTE 300G", 
            imageUrl: "./imagens/iogurte.jpg", 
            oldPrice: 6.50, 
            newPrice: 5.99, 
            delivery: "Entrega grátis", 
            stock: 10, 
            description: "Iogurte cremoso 300g", 
            accompaniments: { 
                limit: 1,
                options: [
                    { name: "Quantidade", price: 5.99 }
                ] 
            },
            drinks: {
                limit: 0,
                options: []
            }
        }
    ]
},
        
          
        {
    category: "Lanches",
    products: [
        { 
            id: 5, 
            name: "Pastel de Queijo", 
            imageUrl: "https://superrissul.vtexassets.com/arquivos/ids/905195-800-auto?v=638941546428270000&width=800&height=auto&aspect=trueo", 
            newPrice: 3.00, 
            delivery: "Entrega grátis", 
            stock: 15, 
            description: "",
            accompaniments: { 
                limit: 6, 
                options: [
                    { name: "Quantidade", price: 3.00 },
                ] 
            },
            drinks: {
                limit: 6,
                options: [
                    { name: "Refrigerante 600ml", price: 7.00 },
                    { name: "Suco Natural 500ml", price: 8.00 }
                ]
            }
        },
    ]
},

        {
            category: "Sobremesas",
            products: [
                { 
                    id: 201, 
                    name: "Pudim de Leite", 
                    imageUrl: "https://www.mococa.com.br/wp-content/uploads/2023/08/img-pudim.jpg", 
                    newPrice: 7.50, 
                    description: "Uma fatia generosa de pudim caseiro.", 
                    accompaniments: { limit: 0, options: [] }, 
                    drinks: { limit: 0, options: [] } 
                },
            ]
        }
    ]
};

        // Variáveis globais
        let config = { ...defaultConfig };
        let cart = [];
        let currentProductState = {};
        const DB_NAME = 'TstDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'cart';

        // Bancos de dados separados
        let firestoreDb = null;    // Para Firebase Firestore
        let indexedDb = null;      // Para IndexedDB

        const mainPage = document.getElementById('main-page');
        const productPage = document.getElementById('product-page');
        const cartCountEl = document.getElementById('cart-count');
        const cartModal = document.getElementById('cart-modal');
        const cartModalOverlay = document.getElementById('cart-modal-overlay');

        // ===================================================================================
        // =========================== SISTEMA DE NOTIFICAÇÕES ===============================
        // ===================================================================================

        // Sistema de notificações
function showNotification(title, message, type = 'info') {
    // Criar container se não existir
    let container = document.getElementById('notification-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.className = 'notification-container';
        document.body.appendChild(container);
    }
    
    // Criar notificação
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    
    // Ícones para cada tipo
    const icons = {
        success: '✅',
        info: 'ℹ️',
        warning: '⚠️',
        error: '❌'
    };
    
    notification.innerHTML = `
        <div class="notification-icon">${icons[type] || icons.info}</div>
        <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
        </div>
        <button class="notification-close" onclick="this.parentElement.classList.add('fade-out'); setTimeout(() => this.parentElement.remove(), 300)">×</button>
    `;
    
    container.appendChild(notification);
    
    // Remover automaticamente após 5 segundos
    setTimeout(() => {
        if (notification.parentElement) {
            notification.classList.add('fade-out');
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
    
    return notification;
}

        // ===================================================================================
        // =========================== SISTEMA FIREBASE ======================================
        // ===================================================================================

        // Carregar configuração do Firebase
async function loadConfigFromFirebase() {
    try {
        // Aguardar um pouco para garantir que o Firebase foi inicializado
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Verifica se firestoreDb está inicializado
        if (!firestoreDb) {
            console.warn('⚠️ Firestore não inicializado, tentando inicializar...');
            if (!initializeFirebase()) {
                console.warn('⚠️ Falha ao inicializar Firebase, usando configuração padrão');
                config = { ...defaultConfig };
                return;
            }
        }
        
        console.log('🔄 Carregando configuração do Firebase...');
        const doc = await firestoreDb.collection('config').doc('shopConfig').get();
        
        if (doc.exists) {
            const firebaseConfig = doc.data();
            config = firebaseConfig;
            console.log('✅ Configuração carregada do Firebase');
        } else {
            console.log('📝 Criando configuração padrão no Firebase...');
            await saveConfigToFirebase();
        }
    } catch (error) {
        console.error('❌ Erro ao carregar do Firebase:', error);
        // Fallback para configuração padrão
        config = { ...defaultConfig };
    }
}

// Salvar configuração no Firebase
async function saveConfigToFirebase() {
    try {
        // Verifica se firestoreDb está inicializado
        if (!firestoreDb) {
            console.warn('⚠️ Firestore não inicializado, não é possível salvar');
            return false;
        }
        
        console.log('💾 Salvando configuração no Firebase...');
        
        // Limpar dados undefined antes de salvar
        const cleanConfig = JSON.parse(JSON.stringify(config));
        
        // Função recursiva para remover campos undefined
        function removeUndefined(obj) {
            for (let key in obj) {
                if (obj[key] === undefined) {
                    delete obj[key];
                } else if (typeof obj[key] === 'object' && obj[key] !== null) {
                    removeUndefined(obj[key]);
                }
            }
            return obj;
        }
        
        const finalConfig = removeUndefined(cleanConfig);
        
        await firestoreDb.collection('config').doc('shopConfig').set(finalConfig, { merge: true });
        console.log('✅ Configuração salva no Firebase');
        return true;
    } catch (error) {
        console.error('❌ Erro ao salvar no Firebase:', error);
        alert('Erro ao salvar configuração: ' + error.message);
        return false;
    }
}

        // ===================================================================================
        // =========================== SISTEMA DE INDEXEDDB ==================================
        // ===================================================================================

        // Inicializar o banco de dados
       function initDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => {
            console.error('Erro ao abrir o banco de dados');
            reject(request.error);
        };
        
        request.onsuccess = () => {
            indexedDb = request.result;
            console.log('✅ IndexedDB inicializado com sucesso');
            resolve(indexedDb);
        };
        
        request.onupgradeneeded = (event) => {
            const database = event.target.result;
            
            if (!database.objectStoreNames.contains(STORE_NAME)) {
                const store = database.createObjectStore(STORE_NAME, { 
                    keyPath: 'id',
                    autoIncrement: true 
                });
                
                store.createIndex('productId', 'productId', { unique: false });
                store.createIndex('timestamp', 'timestamp', { unique: false });
            }
        };
    });
}

        // Salvar carrinho no IndexedDB
        async function saveCartToDB() {
    if (!indexedDb) return;
            
            return new Promise((resolve, reject) => {
        const transaction = indexedDb.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
                
                const clearRequest = store.clear();
                
                clearRequest.onsuccess = () => {
                    if (cart.length === 0) {
                        resolve();
                        return;
                    }
                    
                    let completed = 0;
                    cart.forEach((item, index) => {
                        const itemWithTimestamp = {
                            ...item,
                            timestamp: Date.now() + index
                        };
                        
                        const request = store.add(itemWithTimestamp);
                        
                        request.onsuccess = () => {
                            completed++;
                            if (completed === cart.length) {
                                resolve();
                            }
                        };
                        
                        request.onerror = () => {
                            console.error('Erro ao salvar item no carrinho:', request.error);
                            reject(request.error);
                        };
                    });
                };
                
                clearRequest.onerror = () => {
                    console.error('Erro ao limpar carrinho:', clearRequest.error);
                    reject(clearRequest.error);
                };
            });
        }

        // Carregar carrinho do IndexedDB
        async function loadCartFromDB() {
    if (!indexedDb) return [];
            
            return new Promise((resolve, reject) => {
        const transaction = indexedDb.transaction([STORE_NAME], 'readonly');
        const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const items = request.result.sort((a, b) => a.timestamp - b.timestamp);
                    resolve(items);
                };
                
                request.onerror = () => {
                    console.error('Erro ao carregar carrinho:', request.error);
                    reject(request.error);
                };
            });
        }

        // Atualizar carrinho (salva no DB e atualiza UI)
        async function updateCart(newCart) {
    try {
        cart = newCart;
        await saveCartToDB();
        updateCartCount();
        
        if (cartModal.classList.contains('open')) {
            await renderCartItems();
        }
    } catch (error) {
        console.error('Erro ao atualizar carrinho:', error);
    }
}

        // ===================================================================================
        // =========================== FUNÇÕES AUXILIARES ====================================
        // ===================================================================================

        // Função para verificar se um produto está disponível
        function isProductAvailable(product) {
            // Se não tem propriedade stock, considera como disponível
            if (product.stock === undefined || product.stock === null) {
                return true;
            }
            // Se stock é 0 ou negativo, está indisponível
            return product.stock > 0;
        }

        async function updateStockAfterSale() {
            try {
                for (const item of cart) {
                    const product = findProductById(item.productId);
                    if (product && product.stock !== undefined && product.stock !== null) {
                        // Diminuir o estoque pela quantidade vendida
                        product.stock = Math.max(0, product.stock - item.quantity);
                    }
                }
                
                // Salvar as alterações no Firebase
                await saveConfigToFirebase();
                return true;
            } catch (error) {
                console.error('Erro ao atualizar estoque:', error);
                return false;
            }
        }

        // ===================================================================================
        // =========================== SISTEMA DE PESQUISA ===================================
        // ===================================================================================

        let searchTimeout = null;

        function openSearch() {
            const searchModal = document.getElementById('search-modal');
            const searchOverlay = document.getElementById('search-modal-overlay');
            const searchInput = document.getElementById('search-input');
            
            // Debug dos elementos
            debugSearchElements();
            
            // Preencher categorias no filtro
            populateCategoryFilter();
            
            // Abrir modal
            searchModal.classList.add('open');
            searchOverlay.classList.add('open');
            
            // Focar no input
            setTimeout(() => {
                searchInput.focus();
            }, 300);
            
            // Pesquisar produtos disponíveis inicialmente
            performSearch();
        }

        function closeSearch() {
            const searchModal = document.getElementById('search-modal');
            const searchOverlay = document.getElementById('search-modal-overlay');
            
            searchModal.classList.remove('open');
            searchOverlay.classList.remove('open');
            
            // Limpar timeout
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
        }

        function populateCategoryFilter() {
            const categorySelect = document.getElementById('filter-category');
            
            // Limpar opções existentes (exceto a primeira)
            while (categorySelect.children.length > 1) {
                categorySelect.removeChild(categorySelect.lastChild);
            }
            
            // Adicionar categorias
            config.menu.forEach(category => {
                const option = document.createElement('option');
                option.value = category.category;
                option.textContent = category.category;
                categorySelect.appendChild(option);
            });
        }

        function setupSearchEventListeners() {
            const searchInput = document.getElementById('search-input');
            const filterInStock = document.getElementById('filter-in-stock');
            const filterOutOfStock = document.getElementById('filter-out-of-stock');
            const filterCategory = document.getElementById('filter-category');
            
            // Evento de input com debounce
            searchInput.addEventListener('input', function() {
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                searchTimeout = setTimeout(() => {
                    performSearch();
                }, 300);
            });
            
            // Eventos dos filtros
            filterInStock.addEventListener('change', performSearch);
            filterOutOfStock.addEventListener('change', performSearch);
            filterCategory.addEventListener('change', performSearch);
        }

        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
            const filterInStock = document.getElementById('filter-in-stock').checked;
            const filterOutOfStock = document.getElementById('filter-out-of-stock').checked;
            const filterCategory = document.getElementById('filter-category').value;
            
            const results = [];
            let totalMatches = 0;
            
            // Pesquisar em todas as categorias
            config.menu.forEach(category => {
                // Pular categoria se filtro estiver ativo
                if (filterCategory && category.category !== filterCategory) {
                    return;
                }
                
                category.products.forEach(product => {
                    // Verificar se o produto corresponde ao termo de pesquisa
                    const matchesSearch = !searchTerm || 
                        product.name.toLowerCase().includes(searchTerm) ||
                        (product.description && product.description.toLowerCase().includes(searchTerm));
                    
                    // Verificar filtro de estoque
                    const hasStock = isProductAvailable(product);
                    const matchesStock = (filterInStock && hasStock) || 
                                       (filterOutOfStock && !hasStock) ||
                                       (!filterInStock && !filterOutOfStock);
                    
                    if (matchesSearch && matchesStock) {
                        results.push({
                            category: category.category,
                            product: product
                        });
                        totalMatches++;
                    }
                });
            });
            
            displaySearchResults(results, totalMatches, searchTerm);
        }

        function displaySearchResults(results, totalMatches, searchTerm) {
            try {
                // ✅ CORREÇÃO: Usar o ID correto 'search-results'
                const resultsContainer = document.getElementById('search-results');
                const resultsCount = document.getElementById('search-results-count');
                
                // ✅ VERIFICAÇÃO DE SEGURANÇA
                if (!resultsContainer) {
                    console.error('❌ Elemento search-results não encontrado no DOM');
                    return;
                }
                
                if (!resultsCount) {
                    console.error('❌ Elemento search-results-count não encontrado no DOM');
                    return;
                }
                
                // Atualizar contador
                if (totalMatches === 0) {
                    resultsCount.textContent = 'Nenhum produto encontrado';
                    resultsCount.style.color = '#ef4444';
                } else {
                    resultsCount.textContent = `${totalMatches} produto(s) encontrado(s)`;
                    resultsCount.style.color = '#16a34a';
                }
                
                // Limpar resultados anteriores
                resultsContainer.innerHTML = '';
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="no-results">
                            <div class="no-results-icon">🔍</div>
                            <h3>Nenhum produto encontrado</h3>
                            <p>Tente usar outros termos de pesquisa ou ajustar os filtros</p>
                        </div>
                    `;
                    return;
                }
                
                // Exibir resultados
                results.forEach(result => {
                    const product = result.product;
                    const isAvailable = isProductAvailable(product);
                    
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.onclick = () => {
                        closeSearch();
                        showProductPage(product.id);
                    };
                    
                    // Destacar termo de pesquisa no nome
                    let highlightedName = product.name;
                    if (searchTerm) {
                        const regex = new RegExp(`(${searchTerm})`, 'gi');
                        highlightedName = product.name.replace(regex, '<span class="highlight">$1</span>');
                    }
                    
                    resultItem.innerHTML = `
                        <img src="${product.imageUrl}" alt="${product.name}" class="search-result-image">
                        <div class="search-result-info">
                            <div class="search-result-name">${highlightedName}</div>
                            <div class="search-result-category">${result.category}</div>
                            <div class="search-result-price">${formatPrice(product.newPrice)}</div>
                            <div class="search-result-stock ${isAvailable ? 'in-stock' : 'out-of-stock'}">
                                ${isAvailable ? 
                                    (product.stock ? ` ${product.stock} disponíveis` : ' Disponível') : 
                                    ' Indisponível'}
                            </div>
                        </div>
                    `;
                    
                    resultsContainer.appendChild(resultItem);
                });
            } catch (error) {
                console.error('❌ Erro em displaySearchResults:', error);
            }
        }

        // Função de debug para verificar elementos
        function debugSearchElements() {
            console.log('🔍 Debug - Elementos de pesquisa:');
            console.log('- search-results:', document.getElementById('search-results'));
            console.log('- search-results-count:', document.getElementById('search-results-count'));
            console.log('- search-modal:', document.getElementById('search-modal'));
            console.log('- search-input:', document.getElementById('search-input'));
        }

        // ===================================================================================
        // ========================= FUNÇÕES PRINCIPAIS ATUALIZADAS ==========================
        // ===================================================================================

        function formatPrice(price) { 
            if (price === undefined || price === null || isNaN(price)) {
                console.warn('Preço inválido detectado:', price);
                return 'R$ 0,00';
            }
            return `R$ ${parseFloat(price).toFixed(2).replace('.', ',')}`; 
        }

        function validateCartItems(items) {
            return items.filter(item => {
                if (!item || typeof item !== 'object') return false;
                
                if (item.price === undefined || item.price === null || isNaN(item.price)) {
                    console.warn('Item com preço inválido removido:', item);
                    return false;
                }
                
                if (!item.id || !item.name) {
                    console.warn('Item com estrutura inválida removido:', item);
                    return false;
                }
                
                return true;
            }).map(item => {
                item.accompaniments = item.accompaniments || [];
                item.drinks = item.drinks || [];
                return item;
            });
        }

        async function renderMenuPage() {
    document.getElementById('shop-logo-main').src = config.shop.logoUrl;
    document.getElementById('shop-name-main').innerHTML = `${config.shop.name} <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#3b82f6" stroke="white" stroke-width="1"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>`;
    
    const categoryMenu = document.getElementById('category-menu');
    const menuContainer = document.getElementById('menu-container');
    categoryMenu.innerHTML = '';
    menuContainer.innerHTML = '';

    config.menu.forEach(cat => {
        const categoryId = `cat-${cat.category.replace(/\s+/g, '-')}`;
        categoryMenu.innerHTML += `<a href="#${categoryId}">${cat.category}</a>`;
        
        const section = document.createElement('section');
        section.id = categoryId;
        section.className = 'menu-category-section';
        
        const grid = document.createElement('div');
        grid.className = 'product-grid';

        cat.products.forEach(product => {
            const isAvailable = isProductAvailable(product);
            const card = document.createElement('div');
            card.className = `product-card ${!isAvailable ? 'unavailable' : ''}`;
            
            if (!isAvailable) {
                card.innerHTML = `
                    <div class="unavailable-badge">Esgotado no momento</div>
                    <img src="${product.imageUrl}" alt="${product.name}" style="filter: grayscale(70%);">
                    <div class="product-card-info">
                        <div class="product-card-title" style="color: #9ca3af;">${product.name}</div>
                        ${product.delivery ? `<div class="product-card-delivery" style="color: #9ca3af;">${product.delivery}</div>` : ''}
                        <div class="product-card-price">
                            ${product.oldPrice ? `<span class="old-price" style="color: #9ca3af;">de ${formatPrice(product.oldPrice)}</span>` : ''} 
                            <span class="new-price" style="color: #9ca3af;">${formatPrice(product.newPrice)}</span>
                        </div>
                        <div style="color: #ef4444; font-size: 0.8rem; margin-top: 0.5rem; font-weight: bold;">
                            Produto esgotado
                        </div>
                    </div>
                `;
            } else {
                card.onclick = () => showProductPage(product.id);
                card.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.name}">
                    <div class="product-card-info">
                        <div class="product-card-title">${product.name}</div>
                        ${product.delivery ? `<div class="product-card-delivery">${product.delivery}</div>` : ''}
                        <div class="product-card-price">
                            ${product.oldPrice ? `<span class="old-price">de ${formatPrice(product.oldPrice)}</span>` : ''} 
                            <span class="new-price">${formatPrice(product.newPrice)}</span>
                        </div>
                        ${product.stock && product.stock <= 10 ? `
                            <div style="color: #f97316; font-size: 0.8rem; margin-top: 0.5rem;">
                                ⚠️ Apenas ${product.stock} disponíveis
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            grid.appendChild(card);
        });
        
        section.innerHTML = `<div class="container"><h2 class="product-section-title">${cat.category}</h2></div>`;
        section.querySelector('.container').appendChild(grid);
        menuContainer.appendChild(section);
    });
                
            
            try {
                const savedCart = await loadCartFromDB();
                cart = validateCartItems(savedCart);
                updateCartCount();
                console.log('Carrinho carregado com sucesso:', cart.length, 'itens');
            } catch (error) {
                console.error('Erro ao carregar carrinho:', error);
                cart = [];
            }
        }

        function findProductById(productId) {
            for (const category of config.menu) {
                const product = category.products.find(p => p.id === productId);
                if (product) return product;
            }
            return null;
        }

      function showProductPage(productId) {
    const product = findProductById(productId);
    if (!product) return;
    
    const isAvailable = isProductAvailable(product);
    const isEditing = currentProductState.editingItemId !== undefined;
    
    // VERIFICAÇÃO DE DISPONIBILIDADE
    if (!isAvailable && !isEditing) {
        alert('Este produto está temporariamente indisponível.');
        showMainPage();
        return;
    }
    
    // Na função showProductPage, dentro do if (!isEditing):
    if (!isEditing) {
        currentProductState = { 
            product, 
            accompaniments: {}, 
            drinks: {},
            totalSelections: 1
        };

        // Inicializar com 1 unidade do produto (acompanhamento de quantidade)
        if (product.accompaniments && product.accompaniments.options.length > 0) {
            const quantityOption = product.accompaniments.options.find(opt => 
                opt.name.toLowerCase().includes('quantidade')
            );
            if (quantityOption) {
                currentProductState.accompaniments[quantityOption.name] = { 
                    quantity: 1, 
                    price: quantityOption.price 
                };
            }
        }
    }
    
    document.getElementById('product-image-lg').src = product.imageUrl;
    document.getElementById('product-title-lg').textContent = product.name;
    document.getElementById('product-price-lg').innerHTML = `${product.oldPrice ? `<span class="old-price">de ${formatPrice(product.oldPrice)} por</span>` : ''}<span class="new-price">${formatPrice(product.newPrice)}</span>`;
    document.getElementById('product-stock').textContent = product.stock ? `apenas ${product.stock} disponíveis` : '';
    document.getElementById('product-description').textContent = product.description;
    
    // Renderizar acompanhamentos
    const accompanimentsSection = document.getElementById('accompaniments-section');
    const accompanimentsList = document.getElementById('accompaniments-list');
    accompanimentsList.innerHTML = '';

    if (product.accompaniments && product.accompaniments.limit > 0) {
        accompanimentsSection.classList.remove('hidden');
        document.getElementById('accompaniments-subtitle').textContent = `Escolha até ${product.accompaniments.limit} opções`;
        
        product.accompaniments.options.forEach(option => {
            const item = document.createElement('div');
            item.className = 'accompaniment-item';
            
            // Verificar se este acompanhamento já foi selecionado anteriormente
            const existingSelection = currentProductState.accompaniments[option.name];
            const currentQty = existingSelection ? existingSelection.quantity : 0;
            
            item.innerHTML = `
                <div>
                    <div>${option.name}</div>
                    <div class="accompaniment-price">${option.price > 0 ? formatPrice(option.price) : 'Grátis'}</div>
                </div>
                <div class="quantity-control">
                    <button class="quantity-btn minus-btn" onclick="updateAccompanimentQuantity('${option.name}', -1, ${option.price})" ${currentQty === 0 ? 'disabled' : ''}>-</button>
                    <span class="quantity-value" id="accompaniment-quantity-${option.name.replace(/\s/g, '')}">${currentQty}</span>
                    <button class="quantity-btn plus-btn" onclick="updateAccompanimentQuantity('${option.name}', 1, ${option.price})" ${currentProductState.totalSelections >= product.accompaniments.limit ? 'disabled' : ''}>+</button>
                </div>`;
            accompanimentsList.appendChild(item);
        });
    } else { 
        accompanimentsSection.classList.add('hidden'); 
    }

    // Renderizar bebidas
    const drinksSection = document.getElementById('drinks-section');
    const drinksList = document.getElementById('drinks-list');
    drinksList.innerHTML = '';

    if (product.drinks && product.drinks.limit > 0) {
        drinksSection.classList.remove('hidden');
        document.getElementById('drinks-subtitle').textContent = `Escolha até ${product.drinks.limit} opções`;
        
        product.drinks.options.forEach(drink => {
            const item = document.createElement('div');
            item.className = 'accompaniment-item';
            
            // Verificar se esta bebida já foi selecionada anteriormente
            const existingSelection = currentProductState.drinks[drink.name];
            const currentQty = existingSelection ? existingSelection.quantity : 0;
            
            item.innerHTML = `
                <div>
                    <div>${drink.name}</div>
                    <div class="accompaniment-price">${formatPrice(drink.price)}</div>
                </div>
                <div class="quantity-control">
                    <button class="quantity-btn minus-btn" onclick="updateDrinkQuantity('${drink.name}', -1, ${drink.price})" ${currentQty === 0 ? 'disabled' : ''}>-</button>
                    <span class="quantity-value" id="drink-quantity-${drink.name.replace(/\s/g, '')}">${currentQty}</span>
                    <button class="quantity-btn plus-btn" onclick="updateDrinkQuantity('${drink.name}', 1, ${drink.price})" ${currentProductState.totalSelections >= product.drinks.limit ? 'disabled' : ''}>+</button>
                </div>`;
            drinksList.appendChild(item);
        });
    } else { 
        drinksSection.classList.add('hidden'); 
    }

    // Atualizar botão de adicionar ao carrinho conforme disponibilidade
    const addToCartBtn = document.getElementById('add-to-cart-btn');
    if (!isAvailable) {
        addToCartBtn.textContent = 'PRODUTO INDISPONÍVEL';
        addToCartBtn.disabled = true;
        addToCartBtn.style.backgroundColor = '#9ca3af';
        addToCartBtn.onclick = null;
    } else {
        if (isEditing) {
            addToCartBtn.textContent = 'Atualizar Item';
            addToCartBtn.onclick = updateCartItem;
        } else {
            addToCartBtn.textContent = 'Adicionar ao carrinho';
            addToCartBtn.onclick = addToCart;
        }
        addToCartBtn.disabled = false;
        addToCartBtn.style.backgroundColor = '';
    }

    updateProductFooter();
    updateButtonsState();
    mainPage.classList.add('hidden');
    productPage.classList.remove('hidden');
    window.scrollTo(0, 0);
}

        function showMainPage() { 
            productPage.classList.add('hidden'); 
            mainPage.classList.remove('hidden'); 
            window.scrollTo(0, 0); 
        }
        
       function updateAccompanimentQuantity(option, change, price) {
    const { product, accompaniments } = currentProductState;
    const limit = product.accompaniments.limit;
    
    // Verificar se é um acompanhamento de quantidade (não deve contar no limite)
    const isQuantityOption = option.toLowerCase().includes('quantidade');
    
    const currentQty = accompaniments[option] ? accompaniments[option].quantity : 0;
    const newQty = currentQty + change;
    
    if (newQty < 0) return;
    
    // Se NÃO for quantidade, verificar o limite
    if (!isQuantityOption && change > 0) {
        const currentSelections = Object.entries(accompaniments)
            .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
            .reduce((total, [name, data]) => total + data.quantity, 0);
        
        if (currentSelections >= limit) return;
    }
    
    if (newQty === 0) {
        delete accompaniments[option];
    } else {
        accompaniments[option] = { 
            quantity: newQty, 
            price: isQuantityOption ? 0 : price
        };
    }
    
    // Atualizar contagem total (excluindo quantidade do produto)
    currentProductState.totalSelections = 
        Object.entries(accompaniments)
            .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
            .reduce((total, [name, data]) => total + data.quantity, 0) + 
        Object.values(currentProductState.drinks).reduce((a, b) => a + b.quantity, 0);
    
    document.getElementById(`accompaniment-quantity-${option.replace(/\s/g, '')}`).textContent = newQty;
    const minusBtn = document.querySelector(`#accompaniment-quantity-${option.replace(/\s/g, '')}`).previousElementSibling;
    minusBtn.disabled = newQty === 0;
    
    // Atualizar estado dos botões + (apenas para não-quantidade)
    const isMax = currentProductState.totalSelections >= limit;
    document.querySelectorAll('.plus-btn').forEach(btn => {
        if (!btn.closest('.accompaniment-item')?.textContent.includes('Quantidade')) {
            btn.disabled = isMax;
        }
    });
    
    updateProductFooter();
    updateButtonsState();
}

function updateDrinkQuantity(drink, change, price) {
    const { product, drinks } = currentProductState;
    const limit = product.drinks.limit;
    const currentQty = drinks[drink] ? drinks[drink].quantity : 0;
    const newQty = currentQty + change;
    
    if (newQty < 0) return;
    
    // Verificar limite para bebidas
    if (change > 0) {
        const currentDrinkSelections = Object.values(drinks).reduce((total, data) => total + data.quantity, 0);
        if (currentDrinkSelections >= limit) return;
    }
    
    if (newQty === 0) {
        delete drinks[drink];
    } else {
        drinks[drink] = { quantity: newQty, price: price };
    }
    
    // Atualizar contagem total (bebidas + acompanhamentos exceto quantidade)
    currentProductState.totalSelections = 
        Object.entries(currentProductState.accompaniments)
            .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
            .reduce((total, [name, data]) => total + data.quantity, 0) + 
        Object.values(currentProductState.drinks).reduce((a, b) => a + b.quantity, 0);
    
    document.getElementById(`drink-quantity-${drink.replace(/\s/g, '')}`).textContent = newQty;
    const minusBtn = document.querySelector(`#drink-quantity-${drink.replace(/\s/g, '')}`).previousElementSibling;
    minusBtn.disabled = newQty === 0;
    
    // Atualizar estado dos botões + para bebidas
    const isMax = Object.values(drinks).reduce((total, data) => total + data.quantity, 0) >= limit;
    document.querySelectorAll('#drinks-list .plus-btn').forEach(btn => {
        btn.disabled = isMax;
    });
    
    updateProductFooter();
}
        
     function updateProductFooter() {
    const { product, accompaniments, drinks } = currentProductState;
    
    // Encontrar a quantidade do produto (acompanhamento de quantidade)
    let productQuantity = 1;
    Object.entries(accompaniments).forEach(([name, data]) => {
        if (name.toLowerCase().includes('quantidade')) {
            productQuantity = data.quantity;
        }
    });
    
    // Calcular preço total = (preço unitário × quantidade) + bebidas
    let totalPrice = product.newPrice * productQuantity;
    
    // Somar bebidas
    Object.values(drinks).forEach(drink => {
        totalPrice += drink.price * drink.quantity;
    });
    
    document.getElementById('footer-price').textContent = formatPrice(totalPrice);
} 
   
   async function addToCart() {
    const { product, accompaniments, drinks } = currentProductState;
    
    // Verificar se o produto ainda está disponível
    if (!isProductAvailable(product)) {
        alert('Desculpe, este produto está indisponível no momento.');
        return;
    }
    
    // Calcular quantidade do produto
    let productQuantity = 1;
    const accompanimentsArray = Object.entries(accompaniments).map(([name, data]) => {
        // Se for o acompanhamento de quantidade, usa para definir a quantidade do produto
        if (name.toLowerCase().includes('quantidade')) {
            productQuantity = data.quantity;
        }
        return { 
            name, 
            quantity: data.quantity, 
            price: data.price 
        };
    });
    
    const drinksArray = Object.entries(drinks).map(([name, data]) => ({ 
        name, 
        quantity: data.quantity, 
        price: data.price 
    }));
    
    // Calcular preço total CORRETAMENTE
    // Preço base × quantidade + bebidas
    let itemPrice = product.newPrice * productQuantity;
    
    // Somar bebidas
    drinksArray.forEach(drink => {
        itemPrice += drink.price * drink.quantity;
    });
    
    const newItem = {
        id: Date.now(),
        productId: product.id,
        name: product.name,
        basePrice: product.newPrice,
        price: itemPrice,
        quantity: productQuantity,
        accompaniments: accompanimentsArray,
        drinks: drinksArray,
        timestamp: Date.now()
    };
    
    const newCart = [...cart, newItem];
    await updateCart(newCart);
    
    // NOTIFICAÇÃO DE SUCESSO
    showNotification(
        'Item adicionado! 🛒',
        `${product.name} foi adicionado ao carrinho`,
        'success'
    );
    
    showMainPage();
}

        function updateCartCount() { 
            cartCountEl.textContent = cart.length; 
        }

        async function openCart() {
            await renderCartItems();
            cartModal.classList.add('open');
            cartModalOverlay.classList.add('open');
        }

        function closeCart() {
            cartModal.classList.remove('open');
            cartModalOverlay.classList.remove('open');
        }

      async function renderCartItems() {
    const container = document.getElementById('cart-items-container');
    container.innerHTML = '';
    
    if (cart.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 3rem 1rem;">
                <div style="font-size: 4rem; color: #e5e7eb; margin-bottom: 1rem;">🛒</div>
                <h3 style="color: #6b7280; margin-bottom: 0.5rem;">Seu carrinho está vazio</h3>
                <p style="color: #9ca3af;">Adicione produtos para ver eles aqui</p>
            </div>
        `;
        document.getElementById('cart-total-price').textContent = formatPrice(0);
        return;
    }
    
    let total = 0;
    
    try {
        cart.forEach((item) => {
            if (!item || typeof item !== 'object') {
                console.warn('Item inválido encontrado no carrinho:', item);
                return;
            }
            
            const itemPrice = item.price && !isNaN(item.price) ? parseFloat(item.price) : 0;
            total += itemPrice;
            
            // Encontrar o produto original para pegar a imagem
            const originalProduct = findProductById(item.productId);
            const productImage = originalProduct ? originalProduct.imageUrl : 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 24 24" fill="%23e5e7eb"><rect width="24" height="24" rx="8"/><text x="12" y="16" font-size="10" text-anchor="middle" fill="%239ca3af">Sem Imagem</text></svg>';
            
            const itemEl = document.createElement('div');
            itemEl.className = 'cart-item';
            
            let accompanimentsText = '';
            if (item.accompaniments && Array.isArray(item.accompaniments) && item.accompaniments.length > 0) {
                accompanimentsText += '<div style="font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem; background: #f8f9fa; padding: 0.5rem; border-radius: 4px;">';
                item.accompaniments.forEach(accomp => {
                    if (accomp.name.toLowerCase().includes('quantidade')) {
                        accompanimentsText += `<strong>${accomp.quantity}x</strong> • `;
                    } else {
                        accompanimentsText += `${accomp.quantity}x ${accomp.name}<br>`;
                    }
                });
                accompanimentsText += '</div>';
            }
            
            if (item.drinks && Array.isArray(item.drinks) && item.drinks.length > 0) {
                if (!accompanimentsText.includes('</div>')) {
                    accompanimentsText += '<div style="font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem; background: #f8f9fa; padding: 0.5rem; border-radius: 4px;">';
                } else {
                    accompanimentsText = accompanimentsText.replace('</div>', '');
                }
                item.drinks.forEach(drink => {
                    accompanimentsText += `${drink.quantity}x ${drink.name}<br>`;
                });
                accompanimentsText += '</div>';
            }
            
            itemEl.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem; width: 100%;">
                    <!-- IMAGEM DO PRODUTO - TAMANHO OTIMIZADO PARA MOBILE -->
                    <img src="${productImage}" 
                         alt="${item.name}"
                         class="cart-item-image"
                         style="width: 70px; height: 70px; object-fit: cover; border-radius: 8px; flex-shrink: 0;">
                    
                    <!-- INFORMAÇÕES DO PRODUTO - LAYOUT COMPACTO -->
                    <div style="flex: 1; min-width: 0;">
                        <div class="cart-item-header">
                            <div class="cart-item-name" style="font-size: 0.95rem; font-weight: 600; line-height: 1.3; 
                                 white-space: normal; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                ${item.name || 'Produto sem nome'}
                            </div>
                            <div class="cart-item-price" style="font-size: 1rem; font-weight: bold; color: var(--primary-color); margin-top: 0.25rem;">
                                ${formatPrice(itemPrice)}
                            </div>
                        </div>
                        ${accompanimentsText}
                    </div>
                    
                    <!-- AÇÕES COMPACTAS -->
                    <div class="cart-item-actions" style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                        <div class="cart-item-edit" onclick="editCartItem(${item.id})" 
                             style="font-size: 0.9rem; padding: 0.30rem;">
                            ✏️ 
                        </div>
                        <div class="cart-item-remove" onclick="removeFromCart(${item.id})"
                             style="font-size: 0.9rem; padding: 0.30rem;">
                            🗑️ 
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(itemEl);
        });
    } catch (error) {
        console.error('Erro ao renderizar itens do carrinho:', error);
        container.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #ef4444;">
                <div style="font-size: 3rem;">❌</div>
                <h3>Erro ao carregar carrinho</h3>
                <p>Tente recarregar a página</p>
            </div>
        `;
        total = 0;
    }
    
    document.getElementById('cart-total-price').textContent = formatPrice(total);
}
                 
        async function removeFromCart(itemId) {
            const newCart = cart.filter(item => item.id !== itemId);
            await updateCart(newCart);
            showNotification(
                'Item removido',
                'Item foi removido do carrinho',
                'warning'
            );
        }

        function editCartItem(itemId) {
            const item = cart.find(item => item.id === itemId);
            if (!item) return;
            
            const originalProduct = findProductById(item.productId);
            if (!originalProduct) return;
            
            // Preencher o estado atual com os dados do item do carrinho
            currentProductState = {
                product: originalProduct,
                accompaniments: {},
                drinks: {},
                totalSelections: 0,
                editingItemId: itemId
            };
            
            // Preencher acompanhamentos do item existente
            if (item.accompaniments && Array.isArray(item.accompaniments)) {
                item.accompaniments.forEach(accomp => {
                    currentProductState.accompaniments[accomp.name] = {
                        quantity: accomp.quantity,
                        price: accomp.price
                    };
                    currentProductState.totalSelections += accomp.quantity;
                });
            }
            
            // Preencher bebidas do item existente
            if (item.drinks && Array.isArray(item.drinks)) {
                item.drinks.forEach(drink => {
                    currentProductState.drinks[drink.name] = {
                        quantity: drink.quantity,
                        price: drink.price
                    };
                    currentProductState.totalSelections += drink.quantity;
                });
            }
            
            // Mostrar página do produto com os dados pré-preenchidos
            showProductPage(originalProduct.id);
            closeCart();
            updateProductFooter();
        }

    async function updateCartItem() {
    const { product, accompaniments, drinks, editingItemId } = currentProductState;
    
    // Calcular quantidade do produto
    let productQuantity = 1;
    const accompanimentsArray = Object.entries(accompaniments).map(([name, data]) => {
        if (name.toLowerCase().includes('quantidade')) {
            productQuantity = data.quantity;
        }
        return { name, ...data };
    });
    
    const drinksArray = Object.entries(drinks).map(([name, data]) => ({ name, ...data }));
    
    // Calcular preço total CORRETAMENTE
    let itemPrice = product.newPrice * productQuantity;
    
    // Somar bebidas
    drinksArray.forEach(drink => {
        itemPrice += drink.price * drink.quantity;
    });
    
    const updatedItem = {
        id: editingItemId,
        productId: product.id,
        name: product.name,
        basePrice: product.newPrice,
        price: itemPrice,
        quantity: productQuantity,
        accompaniments: accompanimentsArray,
        drinks: drinksArray,
        timestamp: Date.now()
    };
    
    const newCart = cart.map(item => item.id === editingItemId ? updatedItem : item);
    await updateCart(newCart);
    
    // Limpar estado de edição
    currentProductState.editingItemId = undefined;
    
    showNotification(
        'Item atualizado! ✏️',
        `${product.name} foi atualizado no carrinho`,
        'success'
    );
    
    showMainPage();
}

      function handlePaymentChange() {
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    const changeGroup = document.getElementById('change-group');
    const cardTypeGroup = document.getElementById('card-type-group');
    
    // Esconder todos os grupos primeiro
    changeGroup.classList.add('hidden');
    cardTypeGroup.classList.add('hidden');
    
    // Mostrar apenas o grupo relevante
    if (paymentMethod === 'Dinheiro') {
        changeGroup.classList.remove('hidden');
    } else if (paymentMethod === 'Cartão') {
        cardTypeGroup.classList.remove('hidden');
    }
}

        async function finalizeOrder() {
    const customerName = document.getElementById('customer-name').value.trim();
    const customerAddress = document.getElementById('customer-address').value.trim();
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    const changeFor = document.getElementById('customer-change').value.trim();
    const cardType = document.querySelector('input[name="cardType"]:checked')?.value || '';
    
    if (!customerName || !customerAddress) {
        showNotification(
            'Preencha os dados',
            'Por favor, preencha seu nome e endereço.',
            'warning'
        );
        return;
    }
    
    let total = 0;
    let message = `*NOVO PEDIDO - ${config.shop.name}*%0A%0A`;
    message += `*Cliente:* ${customerName}%0A`;
    message += `*Endereço:* ${customerAddress}%0A`;
    message += `*Pagamento:* ${paymentMethod}`;
    
    // Adicionar informações específicas do pagamento
    if (paymentMethod === 'Dinheiro' && changeFor) {
        message += ` (Troco para R$ ${changeFor})`;
    } else if (paymentMethod === 'Cartão') {
        message += ` (${cardType})`;
    }
    
    message += `%0A%0A*Itens do Pedido:*%0A`;
    
    cart.forEach((item, index) => {
        const itemPrice = item.price && !isNaN(item.price) ? parseFloat(item.price) : 0;
        total += itemPrice;
        
        message += `%0A*${index + 1}. ${item.name || 'Produto sem nome'}* - ${formatPrice(itemPrice)}%0A`;
        
        if (item.accompaniments && Array.isArray(item.accompaniments) && item.accompaniments.length > 0) {
            message += `   Acompanhamentos: `;
            item.accompaniments.forEach(accomp => {
                message += `${accomp.quantity}x ${accomp.name}, `;
            });
            message = message.slice(0, -2) + '%0A';
        }
        
        if (item.drinks && Array.isArray(item.drinks) && item.drinks.length > 0) {
            message += `   Bebidas: `;
            item.drinks.forEach(drink => {
                message += `${drink.quantity}x ${drink.name}, `;
            });
            message = message.slice(0, -2) + '%0A';
        }
    });
    
    message += `%0A*Total: ${formatPrice(total)}*`;
    
    // Mostrar notificação antes de abrir o WhatsApp
    const notification = showNotification(
        'Finalizando pedido... 📤',
        'Preparando para abrir o WhatsApp',
        'info'
    );
    
    // Pequeno delay para usuário ver a notificação
    setTimeout(() => {
        const whatsappUrl = `https://wa.me/${config.whatsappNumber}?text=${message}`;
        window.open(whatsappUrl, '_blank');
        
        // Atualizar notificação após abrir WhatsApp
        if (notification) {
            notification.querySelector('.notification-title').textContent = 'Pedido enviado! ✅';
            notification.querySelector('.notification-message').textContent = 'Seu pedido foi enviado pelo WhatsApp com sucesso!';
            notification.className = 'notification notification-success';
            notification.querySelector('.notification-icon').textContent = '✅';
            
            // Fechar notificação após 3 segundos
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Diminuir estoque dos produtos vendidos
        updateStockAfterSale();
        
        updateCart([]);
        closeCart();
        
        // Limpar formulários
        document.getElementById('customer-name').value = '';
        document.getElementById('customer-address').value = '';
        document.getElementById('customer-change').value = '';
        
        // Resetar para Pix como padrão
        document.querySelector('input[value="Pix"]').checked = true;
        handlePaymentChange();
    }, 1500);
}

        // Inicializar a aplicação
        document.addEventListener('DOMContentLoaded', async () => {
    try {
        // 1. Primeiro inicializa Firebase
        console.log('🔄 Inicializando Firebase...');
        
        // 2. Depois inicializa IndexedDB
        await initDB();
        
        // 3. Agora carrega configuração do Firebase
        await loadConfigFromFirebase();
        
        // 4. Finalmente renderiza o menu
        await renderMenuPage();
        
        // 5. Inicializar sistema de pesquisa
        setupSearchEventListeners();
        
        // 6. Verificar elementos de pesquisa
        console.log('✅ Verificando elementos de pesquisa...');
        const searchElements = [
            'search-results',
            'search-results-count', 
            'search-input',
            'search-modal'
        ];
        
        searchElements.forEach(id => {
            const element = document.getElementById(id);
            console.log(`- ${id}:`, element ? '✅ Encontrado' : '❌ Não encontrado');
        });
        
        console.log('✅ Aplicação inicializada com sucesso');
    } catch (error) {
        console.error('❌ Erro ao inicializar aplicação:', error);
        // Fallback: usa configuração padrão mesmo com erro
        config = { ...defaultConfig };
        await renderMenuPage();
        setupSearchEventListeners();
    }
});
        function updateButtonsState() {
    const { product, accompaniments, drinks } = currentProductState;
    
    // Atualizar botões de acompanhamentos (exceto quantidade)
    const accompanimentsSelections = Object.entries(accompaniments)
        .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
        .reduce((total, [name, data]) => total + data.quantity, 0);
    
    const isAccompanimentsMax = accompanimentsSelections >= product.accompaniments.limit;
    
    document.querySelectorAll('#accompaniments-list .plus-btn').forEach(btn => {
        if (!btn.closest('.accompaniment-item')?.textContent.includes('Quantidade')) {
            btn.disabled = isAccompanimentsMax;
        }
    });
    
    // Atualizar botões de bebidas
    const drinksSelections = Object.values(drinks).reduce((total, data) => total + data.quantity, 0);
    const isDrinksMax = drinksSelections >= product.drinks.limit;
    
    document.querySelectorAll('#drinks-list .plus-btn').forEach(btn => {
        btn.disabled = isDrinksMax;
    });
}

        // ===================================================================================
        // =========================== SISTEMA ADMINISTRATIVO PROFISSIONAL ===================
        // ===================================================================================

        const ADMIN_CONFIG = {
            password: "admin@2025", // MUDE ESTA SENHA!
            currentCategory: null,
            editingProduct: null,
            hasUnsavedChanges: false
        };

        // Sistema de logs e notificações
        const ADMIN_LOGS = [];
        const ADMIN_CACHE = {
            products: null,
            categories: null,
            timestamp: null
        };

        // Sistema de acesso por atalho de teclado
        let adminKeySequence = [];
        const ADMIN_SECRET_CODE = ['F2']; 
        
        document.addEventListener('keydown', function(event) {
            adminKeySequence.push(event.key);
            
            // Mantém apenas os últimos 3 pressionamentos
            if (adminKeySequence.length > 3) {
                adminKeySequence.shift();
            }
            
            // Verifica se a sequência corresponde ao código secreto
            if (adminKeySequence.join(',') === ADMIN_SECRET_CODE.join(',')) {
                showAdminAccessButton();
                adminKeySequence = []; // Reseta a sequência
            }
        });

        function showAdminAccessButton() {
            const adminArea = document.getElementById('admin-access-area');
            adminArea.style.display = 'block';
            
            // Esconde automaticamente após 10 segundos por segurança
            setTimeout(() => {
                adminArea.style.display = 'none';
            }, 10000);
            
            console.log('🔓 Botão admin ativado - Disponível por 10 segundos');
        }

        function setupAdminAccess() {
            const statusBadge = document.getElementById('status-badge');
            
            if (statusBadge) {
                // Adicionar evento de clique múltiplo para acesso admin
                statusBadge.addEventListener('click', handleStatusBadgeClick);
                statusBadge.style.cursor = 'pointer';
            }
        }

        function handleStatusBadgeClick() {
            adminClickCount++;
            
            // Resetar o timer se já existir um
            if (adminClickTimer) {
                clearTimeout(adminClickTimer);
            }
            
            // Se for o terceiro clique rápido, abrir admin
            if (adminClickCount >= 3) {
                adminClickCount = 0;
                openAdminLogin();
                return;
            }
            
            // Timer para resetar a contagem após 1 segundo
            adminClickTimer = setTimeout(() => {
                adminClickCount = 0;
            }, 1000);
        }

        // Variáveis para clique múltiplo
        let adminClickCount = 0;
        let adminClickTimer = null;

        function openAdminLogin() {
            const password = prompt("🔐 Acesso Administrativo\n\nDigite a senha:");
            if (password === ADMIN_CONFIG.password) {
                openAdminPanel();
            } else if (password) {
                alert("❌ Senha incorreta!");
            }
        }

        function openAdminPanel() {
            document.getElementById('admin-panel').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Previne scroll na página principal
            loadAdminDashboard();
        }

        function closeAdmin() {
            if (ADMIN_CONFIG.hasUnsavedChanges) {
                if (!confirm('⚠️ Você tem alterações não salvas. Deseja realmente sair?')) {
                    return;
                }
            }
            
            document.getElementById('admin-panel').classList.add('hidden');
            document.body.style.overflow = 'auto'; // Restaura scroll
            ADMIN_CONFIG.editingProduct = null;
            ADMIN_CONFIG.currentCategory = null;
            ADMIN_CONFIG.hasUnsavedChanges = false;
        }

        // Funções de log e notificação
        function logAdminAction(action, details) {
            const log = {
                timestamp: new Date().toISOString(),
                action,
                details,
                user: 'Admin'
            };
            
            ADMIN_LOGS.unshift(log); // Adiciona no início
            
            // Mantém apenas os últimos 100 logs
            if (ADMIN_LOGS.length > 100) {
                ADMIN_LOGS.pop();
            }
            
            // Salva em localStorage para persistência
            localStorage.setItem('adminLogs', JSON.stringify(ADMIN_LOGS));
        }

        function showAdminNotification(message, type = 'info') {
            // Remove notificações existentes
            const existingNotifications = document.querySelectorAll('.admin-notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = `admin-notification admin-notification-${type}`;
            notification.innerHTML = `
                <div>${message}</div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; margin-left: 15px;">×</button>
            `;
            
            document.getElementById('admin-panel').appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        function showAdminLoading(message = 'Carregando...') {
            const loading = document.createElement('div');
            loading.className = 'admin-loading';
            loading.innerHTML = `
                <div class="admin-loading-content">
                    <div class="admin-loading-spinner"></div>
                    <div>${message}</div>
                </div>
            `;
            
            document.getElementById('admin-content').appendChild(loading);
            return loading;
        }

        function hideAdminLoading(loadingElement) {
            if (loadingElement) {
                loadingElement.classList.add('fade-out');
                setTimeout(() => loadingElement.remove(), 300);
            }
        }

        // Funções de cache
        function getCachedProducts() {
            const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos
            
            if (ADMIN_CACHE.products && 
                ADMIN_CACHE.timestamp && 
                (Date.now() - ADMIN_CACHE.timestamp < CACHE_DURATION)) {
                return ADMIN_CACHE.products;
            }
            
            // Recria o cache
            ADMIN_CACHE.products = config.menu.flatMap(cat => 
                cat.products.map(p => ({ ...p, category: cat.category }))
            );
            ADMIN_CACHE.timestamp = Date.now();
            
            return ADMIN_CACHE.products;
        }

        // Inicializar quando o DOM carregar
        document.addEventListener('DOMContentLoaded', function() {
            setupAdminAccess();
            
            // Teclas de atalho
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    const adminPanel = document.getElementById('admin-panel');
                    if (!adminPanel.classList.contains('hidden')) {
                        showAdminNotification('Use o botão de salvar no painel!', 'info');
                    }
                }
            });
            
            // Confirmação ao sair com alterações não salvas
            window.addEventListener('beforeunload', function(e) {
                if (ADMIN_CONFIG.hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = 'Você tem alterações não salvas. Deseja realmente sair?';
                }
            });
        });

        // ===================================================================================
        // =========================== DASHBOARD PROFISSIONAL ================================
        // ===================================================================================

        function loadAdminDashboard() {
            const adminContent = document.getElementById('admin-content');
            
            // Calcular estatísticas
            const totalProducts = getTotalProducts();
            const lowStockProducts = getLowStockProducts();
            const outOfStockProducts = getOutOfStockProducts();
            
            adminContent.innerHTML = `
                <!-- HEADER DO DASHBOARD -->
                <div style="margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); padding: 25px; border-radius: 12px; color: white; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin: 0 0 8px 0; font-size: 1.8rem;">Painel Administrativo</h2>
                                <p style="margin: 0; opacity: 0.9;">Gerencie sua loja de forma profissional</p>
                            </div>
                            <div style="text-align: right;">
                                <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Última atualização</p>
                                <p style="margin: 0; font-size: 1.1rem; font-weight: 600;">${new Date().toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CARDS DE ESTATÍSTICAS -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="admin-card">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: white; font-size: 1.5rem;">📦</span>
                            </div>
                            <div>
                                <p style="color: #6b7280; margin: 0 0 5px 0; font-size: 0.9rem;">Total de Produtos</p>
                                <h3 style="margin: 0; font-size: 1.8rem; color: #1f2937;">${totalProducts}</h3>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: white; font-size: 1.5rem;">📊</span>
                            </div>
                            <div>
                                <p style="color: #6b7280; margin: 0 0 5px 0; font-size: 0.9rem;">Categorias</p>
                                <h3 style="margin: 0; font-size: 1.8rem; color: #1f2937;">${config.menu.length}</h3>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: white; font-size: 1.5rem;">⚠️</span>
                            </div>
                            <div>
                                <p style="color: #6b7280; margin: 0 0 5px 0; font-size: 0.9rem;">Baixo Estoque</p>
                                <h3 style="margin: 0; font-size: 1.8rem; color: #f59e0b;">${lowStockProducts}</h3>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: white; font-size: 1.5rem;">⛔</span>
                            </div>
                            <div>
                                <p style="color: #6b7280; margin: 0 0 5px 0; font-size: 0.9rem;">Esgotados</p>
                                <h3 style="margin: 0; font-size: 1.8rem; color: #ef4444;">${outOfStockProducts}</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AÇÕES RÁPIDAS -->
                <div class="admin-card" style="margin-bottom: 30px;">
                    <h3 class="admin-section-title">⚡ Ações Rápidas</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button onclick="showAddProductForm()" class="btn-admin btn-admin-success">
                            <span style="font-size: 1.2rem;">➕</span>
                            <span>Novo Produto</span>
                        </button>
                        <button onclick="showAddCategoryForm()" class="btn-admin btn-admin-primary">
                            <span style="font-size: 1.2rem;">📁</span>
                            <span>Nova Categoria</span>
                        </button>
                        <button onclick="showQuickStockManagement()" class="btn-admin" style="background: #8b5cf6; color: white;">
                            <span style="font-size: 1.2rem;">📦</span>
                            <span>Gerenciar Estoque</span>
                        </button>
                        <button onclick="showReports()" class="btn-admin" style="background: #3b82f6; color: white;">
                            <span style="font-size: 1.2rem;">📊</span>
                            <span>Relatórios</span>
                        </button>
                        <button onclick="showBackupRestore()" class="btn-admin" style="background: #0ea5e9; color: white;">
                            <span style="font-size: 1.2rem;">💾</span>
                            <span>Backup</span>
                        </button>
                    </div>
                </div>

                <!-- PESQUISA AVANÇADA -->
<div class="admin-card" style="margin-bottom: 30px;">
    <h3 class="admin-section-title">🔍 Pesquisar por produto</h3>
    <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: end;">
        <div>
            <input type="text" id="admin-search-input" class="admin-form-input" 
                   placeholder="Pesquisar produtos, categorias, IDs...">
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="performAdminSearch()" class="btn-admin btn-admin-primary">
                 Pesquisar
            </button>
            <button onclick="showAdvancedFilters()" class="btn-admin btn-admin-secondary">
                ⚙️ Filtros
            </button>
        </div>
    </div>
    <!-- ADICIONE ESTA SEÇÃO DE FILTROS RÁPIDOS -->
    <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="checkbox" id="search-in-stock-admin" checked>
            <span style="font-size: 0.9rem;">Em estoque</span>
        </label>
        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="checkbox" id="search-out-of-stock-admin">
            <span style="font-size: 0.9rem;">Esgotados</span>
        </label>
        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
            <input type="checkbox" id="search-by-id-admin">
            <span style="font-size: 0.9rem;">Buscar por ID</span>
        </label>
    </div>
    <div id="admin-search-results" style="display: none; margin-top: 20px;"></div>
</div>

                <!-- GERENCIAMENTO POR CATEGORIAS -->
                <div class="admin-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="admin-section-title" style="margin: 0; border: none; padding: 0;">📦 Gerenciar Produtos</h3>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="showBulkActions()" class="btn-admin btn-admin-secondary">
                                📋 Ações em Massa
                            </button>
                            <button onclick="refreshProductList()" class="btn-admin btn-admin-secondary">
                                🔄 Atualizar
                            </button>
                        </div>
                    </div>
                    
                    ${renderCategoryTabsProfessional()}
                    <div id="products-management-area" style="margin-top: 20px;">
                        ${renderProductsManagementProfessional()}
                    </div>
                </div>
            `;
            
            // Configurar eventos
            setTimeout(() => {
                setupAdminSearchEventListeners();
            }, 100);
        }

        // Funções auxiliares para estatísticas
        function getLowStockProducts() {
            let count = 0;
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock && product.stock <= 10 && product.stock > 0) {
                        count++;
                    }
                });
            });
            return count;
        }

        function getOutOfStockProducts() {
            let count = 0;
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock === 0) {
                        count++;
                    }
                });
            });
            return count;
        }

        function getTotalStock() {
            let total = 0;
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock && product.stock > 0) {
                        total += product.stock;
                    }
                });
            });
            return total;
        }

        // ===================================================================================
        // =========================== FUNÇÕES DO DASHBOARD ==================================
        // ===================================================================================

        function renderCategoryTabsProfessional() {
            return `
                <div style="margin-bottom: 20px;">
                    <p style="color: #6b7280; margin-bottom: 10px;"><strong>Selecione uma categoria:</strong></p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${config.menu.map(category => `
                            <div style="position: relative; display: inline-block;">
                                <button onclick="selectAdminCategory('${category.category}')" 
                                    class="btn-admin ${ADMIN_CONFIG.currentCategory === category.category ? 'btn-admin-primary' : 'btn-admin-secondary'}"
                                    style="position: relative; padding-right: 30px;">
                                    ${category.category}
                                </button>
                                <button onclick="deleteCategoryWithProducts('${category.category}')" 
                                    style="position: absolute; top: -8px; right: -8px; 
                                           width: 24px; height: 24px; 
                                           background: #ef4444; color: white; 
                                           border: none; border-radius: 50%; 
                                           cursor: pointer; font-size: 12px;
                                           display: flex; align-items: center; justify-content: center;">
                                    ×
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    <p style="color: #6b7280; font-size: 0.8em; margin-top: 10px;">
                        💡 <strong>Nota:</strong> Clique no botão × para excluir categorias
                    </p>
                </div>
            `;
        }

        function selectAdminCategory(categoryName) {
            ADMIN_CONFIG.currentCategory = categoryName;
            loadAdminDashboard();
        }

        function renderProductsManagementProfessional() {
            if (!ADMIN_CONFIG.currentCategory && config.menu.length > 0) {
                ADMIN_CONFIG.currentCategory = config.menu[0].category;
            }
            
            const category = config.menu.find(cat => cat.category === ADMIN_CONFIG.currentCategory);
            if (!category) return '<p style="text-align: center; color: #6b7280;">Selecione uma categoria para gerenciar os produtos</p>';
            
            return `
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h4 style="margin: 0; color: #374151;">Produtos em "${category.category}"</h4>
                        <span style="color: #6b7280;">${category.products.length} produto(s)</span>
                    </div>
                    
                    <button onclick="showAddProductForm()" class="btn-admin btn-admin-success" style="margin-bottom: 20px;">
                        ➕ Adicionar Produto
                    </button>
                    
                    <div style="display: grid; gap: 15px;">
                        ${category.products.length > 0 ? 
                            category.products.map(product => `
                                <div style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 10px; display: flex; background: #fafafa; align-items: center;">
                                    <!-- IMAGEM DO PRODUTO -->
                                    <div style="width: 80px; height: 80px; margin-right: 15px; flex-shrink: 0;">
                                        <img src="${product.imageUrl || 'https://via.placeholder.com/80x80?text=Sem+Imagem'}" 
                                             alt="${product.name}"
                                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    </div>
                                    
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                            <strong style="font-size: 1.1em; color: #1f2937;">${product.name}</strong>
                                            <span class="admin-badge ${product.stock === 0 ? 'badge-danger' : product.stock <= 10 ? 'badge-warning' : 'badge-success'}">
                                                ${product.stock === 0 ? 'ESGOTADO' : product.stock <= 10 ? 'BAIXO' : 'OK'}
                                            </span>
                                            <span style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">
                                                ${formatPrice(product.newPrice)}
                                            </span>
                                            ${product.oldPrice ? `
                                                <span style="text-decoration: line-through; color: #6b7280; font-size: 0.9em;">
                                                    ${formatPrice(product.oldPrice)}
                                                </span>
                                            ` : ''}
                                        </div>
                                        <div style="color: #6b7280; font-size: 0.9em;">
                                            ID: ${product.id} 
                                            ${product.stock !== undefined ? `| Estoque: ${product.stock}` : ''}
                                            ${product.delivery ? `| ${product.delivery}` : ''}
                                        </div>
                                        ${product.description ? `
                                            <div style="color: #6b7280; font-size: 0.85em; margin-top: 5px;">
                                                ${product.description}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <button onclick="editProductAdmin(${product.id})" class="btn-admin btn-admin-primary" style="padding: 8px 15px;">
                                             Editar
                                        </button>
                                        <button onclick="deleteProductAdmin(${product.id})" class="btn-admin btn-admin-danger" style="padding: 8px 15px;">
                                             Excluir
                                        </button>
                                    </div>
                                </div>
                            `).join('') 
                        : 
                            '<div style="text-align: center; padding: 40px; color: #6b7280; background: #f9fafb; border-radius: 10px; border: 2px dashed #d1d5db;">Nenhum produto nesta categoria</div>'
                        }
                    </div>
                </div>
            `;
        }

        function refreshProductList() {
            ADMIN_CACHE.products = null; // Limpa cache
            loadAdminDashboard();
            showAdminNotification('Lista de produtos atualizada!', 'success');
        }

        // ===================================================================================
        // =========================== SISTEMA DE PESQUISA ADMIN =============================
        // ===================================================================================

        function performAdminSearch() {
    const searchTerm = document.getElementById('admin-search-input').value.trim().toLowerCase();
    const searchInStock = document.getElementById('search-in-stock-admin')?.checked || true;
    const searchOutOfStock = document.getElementById('search-out-of-stock-admin')?.checked || false;
    const searchById = document.getElementById('search-by-id-admin')?.checked || false;
    
    // Se nenhum filtro de estoque estiver marcado, pesquisar todos
    const showAllStock = !searchInStock && !searchOutOfStock;
    
    if (!searchTerm) {
        showAdminNotification('🔍 Digite algo para pesquisar!', 'warning');
        return;
    }
    
    const results = [];
    let searchCount = 0;
    
    // Pesquisar em todas as categorias
    config.menu.forEach(category => {
        category.products.forEach(product => {
            let matches = false;
            
            if (searchById && product.id.toString().includes(searchTerm)) {
                matches = true;
            } else if (!searchById && (
                product.name.toLowerCase().includes(searchTerm) ||
                (product.description && product.description.toLowerCase().includes(searchTerm)) ||
                category.category.toLowerCase().includes(searchTerm)
            )) {
                matches = true;
            }
            
            if (matches) {
                // Verificar filtro de estoque
                const hasStock = isProductAvailable(product);
                const stockFilterPassed = showAllStock || 
                    (searchInStock && hasStock) || 
                    (searchOutOfStock && !hasStock);
                
                if (stockFilterPassed) {
                    results.push({
                        category: category.category,
                        product: product
                    });
                }
                searchCount++;
            }
        });
    });
    
    displayAdminSearchResults(results, searchCount, searchTerm);
}

        function displayAdminSearchResults(results, totalCount, searchTerm) {
    const resultsContainer = document.getElementById('admin-search-results');
    const resultsContent = document.getElementById('admin-search-results-content') || (() => {
        const div = document.createElement('div');
        div.id = 'admin-search-results-content';
        resultsContainer.appendChild(div);
        return div;
    })();
    
    if (results.length === 0) {
        resultsContent.innerHTML = `
            <div style="text-align: center; padding: 30px; color: #666; background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 3em; margin-bottom: 10px;">🔍</div>
                <h4 style="color: #666; margin-bottom: 10px;">Nenhum produto encontrado</h4>
                <p>Tente usar outros termos de pesquisa ou ajustar os filtros aplicados.</p>
            </div>
        `;
    } else {
        resultsContent.innerHTML = `
            <div style="display: grid; gap: 12px;">
                ${results.map((result, index) => `
                    <div style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; background: white; display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <strong style="font-size: 1.1em; color: #1f2937;">${result.product.name}</strong>
                                <span class="admin-badge ${result.product.stock === 0 ? 'badge-danger' : result.product.stock <= 10 ? 'badge-warning' : 'badge-success'}">
                                    ${result.product.stock === 0 ? 'ESGOTADO' : result.product.stock <= 10 ? 'BAIXO' : 'OK'}
                                </span>
                                <span style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">
                                    ${formatPrice(result.product.newPrice)}
                                </span>
                                ${result.product.oldPrice ? `
                                    <span style="text-decoration: line-through; color: #6b7280; font-size: 0.9em;">
                                        ${formatPrice(result.product.oldPrice)}
                                    </span>
                                ` : ''}
                            </div>
                            <div style="color: #6b7280; font-size: 0.9em;">
                                <strong>Categoria:</strong> ${result.category} 
                                | <strong>ID:</strong> ${result.product.id}
                                ${result.product.stock !== undefined ? `| <strong>Estoque:</strong> ${result.product.stock}` : '| <strong>Estoque:</strong> Sem limite'}
                            </div>
                            ${result.product.description ? `
                                <div style="color: #6b7280; font-size: 0.85em; margin-top: 5px; font-style: italic;">
                                    "${result.product.description}"
                                </div>
                            ` : ''}
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="editProductFromAdminSearch(${result.product.id})" 
                                    class="btn-admin btn-admin-primary" style="padding: 8px 12px;">
                                 Editar
                            </button>
                            <button onclick="viewProductInCategoryAdmin('${result.category}', ${result.product.id})" 
                                    class="btn-admin" style="background: #8b5cf6; color: white; padding: 8px 12px;">
                                Ver
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    resultsContainer.style.display = 'block';
    
    // Mostrar estatísticas
    const statsElement = document.getElementById('admin-search-stats') || (() => {
        const div = document.createElement('div');
        div.id = 'admin-search-stats';
        div.style.marginTop = '10px';
        div.style.fontSize = '0.9em';
        resultsContainer.appendChild(div);
        return div;
    })();
    
    statsElement.innerHTML = results.length === 0 ? 
        `❌ Nenhum resultado encontrado para "${searchTerm}"` : 
        `✅ Encontrados ${results.length} de ${totalCount} produtos para "${searchTerm}"`;
    
    // Scroll suave para os resultados
    resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

        function editProductFromAdminSearch(productId) {
            // Fechar resultados da pesquisa
            document.getElementById('admin-search-results').style.display = 'none';
            
            // Encontrar a categoria do produto
            let productCategory = null;
            for (const category of config.menu) {
                const product = category.products.find(p => p.id === productId);
                if (product) {
                    productCategory = category.category;
                    break;
                }
            }
            
            if (productCategory) {
                // Selecionar a categoria e editar o produto
                selectAdminCategory(productCategory);
                setTimeout(() => {
                    editProductAdmin(productId);
                }, 100);
            } else {
                showAdminNotification('❌ Produto não encontrado!', 'error');
            }
        }

        function viewProductInCategoryAdmin(categoryName, productId) {
            // Fechar resultados da pesquisa
            document.getElementById('admin-search-results').style.display = 'none';
            
            // Selecionar a categoria
            selectAdminCategory(categoryName);
            
            // Scroll para o produto na lista
            setTimeout(() => {
                const productElement = document.querySelector(`[onclick="editProductAdmin(${productId})"]`);
                if (productElement) {
                    productElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Destacar o produto
                    const productCard = productElement.closest('div[style*="border: 1px solid #e5e7eb"]');
                    if (productCard) {
                        const originalBorder = productCard.style.border;
                        productCard.style.border = '2px solid #ff9800';
                        productCard.style.boxShadow = '0 0 10px rgba(255, 152, 0, 0.3)';
                        
                        setTimeout(() => {
                            productCard.style.border = originalBorder;
                            productCard.style.boxShadow = 'none';
                        }, 3000);
                    }
                }
            }, 200);
        }

        function setupAdminSearchEventListeners() {
            const searchInput = document.getElementById('admin-search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performAdminSearch();
                    }
                });
            }
        }

        function showAdvancedFilters() {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">⚙️ Filtros Avançados</h3>
                    
                    <div style="display: grid; gap: 20px;">
                        <!-- FILTRO POR ESTOQUE -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">📦 Filtro por Estoque</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <label class="admin-form-label">Estoque Mínimo</label>
                                    <input type="number" id="filter-stock-min" class="admin-form-input" placeholder="Mínimo">
                                </div>
                                <div>
                                    <label class="admin-form-label">Estoque Máximo</label>
                                    <input type="number" id="filter-stock-max" class="admin-form-input" placeholder="Máximo">
                                </div>
                                <div>
                                    <label class="admin-form-label">Status</label>
                                    <select id="filter-stock-status" class="admin-form-input">
                                        <option value="">Todos</option>
                                        <option value="in_stock">Em estoque</option>
                                        <option value="low_stock">Baixo estoque (≤ 10)</option>
                                        <option value="out_of_stock">Esgotado</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FILTRO POR PREÇO -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">💰 Filtro por Preço</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <label class="admin-form-label">Preço Mínimo (R$)</label>
                                    <input type="number" step="0.01" id="filter-price-min" class="admin-form-input" placeholder="Mínimo">
                                </div>
                                <div>
                                    <label class="admin-form-label">Preço Máximo (R$)</label>
                                    <input type="number" step="0.01" id="filter-price-max" class="admin-form-input" placeholder="Máximo">
                                </div>
                                <div>
                                    <label class="admin-form-label">Em Promoção</label>
                                    <select id="filter-on-sale" class="admin-form-input">
                                        <option value="">Todos</option>
                                        <option value="yes">Sim</option>
                                        <option value="no">Não</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FILTRO POR CATEGORIA -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">📁 Filtro por Categoria</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                ${config.menu.map(category => `
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px;">
                                        <input type="checkbox" name="category-filter" value="${category.category}">
                                        ${category.category}
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button onclick="applyAdvancedFilters()" class="btn-admin btn-admin-primary">
                            🔍 Aplicar Filtros
                        </button>
                        <button onclick="clearAdvancedFilters()" class="btn-admin btn-admin-secondary">
                            🧹 Limpar Filtros
                        </button>
                        <button onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary" style="margin-left: auto;">
                            ↩️ Voltar
                        </button>
                    </div>
                </div>
            `;
        }

        function applyAdvancedFilters() {
            // Implementar lógica de filtros avançados
            showAdminNotification('Funcionalidade de filtros avançados em desenvolvimento!', 'info');
        }

        function clearAdvancedFilters() {
            // Limpar todos os filtros
            showAdminNotification('Filtros limpos!', 'success');
            setTimeout(() => loadAdminDashboard(), 1000);
        }

        // ===================================================================================
        // =========================== GESTÃO DE PRODUTOS ====================================
        // ===================================================================================

        function showAddProductForm() {
            const category = config.menu.find(cat => cat.category === ADMIN_CONFIG.currentCategory);
            if (!category) {
                showAdminNotification('Selecione uma categoria primeiro!', 'warning');
                return;
            }
            
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">➕ Adicionar Novo Produto</h3>
                    <form onsubmit="saveNewProduct(event)" style="display: grid; gap: 20px;">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Nome do Produto:</label>
                            <input type="text" id="product-name" class="admin-form-input" required>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="admin-form-group">
                                <label class="admin-form-label">Preço Atual (R$):</label>
                                <input type="number" id="product-newPrice" step="0.01" class="admin-form-input" required>
                            </div>
                            <div class="admin-form-group">
                                <label class="admin-form-label">Preço Antigo (opcional):</label>
                                <input type="number" id="product-oldPrice" step="0.01" class="admin-form-input">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="admin-form-group">
                                <label class="admin-form-label">URL da Imagem:</label>
                                <input type="text" id="product-imageUrl" class="admin-form-input" placeholder="https://...">
                            </div>
                            <div class="admin-form-group">
                                <label class="admin-form-label">Estoque:</label>
                                <input type="number" id="product-stock" class="admin-form-input">
                            </div>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Descrição:</label>
                            <textarea id="product-description" class="admin-form-input" style="height: 100px; resize: vertical;"></textarea>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Entrega:</label>
                            <input type="text" id="product-delivery" class="admin-form-input" placeholder="Entrega grátis">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn-admin btn-admin-success">
                                💾 Salvar Produto
                            </button>
                            <button type="button" onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary">
                                ↩️ Voltar
                            </button>
                        </div>
                    </form>
                </div>
            `;
        }

        async function saveNewProduct(event) {
            event.preventDefault();
            
            const category = config.menu.find(cat => cat.category === ADMIN_CONFIG.currentCategory);
            if (!category) return;
            
            const newProduct = {
                id: generateProductId(),
                name: document.getElementById('product-name').value,
                newPrice: parseFloat(document.getElementById('product-newPrice').value),
                oldPrice: document.getElementById('product-oldPrice').value ? parseFloat(document.getElementById('product-oldPrice').value) : null,
                imageUrl: document.getElementById('product-imageUrl').value || "https://via.placeholder.com/300x200?text=Produto",
                description: document.getElementById('product-description').value || "",
                delivery: document.getElementById('product-delivery').value || "Entrega grátis",
                stock: document.getElementById('product-stock').value ? parseInt(document.getElementById('product-stock').value) : null,
                accompaniments: { limit: 0, options: [] },
                drinks: { limit: 0, options: [] }
            };
            
            // Garantir que não há campos undefined
            Object.keys(newProduct).forEach(key => {
                if (newProduct[key] === undefined) {
                    newProduct[key] = null;
                }
            });
            
            category.products.push(newProduct);
            
            // Log da ação
            logAdminAction('ADD_PRODUCT', {
                productId: newProduct.id,
                productName: newProduct.name,
                category: category.category
            });
            
            // Salva no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification('✅ Produto adicionado com sucesso!', 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
                loadAdminDashboard();
            }
        }

        function generateProductId() {
            return Math.max(...config.menu.flatMap(cat => cat.products.map(p => p.id)), 0) + 1;
        }

        function editProductAdmin(productId) {
            const product = findProductById(productId);
            if (!product) return;
            
            ADMIN_CONFIG.editingProduct = product;
            showEditProductForm(product);
        }

        function showEditProductForm(product) {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div style="width: 100%;">
                    <h3 class="admin-section-title">✏️ Editar Produto: ${product.name}</h3>
                    
                    <div class="product-edit-layout" style="display: grid; grid-template-columns: 1fr; gap: 20px; align-items: start;">
                        
                        <!-- INFORMAÇÕES BÁSICAS -->
                        <div class="admin-card">
                            <h4 style="color: #374151; margin-top: 0; border-bottom: 2px solid #f97316; padding-bottom: 10px;">📋 Informações Básicas</h4>
                            
                            <form onsubmit="saveEditedProduct(event)" style="display: grid; gap: 15px;">
                                <input type="hidden" id="edit-product-id" value="${product.id}">
                                
                                <div class="form-grid" style="display: grid; gap: 15px;">
                                    <div class="admin-form-group">
                                        <label class="admin-form-label">Nome do Produto:</label>
                                        <input type="text" id="edit-product-name" value="${product.name}" class="admin-form-input" required>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                        <div class="admin-form-group">
                                            <label class="admin-form-label">Preço Atual (R$):</label>
                                            <input type="number" id="edit-product-newPrice" step="0.01" value="${product.newPrice}" class="admin-form-input" required>
                                        </div>
                                        <div class="admin-form-group">
                                            <label class="admin-form-label">Preço Antigo:</label>
                                            <input type="number" id="edit-product-oldPrice" step="0.01" value="${product.oldPrice || ''}" class="admin-form-input">
                                        </div>
                                    </div>
                                    
                                    <div class="admin-form-group">
                                        <label class="admin-form-label">URL da Imagem:</label>
                                        <input type="text" id="edit-product-imageUrl" value="${product.imageUrl}" class="admin-form-input">
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                        <div class="admin-form-group">
                                            <label class="admin-form-label">Estoque:</label>
                                            <input type="number" id="edit-product-stock" value="${product.stock || ''}" class="admin-form-input">
                                        </div>
                                        <div class="admin-form-group">
                                            <label class="admin-form-label">Entrega:</label>
                                            <input type="text" id="edit-product-delivery" value="${product.delivery || ''}" class="admin-form-input">
                                        </div>
                                    </div>
                                    
                                    <div class="admin-form-group">
                                        <label class="admin-form-label">Descrição:</label>
                                        <textarea id="edit-product-description" class="admin-form-input" style="height: 100px; resize: vertical;">${product.description || ''}</textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <!-- ACOMPANHAMENTOS -->
                        <div class="admin-card">
                            <h4 style="color: #374151; margin-top: 0; border-bottom: 2px solid #f97316; padding-bottom: 10px;">🍽️ Acompanhamentos</h4>
                            
                            <div class="admin-form-group">
                                <label class="admin-form-label">Limite de Acompanhamentos:</label>
                                <input type="number" id="edit-product-accomp-limit" value="${product.accompaniments?.limit || 0}" min="0" class="admin-form-input">
                            </div>
                            
                            <button type="button" onclick="addAccompanimentOption()" class="btn-admin btn-admin-primary" style="margin-bottom: 15px;">
                                ➕ Adicionar Acompanhamento
                            </button>
                            
                            <div id="edit-accompaniments-options" style="max-height: 300px; overflow-y: auto; display: grid; gap: 12px;">
                                ${product.accompaniments?.options?.map((option, index) => `
                                    <div class="accompaniment-option" style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                                            <div class="admin-form-group">
                                                <label class="admin-form-label">Nome:</label>
                                                <input type="text" value="${option.name}" class="accomp-name admin-form-input">
                                            </div>
                                            <div class="admin-form-group">
                                                <label class="admin-form-label">Preço (R$):</label>
                                                <input type="number" step="0.01" value="${option.price}" class="accomp-price admin-form-input">
                                            </div>
                                            <button type="button" onclick="removeAccompanimentOption(this)" class="btn-admin btn-admin-danger">
                                                🗑️
                                            </button>
                                        </div>
                                    </div>
                                `).join('') || ''}
                            </div>
                        </div>
                        
                        <!-- BEBIDAS -->
                        <div class="admin-card">
                            <h4 style="color: #374151; margin-top: 0; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">🥤 Bebidas</h4>
                            
                            <div class="admin-form-group">
                                <label class="admin-form-label">Limite de Bebidas:</label>
                                <input type="number" id="edit-product-drinks-limit" value="${product.drinks?.limit || 0}" min="0" class="admin-form-input">
                            </div>
                            
                            <button type="button" onclick="addDrinkOption()" class="btn-admin" style="background: #3b82f6; color: white; margin-bottom: 15px;">
                                ➕ Adicionar Bebida
                            </button>
                            
                            <div id="edit-drinks-options" style="max-height: 300px; overflow-y: auto; display: grid; gap: 12px;">
                                ${product.drinks?.options?.map((drink, index) => `
                                    <div class="drink-option" style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                                            <div class="admin-form-group">
                                                <label class="admin-form-label">Nome:</label>
                                                <input type="text" value="${drink.name}" class="drink-name admin-form-input">
                                            </div>
                                            <div class="admin-form-group">
                                                <label class="admin-form-label">Preço (R$):</label>
                                                <input type="number" step="0.01" value="${drink.price}" class="drink-price admin-form-input">
                                            </div>
                                            <button type="button" onclick="removeDrinkOption(this)" class="btn-admin btn-admin-danger">
                                                🗑️
                                            </button>
                                        </div>
                                    </div>
                                `).join('') || ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- BOTÕES DE AÇÃO -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; display: flex; gap: 15px; justify-content: center;">
                        <button type="submit" onclick="document.querySelector('form').requestSubmit()" class="btn-admin btn-admin-success" style="padding: 15px 25px;">
                            💾 Salvar
                        </button>
                        <button type="button" onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary" style="padding: 15px 25px;">
                            ↩️ Voltar
                        </button>
                    </div>
                </div>
            `;
        }

        function addAccompanimentOption() {
            const container = document.getElementById('edit-accompaniments-options');
            const newOption = document.createElement('div');
            newOption.className = 'accompaniment-option';
            newOption.innerHTML = `
                <div style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Nome:</label>
                            <input type="text" class="accomp-name admin-form-input" placeholder="Ex: Quantidade, Molho...">
                        </div>
                        <div class="admin-form-group">
                            <label class="admin-form-label">Preço (R$):</label>
                            <input type="number" step="0.01" value="0" class="accomp-price admin-form-input">
                        </div>
                        <button type="button" onclick="removeAccompanimentOption(this)" class="btn-admin btn-admin-danger">
                            🗑️
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(newOption);
        }

        function addDrinkOption() {
            const container = document.getElementById('edit-drinks-options');
            const newOption = document.createElement('div');
            newOption.className = 'drink-option';
            newOption.innerHTML = `
                <div style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Nome:</label>
                            <input type="text" class="drink-name admin-form-input" placeholder="Ex: Refrigerante, Suco...">
                        </div>
                        <div class="admin-form-group">
                            <label class="admin-form-label">Preço (R$):</label>
                            <input type="number" step="0.01" value="0" class="drink-price admin-form-input">
                        </div>
                        <button type="button" onclick="removeDrinkOption(this)" class="btn-admin btn-admin-danger">
                            🗑️
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(newOption);
        }

        function removeAccompanimentOption(button) {
            button.closest('.accompaniment-option').remove();
        }

        function removeDrinkOption(button) {
            button.closest('.drink-option').remove();
        }

        async function saveEditedProduct(event) {
            event.preventDefault();
            
            const productId = parseInt(document.getElementById('edit-product-id').value);
            
            // Encontrar o produto na configuração
            let targetProduct = null;
            let targetCategory = null;
            
            for (let category of config.menu) {
                const product = category.products.find(p => p.id === productId);
                if (product) {
                    targetProduct = product;
                    targetCategory = category;
                    break;
                }
            }
            
            if (!targetProduct) {
                showAdminNotification('❌ Produto não encontrado!', 'error');
                return;
            }
            
            // Coletar dados do formulário
            const updatedProduct = {
                id: productId,
                name: document.getElementById('edit-product-name').value,
                newPrice: parseFloat(document.getElementById('edit-product-newPrice').value),
                oldPrice: document.getElementById('edit-product-oldPrice').value ? parseFloat(document.getElementById('edit-product-oldPrice').value) : null,
                imageUrl: document.getElementById('edit-product-imageUrl').value || "https://via.placeholder.com/300x200?text=Produto",
                description: document.getElementById('edit-product-description').value,
                delivery: document.getElementById('edit-product-delivery').value || "Entrega grátis",
                stock: document.getElementById('edit-product-stock').value ? parseInt(document.getElementById('edit-product-stock').value) : null,
                accompaniments: {
                    limit: parseInt(document.getElementById('edit-product-accomp-limit').value) || 0,
                    options: []
                },
                drinks: {
                    limit: parseInt(document.getElementById('edit-product-drinks-limit').value) || 0,
                    options: []
                }
            };
            
            // Coletar acompanhamentos
            const accompanimentOptions = document.querySelectorAll('.accompaniment-option');
            accompanimentOptions.forEach(option => {
                const name = option.querySelector('.accomp-name').value;
                const price = parseFloat(option.querySelector('.accomp-price').value);
                
                if (name.trim()) {
                    updatedProduct.accompaniments.options.push({
                        name: name.trim(),
                        price: price
                    });
                }
            });
            
            // Coletar bebidas
            const drinkOptions = document.querySelectorAll('.drink-option');
            drinkOptions.forEach(option => {
                const name = option.querySelector('.drink-name').value;
                const price = parseFloat(option.querySelector('.drink-price').value);
                
                if (name.trim()) {
                    updatedProduct.drinks.options.push({
                        name: name.trim(),
                        price: price
                    });
                }
            });
            
            // Atualizar o produto na configuração
            Object.assign(targetProduct, updatedProduct);
            
            // Log da ação
            logAdminAction('UPDATE_PRODUCT', {
                productId: productId,
                productName: updatedProduct.name,
                category: targetCategory.category
            });
            
            // Salvar no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification('✅ Produto atualizado com sucesso!', 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
                loadAdminDashboard();
            }
        }

        async function deleteProductAdmin(productId) {
            if (!confirm('❌ Tem certeza que deseja excluir este produto?')) return;
            
            let productName = '';
            let categoryName = '';
            
            for (let category of config.menu) {
                const index = category.products.findIndex(p => p.id === productId);
                if (index !== -1) {
                    productName = category.products[index].name;
                    categoryName = category.category;
                    category.products.splice(index, 1);
                    break;
                }
            }
            
            // Log da ação
            logAdminAction('DELETE_PRODUCT', {
                productId: productId,
                productName: productName,
                category: categoryName
            });
            
            // Salva no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification('✅ Produto excluído com sucesso!', 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
                loadAdminDashboard();
            }
        }

        // ===================================================================================
        // =========================== GESTÃO DE CATEGORIAS ==================================
        // ===================================================================================

        function showAddCategoryForm() {
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">📁 Nova Categoria</h3>
                    <form onsubmit="saveNewCategory(event)" style="display: grid; gap: 20px;">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Nome da Categoria:</label>
                            <input type="text" id="category-name" class="admin-form-input" required placeholder="Ex: Salgados, Doces, Bebidas...">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn-admin btn-admin-success">
                                💾 Criar Categoria
                            </button>
                            <button type="button" onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary">
                                ↩️ Voltar
                            </button>
                        </div>
                    </form>
                </div>
            `;
        }

        async function saveNewCategory(event) {
            event.preventDefault();
            const categoryName = document.getElementById('category-name').value.trim();
            
            if (!categoryName) {
                showAdminNotification('Por favor, digite um nome para a categoria.', 'warning');
                return;
            }
            
            // Verificar se categoria já existe
            if (config.menu.find(cat => cat.category.toLowerCase() === categoryName.toLowerCase())) {
                showAdminNotification('❌ Esta categoria já existe!', 'error');
                return;
            }
            
            config.menu.push({
                category: categoryName,
                products: []
            });
            
            // Log da ação
            logAdminAction('ADD_CATEGORY', {
                categoryName: categoryName
            });
            
            // Salva no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification('✅ Categoria criada com sucesso!', 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
                loadAdminDashboard();
            }
        }

        async function deleteCategoryWithProducts(categoryName) {
            const categoryIndex = config.menu.findIndex(cat => cat.category === categoryName);
            
            if (categoryIndex === -1) {
                showAdminNotification('❌ Categoria não encontrada!', 'error');
                return;
            }
            
            const category = config.menu[categoryIndex];
            
            if (category.products.length === 0) {
                // Se estiver vazia, usa a função normal
                await deleteCategory(categoryName);
                return;
            }
            
            // Para categorias com produtos, oferecer opção de mover ou excluir tudo
            const action = confirm(`⚠️ A categoria "${categoryName}" contém ${category.products.length} produto(s).\n\nClique em "OK" para mover os produtos para outra categoria, ou "Cancelar" para excluir a categoria e TODOS os produtos.`);
            
            if (action) {
                // Mover produtos
                showMoveProductsDialog(categoryName);
            } else {
                // Excluir categoria com todos os produtos
                if (confirm(`🚨 ATENÇÃO: Isso excluirá permanentemente a categoria "${categoryName}" e TODOS os ${category.products.length} produto(s) nela contidos.\n\nTem certeza?`)) {
                    config.menu.splice(categoryIndex, 1);
                    
                    if (ADMIN_CONFIG.currentCategory === categoryName) {
                        ADMIN_CONFIG.currentCategory = config.menu.length > 0 ? config.menu[0].category : null;
                    }
                    
                    // Log da ação
                    logAdminAction('DELETE_CATEGORY_WITH_PRODUCTS', {
                        categoryName: categoryName,
                        productsDeleted: category.products.length
                    });
                    
                    const success = await saveConfigToFirebase();
                    if (success) {
                        showAdminNotification('✅ Categoria e produtos excluídos com sucesso!', 'success');
                        ADMIN_CONFIG.hasUnsavedChanges = true;
                        loadAdminDashboard();
                    }
                }
            }
        }

        async function deleteCategory(categoryName) {
            // Encontrar a categoria
            const categoryIndex = config.menu.findIndex(cat => cat.category === categoryName);
            
            if (categoryIndex === -1) {
                showAdminNotification('❌ Categoria não encontrada!', 'error');
                return;
            }
            
            const category = config.menu[categoryIndex];
            
            // Verificar se a categoria está vazia
            if (category.products.length > 0) {
                showAdminNotification('❌ Não é possível excluir categorias que contêm produtos!\n\nPor favor, remova ou mova todos os produtos antes de excluir a categoria.', 'error');
                return;
            }
            
            if (!confirm(`🗑️ Tem certeza que deseja excluir a categoria "${categoryName}"?`)) {
                return;
            }
            
            // Remover a categoria
            config.menu.splice(categoryIndex, 1);
            
            // Atualizar a categoria selecionada se necessário
            if (ADMIN_CONFIG.currentCategory === categoryName) {
                ADMIN_CONFIG.currentCategory = config.menu.length > 0 ? config.menu[0].category : null;
            }
            
            // Log da ação
            logAdminAction('DELETE_CATEGORY', {
                categoryName: categoryName
            });
            
            // Salvar no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification('✅ Categoria excluída com sucesso!', 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
                loadAdminDashboard();
            }
        }

        function showMoveProductsDialog(fromCategoryName) {
            const fromCategory = config.menu.find(cat => cat.category === fromCategoryName);
            const otherCategories = config.menu.filter(cat => cat.category !== fromCategoryName);
            
            if (otherCategories.length === 0) {
                showAdminNotification('❌ Não há outras categorias para mover os produtos! Crie uma nova categoria primeiro.', 'error');
                return;
            }
            
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">📦 Mover Produtos</h3>
                    <p>Movendo ${fromCategory.products.length} produto(s) da categoria <strong>"${fromCategoryName}"</strong></p>
                    
                    <div class="admin-form-group" style="margin: 20px 0;">
                        <label class="admin-form-label">Selecione a categoria de destino:</label>
                        <select id="target-category" class="admin-form-input">
                            ${otherCategories.map(cat => `
                                <option value="${cat.category}">${cat.category}</option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>Produtos que serão movidos:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            ${fromCategory.products.map(product => `<li>${product.name}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="moveProducts('${fromCategoryName}')" class="btn-admin btn-admin-success">
                            ✅ Mover Produtos
                        </button>
                        <button onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary">
                            ↩️ Cancelar
                        </button>
                    </div>
                </div>
            `;
        }

        async function moveProducts(fromCategoryName) {
            const targetCategoryName = document.getElementById('target-category').value;
            const fromCategoryIndex = config.menu.findIndex(cat => cat.category === fromCategoryName);
            const targetCategory = config.menu.find(cat => cat.category === targetCategoryName);
            
            if (!targetCategory) {
                showAdminNotification('❌ Categoria de destino não encontrada!', 'error');
                return;
            }
            
            // Mover todos os produtos
            const productsToMove = [...config.menu[fromCategoryIndex].products];
            targetCategory.products.push(...productsToMove);
            
            // Limpar a categoria original
            config.menu[fromCategoryIndex].products = [];
            
            // Log da ação
            logAdminAction('MOVE_PRODUCTS', {
                fromCategory: fromCategoryName,
                toCategory: targetCategoryName,
                productsMoved: productsToMove.length
            });
            
            // Agora excluir a categoria vazia
            await deleteCategory(fromCategoryName);
        }

        // ===================================================================================
        // =========================== GESTÃO DE ESTOQUE =====================================
        // ===================================================================================

        function showQuickStockManagement() {
            const adminContent = document.getElementById('admin-content');
            
            // Coletar produtos com estoque baixo ou esgotado
            const lowStock = [];
            const outOfStock = [];
            
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock !== undefined && product.stock !== null) {
                        if (product.stock === 0) {
                            outOfStock.push({ ...product, category: category.category });
                        } else if (product.stock <= 10) {
                            lowStock.push({ ...product, category: category.category });
                        }
                    }
                });
            });
            
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">📊 Gestão de Estoque</h3>
                    
                    <!-- RESUMO -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 20px; border-radius: 10px; color: white;">
                            <h4 style="margin: 0 0 10px 0; font-size: 1rem;">Baixo Estoque</h4>
                            <p style="margin: 0; font-size: 2rem; font-weight: bold;">${lowStock.length}</p>
                            <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Produtos com ≤ 10 unidades</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 20px; border-radius: 10px; color: white;">
                            <h4 style="margin: 0 0 10px 0; font-size: 1rem;">Esgotados</h4>
                            <p style="margin: 0; font-size: 2rem; font-weight: bold;">${outOfStock.length}</p>
                            <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Produtos sem estoque</p>
                        </div>
                    </div>
                    
                    <!-- LISTA DE PRODUTOS COM BAIXO ESTOQUE -->
                    ${lowStock.length > 0 ? `
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: #f59e0b; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                ⚠️ Produtos com Baixo Estoque
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${lowStock.map(product => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px;">
                                        <div>
                                            <strong style="color: #92400e;">${product.name}</strong>
                                            <div style="font-size: 0.85rem; color: #92400e;">
                                                Categoria: ${product.category} | Estoque: ${product.stock} unidades
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            <input type="number" value="${product.stock}" 
                                                   onchange="updateStockSingle(${product.id}, this.value)"
                                                   class="admin-form-input" style="width: 100px; padding: 6px 10px;">
                                            <button onclick="quickReplenishStock(${product.id})" 
                                                    class="btn-admin btn-admin-success" style="padding: 6px 12px;">
                                                +10
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- LISTA DE PRODUTOS ESGOTADOS -->
                    ${outOfStock.length > 0 ? `
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: #ef4444; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                ⛔ Produtos Esgotados
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${outOfStock.map(product => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px;">
                                        <div>
                                            <strong style="color: #991b1b;">${product.name}</strong>
                                            <div style="font-size: 0.85rem; color: #991b1b;">
                                                Categoria: ${product.category}
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            <input type="number" value="0" 
                                                   onchange="updateStockSingle(${product.id}, this.value)"
                                                   class="admin-form-input" style="width: 100px; padding: 6px 10px;">
                                            <button onclick="quickReplenishStock(${product.id})" 
                                                    class="btn-admin btn-admin-success" style="padding: 6px 12px;">
                                                Repor
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="replenishAllLowStock()" class="btn-admin btn-admin-success">
                            📈 Repor Todos Baixos
                        </button>
                        <button onclick="showBulkStockUpdate()" class="btn-admin btn-admin-primary">
                            📋 Atualização em Massa
                        </button>
                        <button onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary" style="margin-left: auto;">
                            ↩️ Voltar ao Dashboard
                        </button>
                    </div>
                </div>
            `;
        }

        async function updateStockSingle(productId, newStock) {
            const product = findProductById(productId);
            if (!product) return;
            
            product.stock = parseInt(newStock) || 0;
            
            // Log da ação
            logAdminAction('UPDATE_STOCK_SINGLE', {
                productId: productId,
                productName: product.name,
                oldStock: product.stock,
                newStock: newStock
            });
            
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification(`✅ Estoque de ${product.name} atualizado para ${newStock}`, 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
            }
        }

        async function quickReplenishStock(productId) {
            const product = findProductById(productId);
            if (!product) return;
            
            const currentStock = product.stock || 0;
            product.stock = currentStock + 10;
            
            // Log da ação
            logAdminAction('REPLENISH_STOCK', {
                productId: productId,
                productName: product.name,
                oldStock: currentStock,
                newStock: product.stock
            });
            
            const success = await saveConfigToFirebase();
            if (success) {
                showAdminNotification(`✅ Estoque de ${product.name} reposto (+10)`, 'success');
                ADMIN_CONFIG.hasUnsavedChanges = true;
                showQuickStockManagement(); // Recarrega a página
            }
        }

        async function replenishAllLowStock() {
            let updatedCount = 0;
            
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock !== undefined && product.stock !== null && product.stock <= 10) {
                        const oldStock = product.stock;
                        product.stock = Math.max(20, product.stock + 10); // Garante no mínimo 20
                        updatedCount++;
                        
                        // Log individual
                        logAdminAction('REPLENISH_STOCK_BULK', {
                            productId: product.id,
                            productName: product.name,
                            oldStock: oldStock,
                            newStock: product.stock
                        });
                    }
                });
            });
            
            if (updatedCount > 0) {
                const success = await saveConfigToFirebase();
                if (success) {
                    showAdminNotification(`✅ ${updatedCount} produtos tiveram estoque reposto!`, 'success');
                    ADMIN_CONFIG.hasUnsavedChanges = true;
                    showQuickStockManagement(); // Recarrega a página
                }
            } else {
                showAdminNotification('ℹ️ Nenhum produto com estoque baixo encontrado.', 'info');
            }
        }

        function showBulkStockUpdate() {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">📋 Atualização de Estoque em Massa</h3>
                    
                    <div style="display: grid; gap: 20px;">
                        <!-- AÇÃO EM MASSA -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">⚡ Ação em Massa</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Adicionar/Remover</label>
                                    <input type="number" id="bulk-stock-change" class="admin-form-input" placeholder="Ex: +5 ou -3">
                                </div>
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Definir como</label>
                                    <input type="number" id="bulk-stock-set" class="admin-form-input" placeholder="Valor fixo">
                                </div>
                            </div>
                        </div>
                        
                        <!-- FILTROS -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">🎯 Aplicar a</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px;">
                                    <input type="checkbox" id="apply-all" checked> Todos os produtos
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px;">
                                    <input type="checkbox" id="apply-low-stock"> Apenas baixo estoque
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px;">
                                    <input type="checkbox" id="apply-out-of-stock"> Apenas esgotados
                                </label>
                            </div>
                        </div>
                        
                        <!-- PRÉVIA -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">📊 Prévia da Ação</h4>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                <p id="bulk-action-preview">Selecione uma ação para ver a prévia...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button onclick="applyBulkStockAction()" class="btn-admin btn-admin-success">
                            ✅ Aplicar Ação
                        </button>
                        <button onclick="showQuickStockManagement()" class="btn-admin btn-admin-secondary">
                            ↩️ Voltar
                        </button>
                    </div>
                </div>
            `;
            
            // Atualizar prévia quando os valores mudarem
            ['bulk-stock-change', 'bulk-stock-set', 'apply-all', 'apply-low-stock', 'apply-out-of-stock'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', updateBulkActionPreview);
                }
            });
        }

        function updateBulkActionPreview() {
            const change = document.getElementById('bulk-stock-change').value;
            const set = document.getElementById('bulk-stock-set').value;
            const applyAll = document.getElementById('apply-all').checked;
            const applyLowStock = document.getElementById('apply-low-stock').checked;
            const applyOutOfStock = document.getElementById('apply-out-of-stock').checked;
            
            let actionText = '';
            let productCount = 0;
            
            if (change) {
                actionText = `Adicionar ${change} unidades`;
            } else if (set) {
                actionText = `Definir estoque como ${set} unidades`;
            }
            
            // Calcular quantos produtos serão afetados
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock !== undefined && product.stock !== null) {
                        let include = false;
                        
                        if (applyAll) include = true;
                        if (applyLowStock && product.stock <= 10 && product.stock > 0) include = true;
                        if (applyOutOfStock && product.stock === 0) include = true;
                        
                        if (include) productCount++;
                    }
                });
            });
            
            const preview = document.getElementById('bulk-action-preview');
            if (actionText) {
                preview.innerHTML = `
                    <strong>Ação:</strong> ${actionText}<br>
                    <strong>Produtos afetados:</strong> ${productCount}<br>
                    <strong>Filtros:</strong> ${applyAll ? 'Todos' : ''} ${applyLowStock ? 'Baixo estoque' : ''} ${applyOutOfStock ? 'Esgotados' : ''}
                `;
            } else {
                preview.textContent = 'Selecione uma ação para ver a prévia...';
            }
        }

        async function applyBulkStockAction() {
            const change = document.getElementById('bulk-stock-change').value;
            const set = document.getElementById('bulk-stock-set').value;
            const applyAll = document.getElementById('apply-all').checked;
            const applyLowStock = document.getElementById('apply-low-stock').checked;
            const applyOutOfStock = document.getElementById('apply-out-of-stock').checked;
            
            if (!change && !set) {
                showAdminNotification('❌ Selecione uma ação!', 'error');
                return;
            }
            
            let updatedCount = 0;
            
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (product.stock !== undefined && product.stock !== null) {
                        let include = false;
                        
                        if (applyAll) include = true;
                        if (applyLowStock && product.stock <= 10 && product.stock > 0) include = true;
                        if (applyOutOfStock && product.stock === 0) include = true;
                        
                        if (include) {
                            const oldStock = product.stock;
                            
                            if (change) {
                                product.stock = Math.max(0, product.stock + parseInt(change));
                            } else if (set) {
                                product.stock = parseInt(set);
                            }
                            
                            updatedCount++;
                            
                            // Log individual
                            logAdminAction('BULK_STOCK_UPDATE', {
                                productId: product.id,
                                productName: product.name,
                                oldStock: oldStock,
                                newStock: product.stock,
                                action: change ? `add_${change}` : `set_${set}`
                            });
                        }
                    }
                });
            });
            
            if (updatedCount > 0) {
                const success = await saveConfigToFirebase();
                if (success) {
                    showAdminNotification(`✅ ${updatedCount} produtos atualizados com sucesso!`, 'success');
                    ADMIN_CONFIG.hasUnsavedChanges = true;
                    showQuickStockManagement(); // Volta para a gestão de estoque
                }
            } else {
                showAdminNotification('ℹ️ Nenhum produto correspondente aos filtros.', 'info');
            }
        }

        // ===================================================================================
        // =========================== AÇÕES EM MASSA ========================================
        // ===================================================================================

        function showBulkActions() {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">📋 Ações em Massa</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <!-- AJUSTE DE ESTOQUE -->
                        <div style="border: 1px solid #e5e7eb; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #374151; margin-top: 0; margin-bottom: 15px;">📦 Ajuste de Estoque</h4>
                            <div style="display: flex; gap: 10px; align-items: end;">
                                <div style="flex: 1;">
                                    <label class="admin-form-label">Adicionar/Remover</label>
                                    <input type="number" id="bulk-stock-change" class="admin-form-input" placeholder="Ex: +5 ou -3">
                                </div>
                                <button onclick="applyBulkStockChange()" class="btn-admin btn-admin-primary">
                                    Aplicar
                                </button>
                            </div>
                        </div>
                        
                        <!-- ATUALIZAÇÃO DE PREÇOS -->
                        <div style="border: 1px solid #e5e7eb; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #374151; margin-top: 0; margin-bottom: 15px;">💰 Atualização de Preços</h4>
                            <div style="display: flex; gap: 10px; align-items: end;">
                                <div style="flex: 1;">
                                    <label class="admin-form-label">Percentual (%)</label>
                                    <input type="number" id="bulk-price-change" class="admin-form-input" placeholder="Ex: +10 ou -5">
                                </div>
                                <button onclick="applyBulkPriceChange()" class="btn-admin btn-admin-primary">
                                    Aplicar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- LISTA DE PRODUTOS PARA SELEÇÃO -->
                    <h4 style="color: #374151; margin-bottom: 15px;">Selecione os produtos:</h4>
                    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                        ${renderProductCheckboxList()}
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="selectAllProducts()" class="btn-admin btn-admin-secondary">
                            ☑️ Selecionar Todos
                        </button>
                        <button onclick="deselectAllProducts()" class="btn-admin btn-admin-secondary">
                            ◻️ Desmarcar Todos
                        </button>
                        <button onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary" style="margin-left: auto;">
                            ↩️ Voltar
                        </button>
                    </div>
                </div>
            `;
        }

        function renderProductCheckboxList() {
            let html = '';
            config.menu.forEach(category => {
                html += `<h5 style="color: #374151; margin: 15px 0 10px 0;">${category.category}</h5>`;
                category.products.forEach(product => {
                    html += `
                        <label style="display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;">
                            <input type="checkbox" name="bulk-product" value="${product.id}" data-category="${category.category}">
                            <div style="flex: 1;">
                                <strong>${product.name}</strong>
                                <div style="font-size: 0.85rem; color: #6b7280;">
                                    ${formatPrice(product.newPrice)} | Estoque: ${product.stock || 'N/A'}
                                </div>
                            </div>
                        </label>
                    `;
                });
            });
            return html || '<p style="text-align: center; color: #6b7280;">Nenhum produto disponível</p>';
        }

        function selectAllProducts() {
            document.querySelectorAll('input[name="bulk-product"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function deselectAllProducts() {
            document.querySelectorAll('input[name="bulk-product"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        async function applyBulkStockChange() {
            const change = document.getElementById('bulk-stock-change').value;
            if (!change) {
                showAdminNotification('❌ Digite um valor para ajustar o estoque!', 'error');
                return;
            }
            
            const selectedProducts = Array.from(document.querySelectorAll('input[name="bulk-product"]:checked'))
                .map(checkbox => parseInt(checkbox.value));
            
            if (selectedProducts.length === 0) {
                showAdminNotification('❌ Selecione pelo menos um produto!', 'error');
                return;
            }
            
            let updatedCount = 0;
            
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (selectedProducts.includes(product.id) && product.stock !== undefined && product.stock !== null) {
                        const oldStock = product.stock;
                        product.stock = Math.max(0, product.stock + parseInt(change));
                        updatedCount++;
                        
                        // Log individual
                        logAdminAction('BULK_STOCK_CHANGE', {
                            productId: product.id,
                            productName: product.name,
                            oldStock: oldStock,
                            newStock: product.stock,
                            change: change
                        });
                    }
                });
            });
            
            if (updatedCount > 0) {
                const success = await saveConfigToFirebase();
                if (success) {
                    showAdminNotification(`✅ Estoque de ${updatedCount} produtos ajustado com sucesso!`, 'success');
                    ADMIN_CONFIG.hasUnsavedChanges = true;
                    showBulkActions(); // Recarrega a página
                }
            }
        }

        async function applyBulkPriceChange() {
            const percentage = document.getElementById('bulk-price-change').value;
            if (!percentage) {
                showAdminNotification('❌ Digite um percentual para ajustar os preços!', 'error');
                return;
            }
            
            const selectedProducts = Array.from(document.querySelectorAll('input[name="bulk-product"]:checked'))
                .map(checkbox => parseInt(checkbox.value));
            
            if (selectedProducts.length === 0) {
                showAdminNotification('❌ Selecione pelo menos um produto!', 'error');
                return;
            }
            
            let updatedCount = 0;
            const multiplier = 1 + (parseFloat(percentage) / 100);
            
            config.menu.forEach(category => {
                category.products.forEach(product => {
                    if (selectedProducts.includes(product.id)) {
                        const oldPrice = product.newPrice;
                        product.newPrice = parseFloat((product.newPrice * multiplier).toFixed(2));
                        
                        // Se tiver preço antigo, também ajusta
                        if (product.oldPrice) {
                            product.oldPrice = parseFloat((product.oldPrice * multiplier).toFixed(2));
                        }
                        
                        updatedCount++;
                        
                        // Log individual
                        logAdminAction('BULK_PRICE_CHANGE', {
                            productId: product.id,
                            productName: product.name,
                            oldPrice: oldPrice,
                            newPrice: product.newPrice,
                            percentage: percentage
                        });
                    }
                });
            });
            
            if (updatedCount > 0) {
                const success = await saveConfigToFirebase();
                if (success) {
                    showAdminNotification(`✅ Preços de ${updatedCount} produtos ajustados com sucesso!`, 'success');
                    ADMIN_CONFIG.hasUnsavedChanges = true;
                    showBulkActions(); // Recarrega a página
                }
            }
        }

        // ===================================================================================
        // =========================== RELATÓRIOS ============================================
        // ===================================================================================

        function showReports() {
            const adminContent = document.getElementById('admin-content');
            
            // Calcular métricas
            const today = new Date();
            const last7Days = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">📊 Relatórios</h3>
                    
                    <!-- PERÍODO -->
                    <div style="margin-bottom: 20px;">
                        <label class="admin-form-label">Período:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="date" id="report-start" class="admin-form-input" 
                                   value="${last7Days.toISOString().split('T')[0]}">
                            <span style="display: flex; align-items: center;">até</span>
                            <input type="date" id="report-end" class="admin-form-input" 
                                   value="${today.toISOString().split('T')[0]}">
                            <button onclick="generateReport()" class="btn-admin btn-admin-primary">
                                Gerar
                            </button>
                        </div>
                    </div>
                    
                    <!-- MÉTRICAS -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="text-align: center; padding: 20px; border: 1px solid #e5e7eb; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #3b82f6; margin-bottom: 10px;">📈</div>
                            <h4 style="margin: 0 0 10px 0; color: #374151;">Produtos Ativos</h4>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: #1f2937;">${getTotalProducts()}</p>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; border: 1px solid #e5e7eb; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #10b981; margin-bottom: 10px;">💰</div>
                            <h4 style="margin: 0 0 10px 0; color: #374151;">Estoque Total</h4>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: #1f2937;">${getTotalStock()}</p>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; border: 1px solid #e5e7eb; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #f59e0b; margin-bottom: 10px;">⚠️</div>
                            <h4 style="margin: 0 0 10px 0; color: #374151;">Atenção</h4>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${getLowStockProducts()}</p>
                        </div>
                        
                        <div style="text-align: center; padding: 20px; border: 1px solid #e5e7eb; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #ef4444; margin-bottom: 10px;">⛔</div>
                            <h4 style="margin: 0 0 10px 0; color: #374151;">Esgotados</h4>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: #ef4444;">${getOutOfStockProducts()}</p>
                        </div>
                    </div>
                    
                    <!-- GRÁFICO SIMPLES (usando divs) -->
                    <div>
                        <h4 style="color: #374151; margin-bottom: 15px;">📈 Distribuição por Categoria</h4>
                        <div style="background: #f8fafc; padding: 20px; border-radius: 10px;">
                            ${config.menu.map(category => {
                                const percent = (category.products.length / getTotalProducts()) * 100;
                                return `
                                    <div style="margin-bottom: 10px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <span>${category.category}</span>
                                            <span>${category.products.length} produtos (${percent.toFixed(1)}%)</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${percent}%;"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- LOGS RECENTES -->
                    <div style="margin-top: 30px;">
                        <h4 style="color: #374151; margin-bottom: 15px;">📝 Atividades Recentes</h4>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px;">
                            ${getRecentLogs().map(log => `
                                <div style="padding: 12px 15px; border-bottom: 1px solid #f1f5f9;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <strong>${log.action.replace('_', ' ')}</strong>
                                        <span style="font-size: 0.8rem; color: #6b7280;">${new Date(log.timestamp).toLocaleString()}</span>
                                    </div>
                                    <div style="font-size: 0.85rem; color: #6b7280;">
                                        ${log.details ? JSON.stringify(log.details) : ''}
                                    </div>
                                </div>
                            `).join('') || '<p style="text-align: center; padding: 20px; color: #6b7280;">Nenhuma atividade registrada</p>'}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button onclick="exportReportToPDF()" class="btn-admin btn-admin-primary">
                            📄 Exportar PDF
                        </button>
                        <button onclick="exportReportToExcel()" class="btn-admin btn-admin-success">
                            📊 Exportar Excel
                        </button>
                        <button onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary" style="margin-left: auto;">
                            ↩️ Voltar
                        </button>
                    </div>
                </div>
            `;
        }

        function getRecentLogs() {
            // Carregar logs do localStorage
            const savedLogs = localStorage.getItem('adminLogs');
            if (savedLogs) {
                try {
                    return JSON.parse(savedLogs).slice(0, 10); // Últimos 10 logs
                } catch (e) {
                    console.error('Erro ao carregar logs:', e);
                }
            }
            return [];
        }

        function generateReport() {
            const startDate = document.getElementById('report-start').value;
            const endDate = document.getElementById('report-end').value;
            
            if (!startDate || !endDate) {
                showAdminNotification('❌ Selecione um período válido!', 'error');
                return;
            }
            
            showAdminNotification(`📊 Relatório gerado para o período ${startDate} a ${endDate}`, 'success');
            // Aqui você implementaria a lógica completa de geração de relatório
        }

        function exportReportToPDF() {
            showAdminNotification('📄 Exportação para PDF em desenvolvimento!', 'info');
            // Implementar exportação para PDF
        }

        function exportReportToExcel() {
            showAdminNotification('📊 Exportação para Excel em desenvolvimento!', 'info');
            // Implementar exportação para Excel
        }

        // ===================================================================================
        // =========================== BACKUP E RESTAURAÇÃO ==================================
        // ===================================================================================

        function exportConfig() {
            // Adicionar metadados ao backup
            const backupData = {
                ...config,
                _metadata: {
                    exportDate: new Date().toISOString(),
                    totalProducts: getTotalProducts(),
                    totalCategories: config.menu.length,
                    version: '1.0'
                }
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup-${config.shop.name.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            // Log da ação
            logAdminAction('EXPORT_BACKUP', {
                totalProducts: getTotalProducts(),
                totalCategories: config.menu.length
            });
            
            showAdminNotification('✅ Backup exportado com sucesso!', 'success');
        }

        function showBackupRestore() {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div class="admin-card">
                    <h3 class="admin-section-title">💾 Backup e Restauração</h3>
                    
                    <div style="display: grid; gap: 30px;">
                        <!-- EXPORTAÇÃO -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">📥 Exportar Dados</h4>
                            <p style="color: #6b7280; margin-bottom: 20px;">Faça um backup completo dos seus produtos, categorias e configurações.</p>
                            <button onclick="exportConfig()" class="btn-admin btn-admin-success">
                                📥 Baixar Backup
                            </button>
                        </div>
                        
                        <!-- RESTAURAÇÃO -->
                        <div>
                            <h4 style="color: #374151; margin-bottom: 15px;">📤 Restaurar Dados</h4>
                            <p style="color: #6b7280; margin-bottom: 20px;">Importe um backup anterior para restaurar seus dados.</p>
                            
                            <div class="admin-form-group">
                                <label class="admin-form-label">Selecionar arquivo de backup:</label>
                                <input type="file" id="backup-file" accept=".json" class="admin-form-input">
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <button onclick="restoreConfig()" class="btn-admin btn-admin-primary">
                                     Restaurar Backup
                                </button>
                                <button onclick="showRestorePreview()" class="btn-admin btn-admin-secondary">
                                     Pré-visualizar
                                </button>
                            </div>
                        </div>
                        
                        <!-- INFORMAÇÕES -->
                        <div style="background: #f8fafc; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0;">
                            <h4 style="color: #374151; margin-bottom: 15px;">ℹ️ Informações</h4>
                            <ul style="color: #6b7280; padding-left: 20px;">
                                <li>O backup inclui todos os produtos, categorias e configurações</li>
                                <li>Faça backup regularmente para evitar perda de dados</li>
                                <li>A restauração substituirá todos os dados atuais</li>
                                <li>Recomendado fazer backup antes de restaurar</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button onclick="loadAdminDashboard()" class="btn-admin btn-admin-secondary" style="margin-left: auto;">
                            ↩️ Voltar ao Dashboard
                        </button>
                    </div>
                </div>
            `;
        }

        function showRestorePreview() {
            const fileInput = document.getElementById('backup-file');
            if (!fileInput.files.length) {
                showAdminNotification('❌ Selecione um arquivo primeiro!', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Verificar se é um backup válido
                    if (!backupData.shop || !backupData.menu) {
                        showAdminNotification('❌ Arquivo de backup inválido!', 'error');
                        return;
                    }
                    
                    // Mostrar pré-visualização
                    const adminContent = document.getElementById('admin-content');
                    adminContent.innerHTML = `
                        <div class="admin-card">
                            <h3 class="admin-section-title">👁️ Pré-visualização do Backup</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #374151;">Arquivo: ${file.name}</h4>
                                <p style="color: #6b7280;">Data do backup: ${backupData._metadata?.exportDate || 'Desconhecida'}</p>
                            </div>
                            
                            <!-- ESTATÍSTICAS DO BACKUP -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                                <div style="text-align: center; padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: #3b82f6; margin-bottom: 5px;">🏪</div>
                                    <div style="font-weight: bold;">Loja</div>
                                    <div style="color: #6b7280; font-size: 0.9rem;">${backupData.shop.name}</div>
                                </div>
                                
                                <div style="text-align: center; padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: #10b981; margin-bottom: 5px;">📁</div>
                                    <div style="font-weight: bold;">Categorias</div>
                                    <div style="color: #6b7280; font-size: 0.9rem;">${backupData.menu.length}</div>
                                </div>
                                
                                <div style="text-align: center; padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; color: #f59e0b; margin-bottom: 5px;">📦</div>
                                    <div style="font-weight: bold;">Produtos</div>
                                    <div style="color: #6b7280; font-size: 0.9rem;">${backupData._metadata?.totalProducts || 'N/A'}</div>
                                </div>
                            </div>
                            
                            <!-- LISTA DE CATEGORIAS -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #374151; margin-bottom: 15px;">Categorias no Backup</h4>
                                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                    ${backupData.menu.map(category => `
                                        <div style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
                                            <strong>${category.category}</strong>
                                            <span style="color: #6b7280; float: right;">${category.products.length} produtos</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- COMPARAÇÃO COM DADOS ATUAIS -->
                            <div style="margin-bottom: 30px;">
                                <h4 style="color: #374151; margin-bottom: 15px;">📊 Comparação com Dados Atuais</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); padding: 15px; border-radius: 8px; color: white;">
                                        <div style="font-size: 0.9rem; opacity: 0.9;">Atual</div>
                                        <div style="font-size: 1.5rem; font-weight: bold;">${getTotalProducts()} produtos</div>
                                        <div style="font-size: 0.9rem;">${config.menu.length} categorias</div>
                                    </div>
                                    
                                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 15px; border-radius: 8px; color: white;">
                                        <div style="font-size: 0.9rem; opacity: 0.9;">Backup</div>
                                        <div style="font-size: 1.5rem; font-weight: bold;">${backupData._metadata?.totalProducts || backupData.menu.flatMap(c => c.products).length} produtos</div>
                                        <div style="font-size: 0.9rem;">${backupData.menu.length} categorias</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <button onclick="confirmRestore()" class="btn-admin btn-admin-success">
                                    ✅ Confirmar Restauração
                                </button>
                                <button onclick="showBackupRestore()" class="btn-admin btn-admin-secondary">
                                    ↩️ Voltar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // Armazenar backup em memória para restauração
                    window.currentBackupData = backupData;
                    
                } catch (error) {
                    showAdminNotification('❌ Erro ao ler arquivo de backup!', 'error');
                    console.error('Erro ao ler backup:', error);
                }
            };
            
            reader.readAsText(file);
        }

        function confirmRestore() {
            if (!window.currentBackupData) {
                showAdminNotification('❌ Nenhum backup carregado!', 'error');
                return;
            }
            
            if (!confirm('⚠️ ATENÇÃO: Isso substituirá TODOS os seus dados atuais!\n\nTem certeza que deseja restaurar o backup?')) {
                return;
            }
            
            if (!confirm('🚨 ÚLTIMO AVISO: Esta ação NÃO PODE ser desfeita!\n\nTodos os produtos, categorias e configurações atuais serão perdidos.')) {
                return;
            }
            
            restoreFromBackup(window.currentBackupData);
        }

        async function restoreFromBackup(backupData) {
            try {
                // Validar estrutura do backup
                if (!backupData.shop || !backupData.menu) {
                    throw new Error('Estrutura de backup inválida');
                }
                
                // Substituir configuração atual pelo backup
                config = { ...backupData };
                
                // Salvar no Firebase
                const success = await saveConfigToFirebase();
                if (success) {
                    // Log da ação
                    logAdminAction('RESTORE_BACKUP', {
                        totalProducts: getTotalProducts(),
                        totalCategories: config.menu.length
                    });
                    
                    showAdminNotification('✅ Backup restaurado com sucesso!', 'success');
                    ADMIN_CONFIG.hasUnsavedChanges = true;
                    
                    // Recarregar o dashboard
                    setTimeout(() => {
                        loadAdminDashboard();
                        // Recarregar também a página principal
                        renderMenuPage();
                    }, 1000);
                }
                
            } catch (error) {
                console.error('Erro ao restaurar backup:', error);
                showAdminNotification('❌ Erro ao restaurar backup: ' + error.message, 'error');
            }
        }

        function restoreConfig() {
            const fileInput = document.getElementById('backup-file');
            if (!fileInput.files.length) {
                showAdminNotification('❌ Selecione um arquivo primeiro!', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    showRestorePreview(backupData);
                } catch (error) {
                    showAdminNotification('❌ Erro ao ler arquivo de backup!', 'error');
                    console.error('Erro ao ler backup:', error);
                }
            };
            
            reader.readAsText(file);
        }

        // Função auxiliar para contar produtos
        function getTotalProducts() {
            return config.menu.reduce((total, category) => total + category.products.length, 0);
        }

    </script>
</body>
</html>
