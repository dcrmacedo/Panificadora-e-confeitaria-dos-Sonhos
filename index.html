<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://media.canva.com/v2/image-resize/format:PNG/height:729/quality:100/uri:ifs%3A%2F%2FM%2F5d02cf60-f46a-4a44-9436-81349e661209/watermark:F/width:644?csig=AAAAAAAAAAAAAAAAAAAAALDo40GbMwqBKBqWw5hJVNq66IkqRVbG-5oinqV8Tynj&exp=1758858655&osig=AAAAAAAAAAAAAAAAAAAAAOXLm6mXqpkJ97_H34uO8lhzPADWMYQ6hAVZmUbMsVxK&signer=media-rpc&x-canva-quality=screen_3x">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="./imagens/logodonavegador.png">
    <title>Panificadora e confeitaria dos sonhos</title>

    <!-- FIREBASE SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary-color: #F97316; /* Laranja */
            --secondary-color: #8B4513; /* Marrom */
            --text-color: #333;
            --light-gray: #f4f4f5;
            --medium-gray: #e4e4e7;
            --dark-gray: #52525b;
            --green: #16A34A;
            --white: #FFFFFF;
            --font-family: 'Arial', sans-serif;
        }
        html { scroll-behavior: smooth; }
        body { 
            margin: 0; 
            font-family: var(--font-family); 
            background-color: transparent;
            background-image: linear-gradient(rgba(99, 93, 93, 0.87), rgba(88, 84, 84, 0.829)), url('https://i.pinimg.com/736x/5f/ba/d6/5fbad6c44e68b9f884794e19c1da366a.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--text-color); 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .hidden { display: none !important; }

        /* --- LAYOUT GERAL --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        
        /* --- CABE√áALHO PRINCIPAL --- */
       .hero-section { 
    position: relative; 
    height: 300px; /* ou a altura que voc√™ escolheu */
    background-image: url('./imagens/logoback.png'); 
    background-size: cover; /* ‚Üê MANTENHA COVER */
    background-position: center center; /* ‚Üê CENTRALIZAR MELHOR */
    background-repeat: no-repeat; /* ‚Üê EVITA REPETI√á√ÉO */
    background-attachment: scroll; /* ‚Üê REMOVE FIXED SE TIVER */
    display: flex; 
    align-items: flex-start; 
    padding: 1rem; 
}
        .top-bar { width: 100%; max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { background-color: var(--green); color: var(--white); padding: 0.3rem 0.8rem; border-radius: 9999px; font-weight: bold; font-size: 0.8rem; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .status-badge .dot { width: 8px; height: 8px; background-color: var(--white); border-radius: 50%; margin-right: 0.5rem; }
        .cart-icon { position: relative; cursor: pointer; background-color: var(--white); border-radius: 50%; width: 44px; height: 44px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .cart-count { position: absolute; top: -5px; right: -5px; background-color: var(--primary-color); color: var(--white); border-radius: 50%; width: 20px; height: 20px; display: flex; justify-content: center; align-items: center; font-size: 0.75rem; font-weight: bold; border: 1px solid var(--white); }
        
        .shop-info-container { 
    background-color: var(--white); 
    text-align: center; 
    padding: 80px 1rem 1rem 1rem;  /* Aumentei o padding-top */
    margin-top: -150px;  /* Aumentei de -100px para -150px */
    position: relative; 
}
        .shop-logo { 
    position: absolute; 
    top: -80px;  /* Aumentei de -50px para -80px */
    left: 50%; 
    transform: translateX(-50%); 
    width: 120px;  /* Aumentei o tamanho do logo */
    height: 120px; 
    border-radius: 50%; 
    border: 4px solid var(--white); 
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
    overflow: hidden; 
}
        .shop-logo img { width: 100%; height: 100%; object-fit: cover; }
        .shop-name { font-size: 2rem; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .shop-details { color: var(--dark-gray); margin: 0.5rem 0; display: flex; justify-content: center; align-items: center; gap: 1rem; flex-wrap: wrap; }
        
        /* --- MENU DE CATEGORIAS --- */
        #category-menu { position: sticky; top: 0; z-index: 990; background-color: var(--white); box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 0.5rem 1rem; overflow-x: auto; white-space: nowrap; }
        #category-menu a { display: inline-block; padding: 0.75rem 1rem; text-decoration: none; color: var(--dark-gray); font-weight: bold; border-radius: 8px; transition: background-color 0.2s; }
        #category-menu a:hover { background-color: var(--light-gray); color: var(--primary-color); }
        
        /* --- SE√á√ïES DE PRODUTOS --- */
        .menu-category-section { padding: 2rem 0; border-bottom: 1px solid var(--medium-gray); }
        .product-section-title { font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5rem; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; }
        .product-card { background-color: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid var(--medium-gray); transition: transform 0.2s, box-shadow 0.2s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .product-card img {
           width: 100%;
           height: 180px; /* pode ajustar o valor */
           object-fit: contain; /* mostra a imagem completa */
           background-color: #fff; /* cor de fundo opcional */
           padding: 5px; /* opcional para deixar um respiro */
           border-radius: 8px; /* combina com o design do card */
         }

        .product-card-info { padding: 1rem; }
        .product-card-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem; }
        .product-card-delivery { font-size: 0.9rem; color: var(--green); margin: 0.25rem 0; }
        .product-card-price .old-price { text-decoration: line-through; color: var(--dark-gray); font-size: 0.9rem; }
        .product-card-price .new-price { font-weight: bold; font-size: 1.2rem; color: var(--text-color); }

        /* --- P√ÅGINA DO PRODUTO --- */
        #product-page { background-color: var(--white); padding-bottom: 90px; }
        .product-header { display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid var(--medium-gray); }
        .back-button { background: none; border: none; cursor: pointer; margin-right: 1rem; }
        .product-page-layout { display: flex; flex-direction: column; }
        .product-image-column { flex: 1; }
        .product-details-column { flex: 1; }
        .product-image-lg { width: 100%; max-height: 400px; object-fit: cover; }
        .product-details { padding: 1rem; }
        .product-title-lg { font-size: 1.75rem; font-weight: bold; }
        .product-price-lg .old-price { text-decoration: line-through; color: var(--dark-gray); font-size: 1rem; }
        .product-price-lg .new-price { font-weight: bold; font-size: 1.75rem; color: var(--text-color); }
        .product-stock { color: var(--primary-color); font-size: 0.9rem; margin-top: 0.5rem; }
        .section { padding: 1rem; border-top: 8px solid var(--light-gray); }
        .section-title { font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; }
        .accompaniment-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--medium-gray); }
        .accompaniment-price { color: var(--green); font-weight: bold; }
        .quantity-control { display: flex; align-items: center; gap: 0.75rem; border: 1px solid var(--medium-gray); border-radius: 9999px; padding: 0.25rem; }
        .quantity-btn { background-color: var(--white); border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 1.5rem; color: var(--primary-color); cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .quantity-btn:disabled { color: var(--medium-gray); cursor: not-allowed; }
        .quantity-value { font-weight: bold; font-size: 1.1rem; min-width: 20px; text-align: center; }
        .sticky-footer { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--white); padding: 1rem; box-shadow: 0 -4px 12px rgba(0,0,0,0.1); }
        .sticky-footer .container { display: flex; justify-content: space-between; align-items: center; }
        .footer-price { font-size: 1.25rem; font-weight: bold; }
        .add-to-cart-btn { background-color: var(--primary-color); color: var(--white); border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; }
        @media (min-width: 768px) {
            .product-page-layout { flex-direction: row; gap: 2rem; padding: 2rem; }
            .product-image-lg { border-radius: 12px; }
        }

        /* --- RODAP√â --- */
        .main-footer {
            background-color: #1e293b;
            color: white;
            padding: 1.5rem 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        }

        .footer-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 2rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 2rem;
}

        .footer-section h3 {
    color: #f97316;
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
    font-weight: bold;
}
        .footer-section p {
    color: rgba(255,255,255,0.8);
    font-size: 0.95rem;
    line-height: 1.6;
    text-decoration: none;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.footer-section i {
    width: 16px;
    text-align: center;
}
        .footer-section a {
            color: var(--white);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: var(--primary-color);
        }

        .social-links {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
}
        .social-links a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: rgba(255,255,255,0.1);
    color: #fff;
    transition: all 0.3s ease;
}

        .social-links a:hover {
    background-color: #fffefd;
}
        .footer-bottom {
    text-align: center;
    padding-top: 1rem;
    color: rgba(255,255,255,0.7);
    font-size: 0.9rem;
}

        .footer-icon {
            width: 20px;
            height: 20px;
            color: var(--primary-color);
        }
        
        .payment-options {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.payment-options label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    border-radius: 6px;
    transition: background-color 0.2s;
    cursor: pointer;
}

.payment-options label:hover {
    background-color: var(--light-gray);
}

.payment-options input[type="radio"] {
    margin: 0;
}

#card-type-group .payment-options {
    margin-top: 0.5rem;
    padding-left: 1rem;
    border-left: 2px solid var(--primary-color);
}

/* ESTILOS PARA IMAGENS DE PAGAMENTO */
.payment-methods-images {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
}

.payment-icon {
    width: 50px; /* Ajuste conforme necess√°rio */
    height: 30px;
    object-fit: contain;
    background-color: white;
    padding: 2px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.payment-icon:hover {
    transform: scale(1.05);
}

        /* --- MODAL DO CARRINHO --- */
        .cart-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 998; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .cart-modal { position: fixed; top: 0; right: -100%; width: 100%; max-width: 450px; height: 100%; background-color: var(--white); z-index: 999; transition: right 0.3s ease; display: flex; flex-direction: column; }
        .cart-modal.open { right: 0; }
        .cart-modal-overlay.open { opacity: 1; pointer-events: auto; }
        .cart-header { padding: 1rem; font-size: 1.2rem; font-weight: bold; border-bottom: 1px solid var(--medium-gray); display: flex; justify-content: space-between; align-items: center; }
        .cart-header .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        .cart-content { flex-grow: 1; overflow-y: auto; padding-bottom: 1rem; }
        .cart-item { display: flex; flex-direction: column; margin: 0 1rem; border-bottom: 1px solid var(--medium-gray); padding: 1rem 0; }
        .cart-item-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .cart-item-name { font-weight: bold; }
        .cart-item-price { font-weight: 500; }
        .cart-item-accompaniments { font-size: 0.85rem; color: var(--dark-gray); margin-top: 0.5rem; }
        .cart-item-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 0.5rem; }
        .cart-item-edit { color: var(--primary-color); font-size: 0.8rem; cursor: pointer; text-decoration: underline; }
        .cart-item-remove { color: #ef4444; font-size: 0.8rem; cursor: pointer; text-decoration: underline; }
        .cart-form-section { padding: 1rem; border-bottom: 8px solid var(--light-gray); }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-group input[type="text"] { width: 100%; padding: 0.75rem; border: 1px solid var(--medium-gray); border-radius: 8px; box-sizing: border-box; }
        .payment-options label { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .cart-footer { padding: 1rem; background: var(--white); box-shadow: 0 -2px 5px rgba(0,0,0,0.1); }
        .cart-total { display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem; }
        .finalize-btn { width: 100%; background-color: var(--green); color: var(--white); border: none; padding: 1rem; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
    </style>

    <!-- FIREBASE CONFIGURA√á√ÉO -->
    <script>
        // ===================================================================================
        // =========================== CONFIGURA√á√ÉO FIREBASE ================================
        // ===================================================================================

        // SUA CONFIGURA√á√ÉO DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyCD8mdV9w-bTaaqHtrZIErrh84fAPRe2Oc",
            authDomain: "panificadora-dos-sonhos.firebaseapp.com",
            projectId: "panificadora-dos-sonhos",
            storageBucket: "panificadora-dos-sonhos.firebasestorage.app",
            messagingSenderId: "919334350725",
            appId: "1:919334350725:web:59a8db296323681d505eec"
        };

       // Inicializar Firebase
try {
    firebase.initializeApp(firebaseConfig);
    firestoreDb = firebase.firestore();
    console.log('‚úÖ Firebase inicializado com sucesso');
    console.log('üîç Firestore DB:', firestoreDb); // ‚Üê Adicione esta linha para debug
} catch (error) {
    console.error('‚ùå Erro ao inicializar Firebase:', error);
    firestoreDb = null; // ‚Üê Garante que n√£o fique undefined
}

        let db = firebase.firestore();
    </script>
</head>
<body>

    <div id="main-page">
        <header class="hero-section">
            <div class="top-bar">
                <div class="status-badge"><span class="dot"></span>ABERTO</div>
                <div class="cart-icon" onclick="openCart()"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--primary-color);"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg><span class="cart-count" id="cart-count">0</span></div>
            </div>
        </header>
        
        <div class="shop-info-container">
            <div class="shop-logo"><img id="shop-logo-main" src="" alt="Logo da Loja"></div>
            <div class="container">
                <h1 class="shop-name" id="shop-name-main"></h1>
                <div class="shop-details"><span>Hor√°rio de Funcionamento: Segunda a S√°bado: 06h √†s 20h</span><span>‚Ä¢</span><span>Entrega Gr√°tis </span><span>‚Ä¢</span><span>‚≠ê 4.9/5 (1360 avalia√ß√µes)</span></div>
            </div>
        </div>

        <nav id="category-menu"></nav>

        <main id="menu-container">
            <!-- Conte√∫do do menu ser√° inserido aqui -->
        </main>

        <!-- RODAP√â -->
       <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Endere√ßo</h3>
                <a href="https://www.google.com.br/maps/place/Panificadora+e+confeitaria+dos+sonhos/@-1.3476359,-48.4480096,17.65z/data=!4m6!3m5!1s0x92a4619a422ef337:0x48b314743d2acb8a!8m2!3d-1.3479238!4d-48.4475367!16s%2Fg%2F11wqygw_6t?hl=pt-BR&entry=ttu&g_ep=EgoyMDI1MTAxNS4wIKXMDSoJLDEwMjQ3OTk3MCCAAQ%3D%3D" class="text-gray-400 hover:text-orange transition"> Residencial Murur√© - Alameda Principal, <br> 84 - Coqueiro, Bel√©m - PA, 66823-061</a>
                
            </div>
            
              <div class="footer-section">
            <h3>Contato</h3>
            <p><i class="fas fa-phone"></i> (91) 98112-0535</p>
            <p><i class="fas fa-envelope"></i> Contato@gmail.com</p>
        </div>

        <div class="footer-section">
            <h3>Hor√°rio de Funcionamento</h3>
            <p>Segunda a S√°bado: 06h √†s 20h</p>
            <p></p>
        </div>
         
        <div class="footer-section">
            <h3>Redes Sociais</h3>
            <div class="social-links">
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
        <div class="footer-section">
           <h3>Forma de Pagamento</h3>
           <div class="payment-methods-images">
              <img src="./imagens/visa.png" alt="Visa" class="payment-icon">
              <img src="./imagens/mastercard.png" alt="Mastercard" class="payment-icon">
              <img src="./imagens/elo.png" alt="Elo" class="payment-icon">
              <img src="./imagens/hipercard.png" alt="hipercard" class="payment-icon">
              
        </div>
    </div>
    </div>
    
    <div class="footer-bottom">
        ¬© 2025 DD - Todos os direitos reservados.
    </div>
</footer>
    </div>

    <div id="product-page" class="hidden">
        <header class="product-header"><button class="back-button" onclick="showMainPage()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg></button><span style="font-weight: bold;">VOLTAR</span></header>
        <div class="product-page-layout">
            <div class="product-image-column"><img id="product-image-lg" src="" alt="Imagem do produto" class="product-image-lg"></div>
            <div class="product-details-column">
                <div class="product-details"><h1 id="product-title-lg" class="product-title-lg"></h1><div id="product-price-lg" class="product-price-lg"></div><div id="product-stock" class="product-stock"></div></div>
                <div class="section"><h2 class="section-title">Descri√ß√£o</h2><div id="product-description" class="complements-banner"></div></div>
                <div class="section" id="accompaniments-section">
                    <div class="accompaniments-header"><h2 class="section-title">Acompanhamentos</h2><p id="accompaniments-subtitle" class="section-subtitle"></p></div>
                    <div id="accompaniments-list"></div>
                </div>
                <div class="section" id="drinks-section">
                    <div class="accompaniments-header"><h2 class="section-title">Bebidas</h2><p id="drinks-subtitle" class="section-subtitle"></p></div>
                    <div id="drinks-list"></div>
                </div>
            </div>
        </div>
        <footer class="sticky-footer"><div class="container"><span id="footer-price" class="footer-price">R$ 0,00</span><button id="add-to-cart-btn" class="add-to-cart-btn" onclick="addToCart()">Adicionar ao carrinho</button></div></footer>
    </div>

    <div id="cart-modal-overlay" class="cart-modal-overlay" onclick="closeCart()"></div>
    <div id="cart-modal" class="cart-modal">
        <div class="cart-header"><span>Meu Carrinho</span><button class="close-btn" onclick="closeCart()">√ó</button></div>
        <div class="cart-content">
            <div id="cart-items-container"></div>
            <div class="cart-form-section"><div class="form-group"><label for="customer-name">Seu Nome</label><input type="text" id="customer-name" placeholder="Digite seu nome completo"></div><div class="form-group"><label for="customer-address">Endere√ßo de Entrega</label><input type="text" id="customer-address" placeholder="Rua, N√∫mero, Bairro, Refer√™ncia"></div></div>
            <div class="cart-form-section">
    <div class="form-group">
        <label>Forma de Pagamento</label>
        <div class="payment-options">
            <label><input type="radio" name="payment" value="Pix" checked onchange="handlePaymentChange()"> Pix</label>
            <label><input type="radio" name="payment" value="Dinheiro" onchange="handlePaymentChange()"> Dinheiro</label>
            <label><input type="radio" name="payment" value="Cart√£o" onchange="handlePaymentChange()"> Cart√£o</label>
        </div>
    </div>
    
    <!-- Grupo do Troco (apenas para Dinheiro) -->
    <div class="form-group hidden" id="change-group">
        <label for="customer-change">Troco para quanto?</label>
        <input type="text" id="customer-change" placeholder="Ex: 50,00 (opcional)">
    </div>
    
    <!-- Grupo do Tipo de Cart√£o (apenas para Cart√£o) -->
    <div class="form-group hidden" id="card-type-group">
        <label>Tipo de Cart√£o</label>
        <div class="payment-options">
            <label><input type="radio" name="cardType" value="D√©bito" checked> D√©bito</label>
            <label><input type="radio" name="cardType" value="Cr√©dito"> Cr√©dito</label>
        </div>
    </div>
</div>
        <div class="cart-footer"><div class="cart-total"><span>Total</span><span id="cart-total-price">R$ 0,00</span></div><button class="finalize-btn" onclick="finalizeOrder()">Finalizar Pedido no Whatsapp</button></div>
    </div>

    <!-- =========================================== -->
    <!-- SISTEMA ADMIN (ADICIONADO AQUI NO FINAL) -->
    <!-- =========================================== -->

    <!-- Bot√£o admin invis√≠vel - s√≥ aparece com atalho -->
    <div id="admin-access-area" style="display: none; position: fixed; bottom: 20px; left: 20px; z-index: 9999;">
        <button onclick="openAdminLogin()" style="
            background: #F97316;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        ">‚öôÔ∏è</button>
    </div>

    <!-- Painel Admin -->
    <div id="admin-panel" class="hidden" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 10000;
        padding: 20px;
        overflow-y: auto;
    ">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #f97316; padding-bottom: 15px;">
                <h2 style="color: #f97316; margin: 0;">üè™ Painel Administrativo</h2>
                <button onclick="closeAdmin()" style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">‚ùå Fechar</button>
            </div>
            
            <div id="admin-content">
                <!-- Conte√∫do admin carregado aqui -->
            </div>
        </div>
    </div>

    <script>
        // ===================================================================================
        // =========================== CONFIGURA√á√ÉO INICIAL ==================================
        // ===================================================================================
        const defaultConfig = {
    whatsappNumber: "559181727306",
    shop: {
        name: "Panificadora e Confeitaria dos Sonhos",
        logoUrl: "./imagens/logodonavegador.png",
        address: "Residencial Murur√© - Alameda Principal, 84 - Coqueiro, Bel√©m - PA, 66823-061",
        phone: "(91) 98112-0535",
        email: "Contato@gmail.com",
        socialMedia: {
            facebook: "https://www.facebook.com/",
            instagram: "https://www.instagram.com/",
            tiktok: "https://www.tiktok.com/"
        }
    },
    menu: [
        {
    category: "Promo√ß√µes",
    products: [
        { 
            id: 1, 
            name: "Coxinha de frango", 
            imageUrl: "https://cdn.awsli.com.br/1117/1117912/produto/54403219/coxinha-2-uvm771ucxs.png", 
            oldPrice: 1.00, 
            newPrice: 0.50, 
            delivery: "Entrega gr√°tis", 
            stock: 36, 
            description: "Coxinha crocante com recheio de frango", 
            accompaniments: { 
                limit: 10,
                options: [
                    { name: "Quantidade de coxinha", price: 0.50 }
                ] 
            },
            drinks: {
                limit: 6,
                options: [
                    { name: "Refrigerante Lata 350ml", price: 5.00 },
                    { name: "Suco Natural 500ml", price: 5.00 },
                    { name: "√Ågua Mineral 500ml", price: 3.00 }
                ]
            }
        },
        { 
            id: 2, 
            name: "Biscoito de goiaba", 
            imageUrl: "https://minhasreceitinhas.com.br/wp-content/uploads/2023/08/biscoito-de-maizena-com-goiabada.jpg", 
            oldPrice: 1.00, 
            newPrice: 0.75, 
            delivery: "Entrega gr√°tis", 
            stock: 25, 
            description: "Biscoito caseiro com goiabada", 
            accompaniments: { 
                limit: 6, 
                options: [
                    { name: "Quantidade de Biscoito", price: 0.75 }
                ] 
            },
            drinks: {
                limit: 6,
                options: [
                    { name: "Refrigerante Lata 350ml", price: 5.00 },
                    { name: "Suco Natural 500ml", price: 8.00 },
                    { name: "√Ågua Mineral 500ml", price: 3.00 }
                ]
            }
        },
        { 
            id: 3, 
            name: "Teste", 
            imageUrl: "", 
            oldPrice: 1.00, 
            newPrice: 0.75, 
            delivery: "Entrega gr√°tis", 
            stock: 25, 
            description: "***********************", 
            accompaniments: { 
                limit: 6, 
                options: [
                    { name: "Quantidade de ******", price: 0.75 }
                ] 
            },
            drinks: {
                limit: 6,
                options: [
                    { name: "Refrigerante Lata 350ml", price: 5.00 },
                    { name: "Suco Natural 500ml", price: 8.00 },
                    { name: "√Ågua Mineral 500ml", price: 3.00 }
                ]
            }
        },
        { 
            id: 4, 
            name: "P√£o de Queijo", 
            imageUrl: "https://paoearte.com/wp-content/uploads/2022/11/pao_queijo_tradicional-scaled.jpg", 
            oldPrice: 1.50, 
            newPrice: 1.00, 
            delivery: "Entrega gr√°tis", 
            stock: 20, 
            description: "P√£o de queijo quentinho e derretendo", 
            accompaniments: { 
                limit: 8, 
                options: [
                    { name: "Quantidade de P√£o de Queijo", price: 1.00 }
                ] 
            },
            drinks: {
                limit: 4,
                options: [
                    { name: "Caf√© Expresso", price: 3.00 },
                    { name: "Suco de Laranja 300ml", price: 6.00 }
                ]
            }
        }
    ]
},
        
          
        {
            category: "Lanches",
            products: [
                    { 
                        id: 5, 
                        name: "Pastel de Queijo", 
                        imageUrl: "https://superrissul.vtexassets.com/arquivos/ids/905195-800-auto?v=638941546428270000&width=800&height=auto&aspect=trueo", 
                        newPrice: 3.00, 
                        delivery: "Entrega gr√°tis", 
                        stock: 15, 
                        description: "",
                        accompaniments: { 
                            limit: 6, 
                            options: [
                                { name: "Quantidade", price: 3.00 },
                            
                            ] 
                        },
                        drinks: {
                            limit: 6,
                            options: [
                                { name: "Refrigerante 600ml", price: 7.00 },
                                { name: "Suco Natural 500ml", price: 8.00 }
                            ]
                        }
                    },
                ]
            },
        {
            category: "Bebidas",
            products: [
                { 
                    id: 101, 
                    name: "Refrigerante 600ml", 
                    imageUrl: "https://giassi.vtexassets.com/arquivos/ids/2758294-800-450?v=638627569670200000&width=800&height=450&aspect=true", 
                    newPrice: 4.50, 
                    description: "...", 
                    accompaniments: { limit: 0, options: [] }, 
                    drinks: { limit: 0, options: [] } 
                },
                { 
                    id: 102, 
                    name: "Suco Natural de Laranja 500ml", 
                    imageUrl: "https://phygital-files.mercafacil.com/estrelaquatis/uploads/produto/suco_nat_estrela_manga_500ml_de2d07a5-09bf-4ce1-98d6-5fa2f9e4a5fa.jpg", 
                    newPrice: 8.00, 
                    description: "Laranja..", 
                    accompaniments: { limit: 0, options: [] }, 
                    drinks: { limit: 0, options: [] } 
                },
            ]
        },
        {
            category: "Sobremesas",
            products: [
                { 
                    id: 201, 
                    name: "Pudim de Leite", 
                    imageUrl: "https://www.mococa.com.br/wp-content/uploads/2023/08/img-pudim.jpg", 
                    newPrice: 7.50, 
                    description: "Uma fatia generosa de pudim caseiro.", 
                    accompaniments: { limit: 0, options: [] }, 
                    drinks: { limit: 0, options: [] } 
                },
            ]
        }
    ]
};

        // Vari√°veis globais
        // Vari√°veis globais
let config = { ...defaultConfig };
let cart = [];
let currentProductState = {};
const DB_NAME = 'TstDB';
const DB_VERSION = 1;
const STORE_NAME = 'cart';

// Bancos de dados separados
let firestoreDb = null;    // Para Firebase Firestore
let indexedDb = null;      // Para IndexedDB;

        const mainPage = document.getElementById('main-page');
        const productPage = document.getElementById('product-page');
        const cartCountEl = document.getElementById('cart-count');
        const cartModal = document.getElementById('cart-modal');
        const cartModalOverlay = document.getElementById('cart-modal-overlay');

        // ===================================================================================
        // =========================== SISTEMA FIREBASE ======================================
        // ===================================================================================

        // Carregar configura√ß√£o do Firebase

async function loadConfigFromFirebase() {
    try {
        // Verifica se firestoreDb est√° inicializado
        if (!firestoreDb) {
            console.warn('‚ö†Ô∏è Firestore n√£o inicializado, usando configura√ß√£o padr√£o');
            config = { ...defaultConfig };
            return;
        }
        
        console.log('üîÑ Carregando configura√ß√£o do Firebase...');
        const doc = await firestoreDb.collection('config').doc('shopConfig').get();
        
        if (doc.exists) {
            const firebaseConfig = doc.data();
            config = firebaseConfig;
            console.log('‚úÖ Configura√ß√£o carregada do Firebase');
        } else {
            console.log('üìù Criando configura√ß√£o padr√£o no Firebase...');
            await saveConfigToFirebase();
        }
    } catch (error) {
        console.error('‚ùå Erro ao carregar do Firebase:', error);
        // Fallback para configura√ß√£o padr√£o
        config = { ...defaultConfig };
    }
}

// Salvar configura√ß√£o no Firebase
async function saveConfigToFirebase() {
    try {
        // Verifica se firestoreDb est√° inicializado
        if (!firestoreDb) {
            console.warn('‚ö†Ô∏è Firestore n√£o inicializado, n√£o √© poss√≠vel salvar');
            return false;
        }
        
        console.log('üíæ Salvando configura√ß√£o no Firebase...');
        await firestoreDb.collection('config').doc('shopConfig').set(config, { merge: true });
        console.log('‚úÖ Configura√ß√£o salva no Firebase');
        return true;
    } catch (error) {
        console.error('‚ùå Erro ao salvar no Firebase:', error);
        alert('Erro ao salvar configura√ß√£o: ' + error.message);
        return false;
    }
}

        // ===================================================================================
        // =========================== SISTEMA DE INDEXEDDB ==================================
        // ===================================================================================

        // Inicializar o banco de dados
       function initDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => {
            console.error('Erro ao abrir o banco de dados');
            reject(request.error);
        };
        
        request.onsuccess = () => {
            indexedDb = request.result; // ‚Üê Use indexedDb
            console.log('‚úÖ IndexedDB inicializado com sucesso');
            resolve(indexedDb);
        };
        
        request.onupgradeneeded = (event) => {
            const database = event.target.result;
            
            if (!database.objectStoreNames.contains(STORE_NAME)) {
                const store = database.createObjectStore(STORE_NAME, { 
                    keyPath: 'id',
                    autoIncrement: true 
                });
                
                store.createIndex('productId', 'productId', { unique: false });
                store.createIndex('timestamp', 'timestamp', { unique: false });
            }
        };
    });
}

        // Salvar carrinho no IndexedDB
        async function saveCartToDB() {
    if (!indexedDb) return;
            
            return new Promise((resolve, reject) => {
        const transaction = indexedDb.transaction([STORE_NAME], 'readwrite'); // ‚Üê Use indexedDb
        const store = transaction.objectStore(STORE_NAME);
                
                const clearRequest = store.clear();
                
                clearRequest.onsuccess = () => {
                    if (cart.length === 0) {
                        resolve();
                        return;
                    }
                    
                    let completed = 0;
                    cart.forEach((item, index) => {
                        const itemWithTimestamp = {
                            ...item,
                            timestamp: Date.now() + index
                        };
                        
                        const request = store.add(itemWithTimestamp);
                        
                        request.onsuccess = () => {
                            completed++;
                            if (completed === cart.length) {
                                resolve();
                            }
                        };
                        
                        request.onerror = () => {
                            console.error('Erro ao salvar item no carrinho:', request.error);
                            reject(request.error);
                        };
                    });
                };
                
                clearRequest.onerror = () => {
                    console.error('Erro ao limpar carrinho:', clearRequest.error);
                    reject(clearRequest.error);
                };
            });
        }

        // Carregar carrinho do IndexedDB
        async function loadCartFromDB() {
    if (!indexedDb) return [];
            
            return new Promise((resolve, reject) => {
        const transaction = indexedDb.transaction([STORE_NAME], 'readonly'); // ‚Üê Use indexedDb
        const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const items = request.result.sort((a, b) => a.timestamp - b.timestamp);
                    resolve(items);
                };
                
                request.onerror = () => {
                    console.error('Erro ao carregar carrinho:', request.error);
                    reject(request.error);
                };
            });
        }

        // Atualizar carrinho (salva no DB e atualiza UI)
        async function updateCart(newCart) {
            cart = newCart;
            await saveCartToDB();
            updateCartCount();
            
            if (cartModal.classList.contains('open')) {
                renderCartItems();
            }
        }

        // ===================================================================================
        // ========================= FUN√á√ïES PRINCIPAIS ATUALIZADAS ==========================
        // ===================================================================================

        function formatPrice(price) { 
            if (price === undefined || price === null || isNaN(price)) {
                console.warn('Pre√ßo inv√°lido detectado:', price);
                return 'R$ 0,00';
            }
            return `R$ ${parseFloat(price).toFixed(2).replace('.', ',')}`; 
        }

        function validateCartItems(items) {
            return items.filter(item => {
                if (!item || typeof item !== 'object') return false;
                
                if (item.price === undefined || item.price === null || isNaN(item.price)) {
                    console.warn('Item com pre√ßo inv√°lido removido:', item);
                    return false;
                }
                
                if (!item.id || !item.name) {
                    console.warn('Item com estrutura inv√°lida removido:', item);
                    return false;
                }
                
                return true;
            }).map(item => {
                item.accompaniments = item.accompaniments || [];
                item.drinks = item.drinks || [];
                return item;
            });
        }

        async function renderMenuPage() {
            document.getElementById('shop-logo-main').src = config.shop.logoUrl;
            document.getElementById('shop-name-main').innerHTML = `${config.shop.name} <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#3b82f6" stroke="white" stroke-width="1"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>`;
            
            const categoryMenu = document.getElementById('category-menu');
            const menuContainer = document.getElementById('menu-container');
            categoryMenu.innerHTML = '';
            menuContainer.innerHTML = '';

            config.menu.forEach(cat => {
                const categoryId = `cat-${cat.category.replace(/\s+/g, '-')}`;
                categoryMenu.innerHTML += `<a href="#${categoryId}">${cat.category}</a>`;
                
                const section = document.createElement('section');
                section.id = categoryId;
                section.className = 'menu-category-section';
                
                const grid = document.createElement('div');
                grid.className = 'product-grid';

                cat.products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.onclick = () => showProductPage(product.id);
                    card.innerHTML = `<img src="${product.imageUrl}" alt="${product.name}"><div class="product-card-info"><div class="product-card-title">${product.name}</div>${product.delivery ? `<div class="product-card-delivery">${product.delivery}</div>` : ''}<div class="product-card-price">${product.oldPrice ? `<span class="old-price">de ${formatPrice(product.oldPrice)}</span>` : ''} <span class="new-price">${formatPrice(product.newPrice)}</span></div></div>`;
                    grid.appendChild(card);
                });
                
                section.innerHTML = `<div class="container"><h2 class="product-section-title">${cat.category}</h2></div>`;
                section.querySelector('.container').appendChild(grid);
                menuContainer.appendChild(section);
            });
            
            try {
                const savedCart = await loadCartFromDB();
                cart = validateCartItems(savedCart);
                updateCartCount();
                console.log('Carrinho carregado com sucesso:', cart.length, 'itens');
            } catch (error) {
                console.error('Erro ao carregar carrinho:', error);
                cart = [];
            }
        }

        function findProductById(productId) {
            for (const category of config.menu) {
                const product = category.products.find(p => p.id === productId);
                if (product) return product;
            }
            return null;
        }

        function showProductPage(productId) {
    const product = findProductById(productId);
    if (!product) return;
    
    const isEditing = currentProductState.editingItemId !== undefined;
    
    // Na fun√ß√£o showProductPage, dentro do if (!isEditing):
if (!isEditing) {
    currentProductState = { 
        product, 
        accompaniments: {}, 
        drinks: {},
        totalSelections: 1
    };

    // Inicializar com 1 unidade do produto (acompanhamento de quantidade)
    if (product.accompaniments && product.accompaniments.options.length > 0) {
        const quantityOption = product.accompaniments.options.find(opt => 
            opt.name.toLowerCase().includes('quantidade')
        );
        if (quantityOption) {
            currentProductState.accompaniments[quantityOption.name] = { 
                quantity: 1, 
                price: quantityOption.price 
            };
        }
    }
}
            
            document.getElementById('product-image-lg').src = product.imageUrl;
            document.getElementById('product-title-lg').textContent = product.name;
            document.getElementById('product-price-lg').innerHTML = `${product.oldPrice ? `<span class="old-price">de ${formatPrice(product.oldPrice)} por</span>` : ''}<span class="new-price">${formatPrice(product.newPrice)}</span>`;
            document.getElementById('product-stock').textContent = product.stock ? `apenas ${product.stock} dispon√≠veis` : '';
            document.getElementById('product-description').textContent = product.description;
            
            // Renderizar acompanhamentos
            const accompanimentsSection = document.getElementById('accompaniments-section');
            const accompanimentsList = document.getElementById('accompaniments-list');
            accompanimentsList.innerHTML = '';

            if (product.accompaniments && product.accompaniments.limit > 0) {
                accompanimentsSection.classList.remove('hidden');
                document.getElementById('accompaniments-subtitle').textContent = `Escolha at√© ${product.accompaniments.limit} op√ß√µes`;
                
                product.accompaniments.options.forEach(option => {
                    const item = document.createElement('div');
                    item.className = 'accompaniment-item';
                    
                    // Verificar se este acompanhamento j√° foi selecionado anteriormente
                    const existingSelection = currentProductState.accompaniments[option.name];
                    const currentQty = existingSelection ? existingSelection.quantity : 0;
                    
                    item.innerHTML = `
                        <div>
                            <div>${option.name}</div>
                            <div class="accompaniment-price">${option.price > 0 ? formatPrice(option.price) : 'Gr√°tis'}</div>
                        </div>
                        <div class="quantity-control">
                            <button class="quantity-btn minus-btn" onclick="updateAccompanimentQuantity('${option.name}', -1, ${option.price})" ${currentQty === 0 ? 'disabled' : ''}>-</button>
                            <span class="quantity-value" id="accompaniment-quantity-${option.name.replace(/\s/g, '')}">${currentQty}</span>
                            <button class="quantity-btn plus-btn" onclick="updateAccompanimentQuantity('${option.name}', 1, ${option.price})" ${currentProductState.totalSelections >= product.accompaniments.limit ? 'disabled' : ''}>+</button>
                        </div>`;
                    accompanimentsList.appendChild(item);
                });
            } else { 
                accompanimentsSection.classList.add('hidden'); 
            }

            // Renderizar bebidas
            const drinksSection = document.getElementById('drinks-section');
            const drinksList = document.getElementById('drinks-list');
            drinksList.innerHTML = '';

            if (product.drinks && product.drinks.limit > 0) {
                drinksSection.classList.remove('hidden');
                document.getElementById('drinks-subtitle').textContent = `Escolha at√© ${product.drinks.limit} op√ß√µes`;
                
                product.drinks.options.forEach(drink => {
                    const item = document.createElement('div');
                    item.className = 'accompaniment-item';
                    
                    // Verificar se esta bebida j√° foi selecionada anteriormente
                    const existingSelection = currentProductState.drinks[drink.name];
                    const currentQty = existingSelection ? existingSelection.quantity : 0;
                    
                    item.innerHTML = `
                        <div>
                            <div>${drink.name}</div>
                            <div class="accompaniment-price">${formatPrice(drink.price)}</div>
                        </div>
                        <div class="quantity-control">
                            <button class="quantity-btn minus-btn" onclick="updateDrinkQuantity('${drink.name}', -1, ${drink.price})" ${currentQty === 0 ? 'disabled' : ''}>-</button>
                            <span class="quantity-value" id="drink-quantity-${drink.name.replace(/\s/g, '')}">${currentQty}</span>
                            <button class="quantity-btn plus-btn" onclick="updateDrinkQuantity('${drink.name}', 1, ${drink.price})" ${currentProductState.totalSelections >= product.drinks.limit ? 'disabled' : ''}>+</button>
                        </div>`;
                    drinksList.appendChild(item);
                });
            } else { 
                drinksSection.classList.add('hidden'); 
            }

            // Atualizar bot√£o conforme o contexto (adicionar ou editar)
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            if (isEditing) {
                addToCartBtn.textContent = 'Atualizar Item';
                addToCartBtn.onclick = updateCartItem;
            } else {
                addToCartBtn.textContent = 'Adicionar ao carrinho';
                addToCartBtn.onclick = addToCart;
            }
            
            updateProductFooter();
            updateButtonsState();
            mainPage.classList.add('hidden');
            productPage.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function showMainPage() { 
            productPage.classList.add('hidden'); 
            mainPage.classList.remove('hidden'); 
            window.scrollTo(0, 0); 
        }
        
       function updateAccompanimentQuantity(option, change, price) {
    const { product, accompaniments } = currentProductState;
    const limit = product.accompaniments.limit;
    
    // Verificar se √© um acompanhamento de quantidade (n√£o deve contar no limite)
    const isQuantityOption = option.toLowerCase().includes('quantidade');
    
    const currentQty = accompaniments[option] ? accompaniments[option].quantity : 0;
    const newQty = currentQty + change;
    
    if (newQty < 0) return;
    
    // Se N√ÉO for quantidade, verificar o limite
    if (!isQuantityOption && change > 0) {
        const currentSelections = Object.entries(accompaniments)
            .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
            .reduce((total, [name, data]) => total + data.quantity, 0);
        
        if (currentSelections >= limit) return;
    }
    
    if (newQty === 0) {
        delete accompaniments[option];
    } else {
        accompaniments[option] = { 
            quantity: newQty, 
            price: isQuantityOption ? 0 : price // Pre√ßo zero apenas para quantidade
        };
    }
    
    // Atualizar contagem total (excluindo quantidade do produto)
    currentProductState.totalSelections = 
        Object.entries(accompaniments)
            .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
            .reduce((total, [name, data]) => total + data.quantity, 0) + 
        Object.values(currentProductState.drinks).reduce((a, b) => a + b.quantity, 0);
    
    document.getElementById(`accompaniment-quantity-${option.replace(/\s/g, '')}`).textContent = newQty;
    const minusBtn = document.querySelector(`#accompaniment-quantity-${option.replace(/\s/g, '')}`).previousElementSibling;
    minusBtn.disabled = newQty === 0;
    
    // Atualizar estado dos bot√µes + (apenas para n√£o-quantidade)
    const isMax = currentProductState.totalSelections >= limit;
    document.querySelectorAll('.plus-btn').forEach(btn => {
        if (!btn.closest('.accompaniment-item')?.textContent.includes('Quantidade')) {
            btn.disabled = isMax;
        }
    });
    
    updateProductFooter();
    updateButtonsState();
}

function updateDrinkQuantity(drink, change, price) {
    const { product, drinks } = currentProductState;
    const limit = product.drinks.limit;
    const currentQty = drinks[drink] ? drinks[drink].quantity : 0;
    const newQty = currentQty + change;
    
    if (newQty < 0) return;
    
    // Verificar limite para bebidas
    if (change > 0) {
        const currentDrinkSelections = Object.values(drinks).reduce((total, data) => total + data.quantity, 0);
        if (currentDrinkSelections >= limit) return;
    }
    
    if (newQty === 0) {
        delete drinks[drink];
    } else {
        drinks[drink] = { quantity: newQty, price: price };
    }
    
    // Atualizar contagem total (bebidas + acompanhamentos exceto quantidade)
    // Dentro de showProductPage, substitua a inicializa√ß√£o do totalSelections:
currentProductState.totalSelections = 
    Object.entries(currentProductState.accompaniments)
        .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
        .reduce((total, [name, data]) => total + data.quantity, 0) + 
    Object.values(currentProductState.drinks).reduce((a, b) => a + b.quantity, 0);
    
    document.getElementById(`drink-quantity-${drink.replace(/\s/g, '')}`).textContent = newQty;
    const minusBtn = document.querySelector(`#drink-quantity-${drink.replace(/\s/g, '')}`).previousElementSibling;
    minusBtn.disabled = newQty === 0;
    
    // Atualizar estado dos bot√µes + para bebidas
    const isMax = Object.values(drinks).reduce((total, data) => total + data.quantity, 0) >= limit;
    document.querySelectorAll('#drinks-list .plus-btn').forEach(btn => {
        btn.disabled = isMax;
    });
    
    updateProductFooter();
}
        
     function updateProductFooter() {
    const { product, accompaniments, drinks } = currentProductState;
    
    // Encontrar a quantidade do produto (acompanhamento de quantidade)
    let productQuantity = 1;
    Object.entries(accompaniments).forEach(([name, data]) => {
        if (name.toLowerCase().includes('quantidade')) {
            productQuantity = data.quantity;
        }
    });
    
    // Calcular pre√ßo total = (pre√ßo unit√°rio √ó quantidade) + bebidas
    let totalPrice = product.newPrice * productQuantity;
    
    // Somar bebidas
    Object.values(drinks).forEach(drink => {
        totalPrice += drink.price * drink.quantity;
    });
    
    document.getElementById('footer-price').textContent = formatPrice(totalPrice);
} 
   async function addToCart() {
    const { product, accompaniments, drinks } = currentProductState;
    
    // Calcular quantidade do produto
    let productQuantity = 1;
    const accompanimentsArray = Object.entries(accompaniments).map(([name, data]) => {
        // Se for o acompanhamento de quantidade, usa para definir a quantidade do produto
        if (name.toLowerCase().includes('quantidade')) {
            productQuantity = data.quantity;
        }
        return { 
            name, 
            quantity: data.quantity, 
            price: data.price 
        };
    });
    
    const drinksArray = Object.entries(drinks).map(([name, data]) => ({ 
        name, 
        quantity: data.quantity, 
        price: data.price 
    }));
    
    // Calcular pre√ßo total CORRETAMENTE
    // Pre√ßo base √ó quantidade + bebidas
    let itemPrice = product.newPrice * productQuantity;
    
    // Somar bebidas
    drinksArray.forEach(drink => {
        itemPrice += drink.price * drink.quantity;
    });
    
    const newItem = {
        id: Date.now(),
        productId: product.id,
        name: product.name,
        basePrice: product.newPrice,
        price: itemPrice,
        quantity: productQuantity,
        accompaniments: accompanimentsArray,
        drinks: drinksArray,
        timestamp: Date.now()
    };
    
    const newCart = [...cart, newItem];
    await updateCart(newCart);
    
    showMainPage();
}
        function updateCartCount() { 
            cartCountEl.textContent = cart.length; 
        }

        async function openCart() {
            await renderCartItems();
            cartModal.classList.add('open');
            cartModalOverlay.classList.add('open');
        }

        function closeCart() {
            cartModal.classList.remove('open');
            cartModalOverlay.classList.remove('open');
        }

        async function renderCartItems() {
            const container = document.getElementById('cart-items-container');
            container.innerHTML = '';
            
            if (cart.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--dark-gray);">Seu carrinho est√° vazio</div>';
                document.getElementById('cart-total-price').textContent = formatPrice(0);
                return;
            }
            
            let total = 0;
            
            try {
                cart.forEach((item, index) => {
                    if (!item || typeof item !== 'object') {
                        console.warn('Item inv√°lido encontrado no carrinho:', item);
                        return;
                    }
                    
                    const itemPrice = item.price && !isNaN(item.price) ? parseFloat(item.price) : 0;
                    total += itemPrice;
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    
                    let accompanimentsText = '';
                    if (item.accompaniments && Array.isArray(item.accompaniments) && item.accompaniments.length > 0) {
                        accompanimentsText += 'Acompanhamentos: ' + item.accompaniments.map(a => {
                            return `${a.quantity}x ${a.name}`;
                        }).join(', ');
                    }
                    
                    if (item.drinks && Array.isArray(item.drinks) && item.drinks.length > 0) {
                        if (accompanimentsText) accompanimentsText += '<br>';
                        accompanimentsText += 'Bebidas: ' + item.drinks.map(d => {
                            return `${d.quantity}x ${d.name}`;
                        }).join(', ');
                    }
                    
                   // Na fun√ß√£o renderCartItems(), modifique a exibi√ß√£o do nome do produto:
itemEl.innerHTML = `
    <div class="cart-item-header">
        <div class="cart-item-name">${item.name || 'Produto sem nome'} ${item.quantity > 1 ? `(${item.quantity}x)` : ''}</div>
        <div class="cart-item-price">${formatPrice(itemPrice)}</div>
    </div>
    ${accompanimentsText ? `<div class="cart-item-accompaniments">${accompanimentsText}</div>` : ''}
    <div class="cart-item-actions">
        <div class="cart-item-edit" onclick="editCartItem(${item.id})">Editar</div>
        <div class="cart-item-remove" onclick="removeFromCart(${item.id})">Remover</div>
    </div>
`;
                    container.appendChild(itemEl);
                });
            } catch (error) {
                console.error('Erro ao renderizar itens do carrinho:', error);
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Erro ao carregar carrinho</div>';
                total = 0;
            }
            
            document.getElementById('cart-total-price').textContent = formatPrice(total);
        }

        async function removeFromCart(itemId) {
            const newCart = cart.filter(item => item.id !== itemId);
            await updateCart(newCart);
        }

        function editCartItem(itemId) {
            const item = cart.find(item => item.id === itemId);
            if (!item) return;
            
            const originalProduct = findProductById(item.productId);
            if (!originalProduct) return;
            
            // Preencher o estado atual com os dados do item do carrinho
            currentProductState = {
                product: originalProduct,
                accompaniments: {},
                drinks: {},
                totalSelections: 0,
                editingItemId: itemId
            };
            
            // Preencher acompanhamentos do item existente
            if (item.accompaniments && Array.isArray(item.accompaniments)) {
                item.accompaniments.forEach(accomp => {
                    currentProductState.accompaniments[accomp.name] = {
                        quantity: accomp.quantity,
                        price: accomp.price
                    };
                    currentProductState.totalSelections += accomp.quantity;
                });
            }
            
            // Preencher bebidas do item existente
            if (item.drinks && Array.isArray(item.drinks)) {
                item.drinks.forEach(drink => {
                    currentProductState.drinks[drink.name] = {
                        quantity: drink.quantity,
                        price: drink.price
                    };
                    currentProductState.totalSelections += drink.quantity;
                });
            }
            
            // Mostrar p√°gina do produto com os dados pr√©-preenchidos
            showProductPage(originalProduct.id);
            closeCart();
            updateProductFooter();
        }

    async function updateCartItem() {
    const { product, accompaniments, drinks, editingItemId } = currentProductState;
    
    // Calcular quantidade do produto
    let productQuantity = 1;
    const accompanimentsArray = Object.entries(accompaniments).map(([name, data]) => {
        if (name.toLowerCase().includes('quantidade')) {
            productQuantity = data.quantity;
        }
        return { name, ...data };
    });
    
    const drinksArray = Object.entries(drinks).map(([name, data]) => ({ name, ...data }));
    
    // Calcular pre√ßo total CORRETAMENTE
    let itemPrice = product.newPrice * productQuantity;
    
    // Somar bebidas
    drinksArray.forEach(drink => {
        itemPrice += drink.price * drink.quantity;
    });
    
    const updatedItem = {
        id: editingItemId,
        productId: product.id,
        name: product.name,
        basePrice: product.newPrice,
        price: itemPrice,
        quantity: productQuantity,
        accompaniments: accompanimentsArray,
        drinks: drinksArray,
        timestamp: Date.now()
    };
    
    const newCart = cart.map(item => item.id === editingItemId ? updatedItem : item);
    await updateCart(newCart);
    
    // Limpar estado de edi√ß√£o
    currentProductState.editingItemId = undefined;
    
    showMainPage();
}

      function handlePaymentChange() {
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    const changeGroup = document.getElementById('change-group');
    const cardTypeGroup = document.getElementById('card-type-group');
    
    // Esconder todos os grupos primeiro
    changeGroup.classList.add('hidden');
    cardTypeGroup.classList.add('hidden');
    
    // Mostrar apenas o grupo relevante
    if (paymentMethod === 'Dinheiro') {
        changeGroup.classList.remove('hidden');
    } else if (paymentMethod === 'Cart√£o') {
        cardTypeGroup.classList.remove('hidden');
    }
}

        async function finalizeOrder() {
    const customerName = document.getElementById('customer-name').value.trim();
    const customerAddress = document.getElementById('customer-address').value.trim();
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    const changeFor = document.getElementById('customer-change').value.trim();
    const cardType = document.querySelector('input[name="cardType"]:checked')?.value || '';
    
    if (!customerName || !customerAddress) {
        alert('Por favor, preencha seu nome e endere√ßo.');
        return;
    }
    
    let total = 0;
    let message = `*NOVO PEDIDO - ${config.shop.name}*%0A%0A`;
    message += `*Cliente:* ${customerName}%0A`;
    message += `*Endere√ßo:* ${customerAddress}%0A`;
    message += `*Pagamento:* ${paymentMethod}`;
    
    // Adicionar informa√ß√µes espec√≠ficas do pagamento
    if (paymentMethod === 'Dinheiro' && changeFor) {
        message += ` (Troco para R$ ${changeFor})`;
    } else if (paymentMethod === 'Cart√£o') {
        message += ` (${cardType})`;
    }
    
    message += `%0A%0A*Itens do Pedido:*%0A`;
    
    cart.forEach((item, index) => {
        const itemPrice = item.price && !isNaN(item.price) ? parseFloat(item.price) : 0;
        total += itemPrice;
        
        message += `%0A*${index + 1}. ${item.name || 'Produto sem nome'}* - ${formatPrice(itemPrice)}%0A`;
        
        if (item.accompaniments && Array.isArray(item.accompaniments) && item.accompaniments.length > 0) {
            message += `   Acompanhamentos: `;
            item.accompaniments.forEach(accomp => {
                message += `${accomp.quantity}x ${accomp.name}, `;
            });
            message = message.slice(0, -2) + '%0A';
        }
        
        if (item.drinks && Array.isArray(item.drinks) && item.drinks.length > 0) {
            message += `   Bebidas: `;
            item.drinks.forEach(drink => {
                message += `${drink.quantity}x ${drink.name}, `;
            });
            message = message.slice(0, -2) + '%0A';
        }
    });
    
    message += `%0A*Total: ${formatPrice(total)}*`;
    
    const whatsappUrl = `https://wa.me/${config.whatsappNumber}?text=${message}`;
    window.open(whatsappUrl, '_blank');
    
    await updateCart([]);
    closeCart();
    
    // Limpar formul√°rios
    document.getElementById('customer-name').value = '';
    document.getElementById('customer-address').value = '';
    document.getElementById('customer-change').value = '';
    
    // Resetar para Pix como padr√£o
    document.querySelector('input[value="Pix"]').checked = true;
    handlePaymentChange();
}

        // Inicializar a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', async () => {
    try {
        // 1. Primeiro inicializa Firebase
        console.log('üîÑ Inicializando Firebase...');
        
        // 2. Depois inicializa IndexedDB
        await initDB();
        
        // 3. Agora carrega configura√ß√£o do Firebase
        await loadConfigFromFirebase();
        
        // 4. Finalmente renderiza o menu
        await renderMenuPage();
        
        console.log('‚úÖ Aplica√ß√£o inicializada com sucesso');
    } catch (error) {
        console.error('‚ùå Erro ao inicializar aplica√ß√£o:', error);
        // Fallback: usa configura√ß√£o padr√£o mesmo com erro
        config = { ...defaultConfig };
        await renderMenuPage();
    }
});
        function updateButtonsState() {
    const { product, accompaniments, drinks } = currentProductState;
    
    // Atualizar bot√µes de acompanhamentos (exceto quantidade)
    const accompanimentsSelections = Object.entries(accompaniments)
        .filter(([name, data]) => !name.toLowerCase().includes('quantidade'))
        .reduce((total, [name, data]) => total + data.quantity, 0);
    
    const isAccompanimentsMax = accompanimentsSelections >= product.accompaniments.limit;
    
    document.querySelectorAll('#accompaniments-list .plus-btn').forEach(btn => {
        if (!btn.closest('.accompaniment-item')?.textContent.includes('Quantidade')) {
            btn.disabled = isAccompanimentsMax;
        }
    });
    
    // Atualizar bot√µes de bebidas
    const drinksSelections = Object.values(drinks).reduce((total, data) => total + data.quantity, 0);
    const isDrinksMax = drinksSelections >= product.drinks.limit;
    
    document.querySelectorAll('#drinks-list .plus-btn').forEach(btn => {
        btn.disabled = isDrinksMax;
    });
}

        // ===================================================================================
        // =========================== SISTEMA ADMINISTRATIVO ===============================
        // ===================================================================================

        const ADMIN_CONFIG = {
            password: "david123", // MUDE ESTA SENHA!
            currentCategory: null,
            editingProduct: null
        };

        // Sistema de acesso por atalho de teclado
        let adminKeySequence = [];
        const ADMIN_SECRET_CODE = ['Control', 'Alt', 'a']; // Ctrl + Alt + A

        document.addEventListener('keydown', function(event) {
            adminKeySequence.push(event.key);
            
            // Mant√©m apenas os √∫ltimos 3 pressionamentos
            if (adminKeySequence.length > 3) {
                adminKeySequence.shift();
            }
            
            // Verifica se a sequ√™ncia corresponde ao c√≥digo secreto
            if (adminKeySequence.join(',') === ADMIN_SECRET_CODE.join(',')) {
                showAdminAccessButton();
                adminKeySequence = []; // Reseta a sequ√™ncia
            }
        });

        function showAdminAccessButton() {
            const adminArea = document.getElementById('admin-access-area');
            adminArea.style.display = 'block';
            
            // Esconde automaticamente ap√≥s 10 segundos por seguran√ßa
            setTimeout(() => {
                adminArea.style.display = 'none';
            }, 10000);
            
            console.log('üîì Bot√£o admin ativado - Dispon√≠vel por 10 segundos');
        }

        function openAdminLogin() {
            const password = prompt("üîê Digite a senha de administrador:");
            if (password === ADMIN_CONFIG.password) {
                openAdminPanel();
                // Esconde o bot√£o ap√≥s acesso bem-sucedido
                document.getElementById('admin-access-area').style.display = 'none';
            } else if (password) {
                alert("‚ùå Senha incorreta!");
            }
        }

        function openAdminPanel() {
            document.getElementById('admin-panel').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Previne scroll na p√°gina principal
            loadAdminDashboard();
        }

        function closeAdmin() {
            document.getElementById('admin-panel').classList.add('hidden');
            document.body.style.overflow = 'auto'; // Restaura scroll
            ADMIN_CONFIG.editingProduct = null;
            ADMIN_CONFIG.currentCategory = null;
        }

        function loadAdminDashboard() {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="admin-card" style="background: #f0f9ff; padding: 20px; border-radius: 10px; border: 1px solid #bae6fd;">
                        <h3 style="color: #0369a1; margin-top: 0;">üìä Estat√≠sticas da Loja</h3>
                        <p><strong>Total de Produtos:</strong> ${getTotalProducts()}</p>
                        <p><strong>Total de Categorias:</strong> ${config.menu.length}</p>
                        <p><strong>√öltima Atualiza√ß√£o:</strong> ${new Date().toLocaleString()}</p>
                    </div>
                    <div class="admin-card" style="background: #f0fdf4; padding: 20px; border-radius: 10px; border: 1px solid #bbf7d0;">
                        <h3 style="color: #15803d; margin-top: 0;">‚ö° A√ß√µes R√°pidas</h3>
                        <button onclick="showAddProductForm()" style="width: 100%; padding: 12px; background: #16a34a; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 0; font-weight: bold;">‚ûï Adicionar Produto</button>
                        <button onclick="showAddCategoryForm()" style="width: 100%; padding: 12px; background: #f97316; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 0; font-weight: bold;">üìÅ Nova Categoria</button>
                        <button onclick="exportConfig()" style="width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 0; font-weight: bold;">üíæ Backup dos Dados</button>
                    </div>
                </div>
                
                <div class="admin-card" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e5e7eb;">
                    <h3 style="color: #1f2937; margin-top: 0;">üì¶ Gerenciar Produtos</h3>
                    ${renderCategoryTabs()}
                    <div id="products-management-area" style="margin-top: 20px;">
                        ${renderProductsManagement()}
                    </div>
                </div>
            `;
        }

        function renderCategoryTabs() {
            return `
                <div style="margin-bottom: 20px;">
                    <p style="color: #6b7280; margin-bottom: 10px;"><strong>Selecione uma categoria:</strong></p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${config.menu.map(category => `
                            <button onclick="selectAdminCategory('${category.category}')" 
                                style="padding: 10px 20px; 
                                       background: ${ADMIN_CONFIG.currentCategory === category.category ? '#f97316' : '#f3f4f6'}; 
                                       color: ${ADMIN_CONFIG.currentCategory === category.category ? 'white' : '#374151'}; 
                                       border: 1px solid #d1d5db;
                                       border-radius: 8px; 
                                       cursor: pointer;
                                       font-weight: bold;
                                       transition: all 0.3s ease;">
                                ${category.category}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function selectAdminCategory(categoryName) {
            ADMIN_CONFIG.currentCategory = categoryName;
            loadAdminDashboard();
        }

        function renderProductsManagement() {
            if (!ADMIN_CONFIG.currentCategory && config.menu.length > 0) {
                ADMIN_CONFIG.currentCategory = config.menu[0].category;
            }
            
            const category = config.menu.find(cat => cat.category === ADMIN_CONFIG.currentCategory);
            if (!category) return '<p style="text-align: center; color: #6b7280;">Selecione uma categoria para gerenciar os produtos</p>';
            
            return `
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h4 style="margin: 0; color: #374151;">Produtos em "${category.category}"</h4>
                        <span style="color: #6b7280;">${category.products.length} produto(s)</span>
                    </div>
                    
                    <button onclick="showAddProductForm()" style="padding: 12px 25px; background: #16a34a; color: white; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 20px; font-weight: bold; display: flex; align-items: center; gap: 8px;">
                        ‚ûï Adicionar Produto
                    </button>
                    
                    <div style="display: grid; gap: 15px;">
                        ${category.products.length > 0 ? 
                            category.products.map(product => `
                                <div style="border: 1px solid #e5e7eb; padding: 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; background: #fafafa;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                            <strong style="font-size: 1.1em; color: #1f2937;">${product.name}</strong>
                                            <span style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">
                                                ${formatPrice(product.newPrice)}
                                            </span>
                                            ${product.oldPrice ? `
                                                <span style="text-decoration: line-through; color: #6b7280; font-size: 0.9em;">
                                                    ${formatPrice(product.oldPrice)}
                                                </span>
                                            ` : ''}
                                        </div>
                                        <div style="color: #6b7280; font-size: 0.9em;">
                                            ID: ${product.id} 
                                            ${product.stock ? `| Estoque: ${product.stock}` : ''}
                                            ${product.delivery ? `| ${product.delivery}` : ''}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button onclick="editProductAdmin(${product.id})" style="padding: 8px 15px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                            ‚úèÔ∏è Editar
                                        </button>
                                        <button onclick="deleteProductAdmin(${product.id})" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                            üóëÔ∏è Excluir
                                        </button>
                                    </div>
                                </div>
                            `).join('') 
                        : 
                            '<div style="text-align: center; padding: 40px; color: #6b7280; background: #f9fafb; border-radius: 10px; border: 2px dashed #d1d5db;">Nenhum produto nesta categoria</div>'
                        }
                    </div>
                </div>
            `;
        }

        function showAddProductForm() {
            const category = config.menu.find(cat => cat.category === ADMIN_CONFIG.currentCategory);
            if (!category) {
                alert('Selecione uma categoria primeiro!');
                return;
            }
            
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = `
                <div style="max-width: 600px;">
                    <h3>‚ûï Adicionar Novo Produto</h3>
                    <form onsubmit="saveNewProduct(event)" style="display: grid; gap: 15px;">
                        <div>
                            <label><strong>Nome do Produto:</strong></label>
                            <input type="text" id="product-name" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label><strong>Pre√ßo Atual (R$):</strong></label>
                                <input type="number" id="product-newPrice" step="0.01" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                            </div>
                            <div>
                                <label><strong>Pre√ßo Antigo (opcional):</strong></label>
                                <input type="number" id="product-oldPrice" step="0.01" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label><strong>URL da Imagem:</strong></label>
                                <input type="text" id="product-imageUrl" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="https://...">
                            </div>
                            <div>
                                <label><strong>Estoque:</strong></label>
                                <input type="number" id="product-stock" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                            </div>
                        </div>
                        
                        <div>
                            <label><strong>Descri√ß√£o:</strong></label>
                            <textarea id="product-description" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; height: 80px;"></textarea>
                        </div>
                        
                        <div>
                            <label><strong>Entrega:</strong></label>
                            <input type="text" id="product-delivery" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="Entrega gr√°tis">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" style="padding: 12px 30px; background: #16a34a; color: white; border: none; border-radius: 5px; cursor: pointer;">üíæ Salvar Produto</button>
                            <button type="button" onclick="loadAdminDashboard()" style="padding: 12px 30px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer;">‚Ü©Ô∏è Voltar</button>
                        </div>
                    </form>
                </div>
            `;
        }

        async function saveNewProduct(event) {
            event.preventDefault();
            
            const category = config.menu.find(cat => cat.category === ADMIN_CONFIG.currentCategory);
            if (!category) return;
            
            const newProduct = {
                id: generateProductId(),
                name: document.getElementById('product-name').value,
                newPrice: parseFloat(document.getElementById('product-newPrice').value),
                oldPrice: document.getElementById('product-oldPrice').value ? parseFloat(document.getElementById('product-oldPrice').value) : null,
                imageUrl: document.getElementById('product-imageUrl').value || "https://via.placeholder.com/300x200?text=Produto",
                description: document.getElementById('product-description').value,
                delivery: document.getElementById('product-delivery').value || "Entrega gr√°tis",
                stock: document.getElementById('product-stock').value ? parseInt(document.getElementById('product-stock').value) : null,
                accompaniments: { limit: 0, options: [] },
                drinks: { limit: 0, options: [] }
            };
            
            category.products.push(newProduct);
            
            // Salva no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                alert('‚úÖ Produto adicionado com sucesso!');
                loadAdminDashboard();
            }
        }

        function generateProductId() {
            return Math.max(...config.menu.flatMap(cat => cat.products.map(p => p.id)), 0) + 1;
        }

        function editProductAdmin(productId) {
            const product = findProductById(productId);
            if (!product) return;
            
            ADMIN_CONFIG.editingProduct = product;
            showEditProductForm(product);
        }

        function showEditProductForm(product) {
            const adminContent = document.getElementById('admin-content');
            
            adminContent.innerHTML = `
                <div style="max-width: 100%;">
                    <h3 style="color: #f97316; margin-bottom: 20px;">‚úèÔ∏è Editar Produto: ${product.name}</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
                        
                        <!-- COLUNA DA ESQUERDA - INFORMA√á√ïES B√ÅSICAS -->
                        <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e5e7eb;">
                            <h4 style="color: #374151; margin-top: 0; border-bottom: 2px solid #f97316; padding-bottom: 10px;">üìã Informa√ß√µes B√°sicas</h4>
                            
                            <form onsubmit="saveEditedProduct(event)" style="display: grid; gap: 15px;">
                                <input type="hidden" id="edit-product-id" value="${product.id}">
                                
                                <div>
                                    <label><strong>Nome do Produto:</strong></label>
                                    <input type="text" id="edit-product-name" value="${product.name}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label><strong>Pre√ßo Atual (R$):</strong></label>
                                        <input type="number" id="edit-product-newPrice" step="0.01" value="${product.newPrice}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                                    </div>
                                    <div>
                                        <label><strong>Pre√ßo Antigo (opcional):</strong></label>
                                        <input type="number" id="edit-product-oldPrice" step="0.01" value="${product.oldPrice || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                                    </div>
                                </div>
                                
                                <div>
                                    <label><strong>URL da Imagem:</strong></label>
                                    <input type="text" id="edit-product-imageUrl" value="${product.imageUrl}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="https://...">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label><strong>Estoque:</strong></label>
                                        <input type="number" id="edit-product-stock" value="${product.stock || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                                    </div>
                                    <div>
                                        <label><strong>Entrega:</strong></label>
                                        <input type="text" id="edit-product-delivery" value="${product.delivery || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="Entrega gr√°tis">
                                    </div>
                                </div>
                                
                                <div>
                                    <label><strong>Descri√ß√£o:</strong></label>
                                    <textarea id="edit-product-description" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; height: 80px; resize: vertical;">${product.description || ''}</textarea>
                                </div>
                            </form>
                        </div>
                        
                        <!-- COLUNA DA DIREITA - ACOMPANHAMENTOS E BEBIDAS -->
                        <div style="display: grid; gap: 20px;">
                            
                            <!-- SE√á√ÉO ACOMPANHAMENTOS -->
                            <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <h4 style="color: #374151; margin-top: 0; border-bottom: 2px solid #f97316; padding-bottom: 10px;">üçΩÔ∏è Acompanhamentos</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <label><strong>Limite de Acompanhamentos:</strong></label>
                                    <input type="number" id="edit-product-accomp-limit" value="${product.accompaniments?.limit || 0}" min="0" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                                </div>
                                
                                <button type="button" onclick="addAccompanimentOption()" style="width: 100%; padding: 12px; background: #f97316; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 15px; font-weight: bold;">
                                    ‚ûï Adicionar Op√ß√£o de Acompanhamento
                                </button>
                                
                                <div id="edit-accompaniments-options" style="max-height: 300px; overflow-y: auto; display: grid; gap: 10px;">
                                    ${product.accompaniments?.options?.map((option, index) => `
                                        <div class="accompaniment-option" style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                                                <div>
                                                    <label><small>Nome:</small></label>
                                                    <input type="text" value="${option.name}" class="accomp-name" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;">
                                                </div>
                                                <div>
                                                    <label><small>Pre√ßo (R$):</small></label>
                                                    <input type="number" step="0.01" value="${option.price}" class="accomp-price" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;">
                                                </div>
                                                <button type="button" onclick="removeAccompanimentOption(this)" style="padding: 8px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </div>
                                    `).join('') || ''}
                                </div>
                            </div>
                            
                            <!-- SE√á√ÉO BEBIDAS -->
                            <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <h4 style="color: #374151; margin-top: 0; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">ü•§ Bebidas</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <label><strong>Limite de Bebidas:</strong></label>
                                    <input type="number" id="edit-product-drinks-limit" value="${product.drinks?.limit || 0}" min="0" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;">
                                </div>
                                
                                <button type="button" onclick="addDrinkOption()" style="width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 15px; font-weight: bold;">
                                    ‚ûï Adicionar Op√ß√£o de Bebida
                                </button>
                                
                                <div id="edit-drinks-options" style="max-height: 300px; overflow-y: auto; display: grid; gap: 10px;">
                                    ${product.drinks?.options?.map((drink, index) => `
                                        <div class="drink-option" style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                                                <div>
                                                    <label><small>Nome:</small></label>
                                                    <input type="text" value="${drink.name}" class="drink-name" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;">
                                                </div>
                                                <div>
                                                    <label><small>Pre√ßo (R$):</small></label>
                                                    <input type="number" step="0.01" value="${drink.price}" class="drink-price" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;">
                                                </div>
                                                <button type="button" onclick="removeDrinkOption(this)" style="padding: 8px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </div>
                                    `).join('') || ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- BOT√ïES DE A√á√ÉO NO FINAL -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; display: flex; gap: 15px; justify-content: center;">
                        <button type="submit" onclick="document.querySelector('form').requestSubmit()" style="padding: 15px 40px; background: #16a34a; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1em;">
                            üíæ Salvar Altera√ß√µes
                        </button>
                        <button type="button" onclick="loadAdminDashboard()" style="padding: 15px 40px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1em;">
                            ‚Ü©Ô∏è Voltar
                        </button>
                    </div>
                </div>
            `;
        }

        function addAccompanimentOption() {
            const container = document.getElementById('edit-accompaniments-options');
            const newOption = document.createElement('div');
            newOption.className = 'accompaniment-option';
            newOption.innerHTML = `
                <div style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                        <div>
                            <label><small>Nome:</small></label>
                            <input type="text" class="accomp-name" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="Ex: Quantidade, Molho...">
                        </div>
                        <div>
                            <label><small>Pre√ßo (R$):</small></label>
                            <input type="number" step="0.01" value="0" class="accomp-price" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;">
                        </div>
                        <button type="button" onclick="removeAccompanimentOption(this)" style="padding: 8px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(newOption);
        }

        function addDrinkOption() {
            const container = document.getElementById('edit-drinks-options');
            const newOption = document.createElement('div');
            newOption.className = 'drink-option';
            newOption.innerHTML = `
                <div style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; background: #f9fafb;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                        <div>
                            <label><small>Nome:</small></label>
                            <input type="text" class="drink-name" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="Ex: Refrigerante, Suco...">
                        </div>
                        <div>
                            <label><small>Pre√ßo (R$):</small></label>
                            <input type="number" step="0.01" value="0" class="drink-price" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;">
                        </div>
                        <button type="button" onclick="removeDrinkOption(this)" style="padding: 8px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(newOption);
        }

        function removeAccompanimentOption(button) {
            button.closest('.accompaniment-option').remove();
        }

        function removeDrinkOption(button) {
            button.closest('.drink-option').remove();
        }

        async function saveEditedProduct(event) {
            event.preventDefault();
            
            const productId = parseInt(document.getElementById('edit-product-id').value);
            
            // Encontrar o produto na configura√ß√£o
            let targetProduct = null;
            let targetCategory = null;
            
            for (let category of config.menu) {
                const product = category.products.find(p => p.id === productId);
                if (product) {
                    targetProduct = product;
                    targetCategory = category;
                    break;
                }
            }
            
            if (!targetProduct) {
                alert('‚ùå Produto n√£o encontrado!');
                return;
            }
            
            // Coletar dados do formul√°rio
            const updatedProduct = {
                id: productId,
                name: document.getElementById('edit-product-name').value,
                newPrice: parseFloat(document.getElementById('edit-product-newPrice').value),
                oldPrice: document.getElementById('edit-product-oldPrice').value ? parseFloat(document.getElementById('edit-product-oldPrice').value) : null,
                imageUrl: document.getElementById('edit-product-imageUrl').value || "https://via.placeholder.com/300x200?text=Produto",
                description: document.getElementById('edit-product-description').value,
                delivery: document.getElementById('edit-product-delivery').value || "Entrega gr√°tis",
                stock: document.getElementById('edit-product-stock').value ? parseInt(document.getElementById('edit-product-stock').value) : null,
                accompaniments: {
                    limit: parseInt(document.getElementById('edit-product-accomp-limit').value) || 0,
                    options: []
                },
                drinks: {
                    limit: parseInt(document.getElementById('edit-product-drinks-limit').value) || 0,
                    options: []
                }
            };
            
            // Coletar acompanhamentos
            const accompanimentOptions = document.querySelectorAll('.accompaniment-option');
            accompanimentOptions.forEach(option => {
                const name = option.querySelector('.accomp-name').value;
                const price = parseFloat(option.querySelector('.accomp-price').value);
                
                if (name.trim()) {
                    updatedProduct.accompaniments.options.push({
                        name: name.trim(),
                        price: price
                    });
                }
            });
            
            // Coletar bebidas
            const drinkOptions = document.querySelectorAll('.drink-option');
            drinkOptions.forEach(option => {
                const name = option.querySelector('.drink-name').value;
                const price = parseFloat(option.querySelector('.drink-price').value);
                
                if (name.trim()) {
                    updatedProduct.drinks.options.push({
                        name: name.trim(),
                        price: price
                    });
                }
            });
            
            // Atualizar o produto na configura√ß√£o
            Object.assign(targetProduct, updatedProduct);
            
            // Salvar no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                alert('‚úÖ Produto atualizado com sucesso!');
                loadAdminDashboard();
            }
        }

        async function deleteProductAdmin(productId) {
            if (!confirm('‚ùå Tem certeza que deseja excluir este produto?')) return;
            
            for (let category of config.menu) {
                const index = category.products.findIndex(p => p.id === productId);
                if (index !== -1) {
                    category.products.splice(index, 1);
                    break;
                }
            }
            
            // Salva no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                alert('‚úÖ Produto exclu√≠do com sucesso!');
                loadAdminDashboard();
            }
        }

        // Salvar configura√ß√µes
        function saveConfigToLocalStorage() {
            localStorage.setItem('panificadoraConfig', JSON.stringify(config));
            // Salva tamb√©m no Firebase
            saveConfigToFirebase();
            // Recarrega o menu para refletir as mudan√ßas
            renderMenuPage();
        }

        // Carregar configura√ß√µes do localStorage ao iniciar
        function loadConfigFromLocalStorage() {
            const savedConfig = localStorage.getItem('panificadoraConfig');
            if (savedConfig) {
                Object.assign(config, JSON.parse(savedConfig));
            }
        }

        function getTotalProducts() {
            return config.menu.reduce((total, category) => total + category.products.length, 0);
        }

        function showAddCategoryForm() {
            const adminContent = document.getElementById('admin-content');
            adminContent.innerHTML = `
                <div style="max-width: 500px;">
                    <h3>üìÅ Nova Categoria</h3>
                    <form onsubmit="saveNewCategory(event)" style="display: grid; gap: 15px;">
                        <div>
                            <label><strong>Nome da Categoria:</strong></label>
                            <input type="text" id="category-name" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px;" placeholder="Ex: Salgados, Doces, Bebidas...">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" style="padding: 12px 30px; background: #16a34a; color: white; border: none; border-radius: 5px; cursor: pointer;">üíæ Criar Categoria</button>
                            <button type="button" onclick="loadAdminDashboard()" style="padding: 12px 30px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer;">‚Ü©Ô∏è Voltar</button>
                        </div>
                    </form>
                </div>
            `;
        }

        async function saveNewCategory(event) {
            event.preventDefault();
            const categoryName = document.getElementById('category-name').value.trim();
            
            if (!categoryName) {
                alert('Por favor, digite um nome para a categoria.');
                return;
            }
            
            // Verificar se categoria j√° existe
            if (config.menu.find(cat => cat.category.toLowerCase() === categoryName.toLowerCase())) {
                alert('‚ùå Esta categoria j√° existe!');
                return;
            }
            
            config.menu.push({
                category: categoryName,
                products: []
            });
            
            // Salva no Firebase
            const success = await saveConfigToFirebase();
            if (success) {
                alert('‚úÖ Categoria criada com sucesso!');
                loadAdminDashboard();
            }
        }

        function exportConfig() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'backup-cardapio.json';
            link.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Backup exportado com sucesso!');
        }

    </script>
</body>
</html>